<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ¯ ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet" />
    <script src="tmi.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tmi.js@1.8.5/dist/tmi.min.js"></script>

  <style>
    :root {
      /* Ù†Ø¸Ø§Ù… Ø£Ù„ÙˆØ§Ù† Ù…ØªØ·ÙˆØ± */
      --bg-primary: #0a0b14;
      --bg-secondary: #121420;
      --bg-card: #1a1d2b;
      --bg-surface: #242837;
      --bg-dropdown: rgba(26, 29, 43, 0.98);
      
      --accent-primary: #ff4757;
      --accent-secondary: #ff6b81;
      --accent-success: #2ed573;
      --accent-warning: #ffa502;
      --accent-danger: #ff4757;
      --accent-info: #1e90ff;
      
      --text-primary: #f8fafc;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      
      --border-light: rgba(148, 163, 184, 0.2);
      --border-medium: rgba(148, 163, 184, 0.3);
      --border-dark: rgba(148, 163, 184, 0.4);
      
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.4);
      --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.5);
      --shadow-glow: 0 0 20px rgba(255, 71, 87, 0.4);
      --shadow-dropdown: 0 12px 32px rgba(0, 0, 0, 0.5);
      
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;
      --radius-full: 999px;
      
      --transition-fast: 150ms ease;
      --transition-normal: 250ms ease;
      --transition-slow: 350ms ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: 'Cairo', sans-serif;
      background: 
        radial-gradient(ellipse at 20% 20%, rgba(37, 41, 88, 0.4) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(87, 41, 88, 0.3) 0%, transparent 50%),
        linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
      color: var(--text-primary);
      padding: 16px;
      overflow-x: hidden;
    }

    .page {
      max-width: 1400px;
      margin: 0 auto;
      position: relative;
    }

    /* Header */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 20px;
      margin-bottom: 24px;
      padding: 16px 24px;
      background: rgba(26, 29, 43, 0.95);
      border-radius: var(--radius-lg);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-md);
      position: relative;
      z-index: 100;
    }

    .title-area {
      flex: 1;
    }

    .title-area h1 {
      font-size: 32px;
      color: var(--accent-primary);
      margin-bottom: 6px;
      font-weight: 800;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      letter-spacing: -0.5px;
    }

    .title-area p {
      font-size: 14px;
      color: var(--text-secondary);
      max-width: 600px;
      line-height: 1.4;
    }

    /* Header Buttons */
    .header-controls {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    /* Dropdown Containers */
    .dropdown-container {
      position: relative;
    }

    /* Main Buttons in Header */
    .header-btn {
      padding: 10px 20px;
      background: rgba(30, 41, 59, 0.9);
      border: 1px solid var(--border-medium);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-family: 'Cairo', sans-serif;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition-normal);
      min-width: 120px;
      justify-content: center;
    }

    .header-btn:hover {
      background: rgba(51, 65, 85, 0.9);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .header-btn.active {
      background: rgba(255, 71, 87, 0.15);
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 1px rgba(255, 71, 87, 0.3);
    }

    /* Dropdown Panels */
    .dropdown-panel {
      position: absolute;
      top: calc(100% + 10px);
      left: 0;
      width: 400px;
      max-width: 90vw;
      background: var(--bg-dropdown);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-medium);
      box-shadow: var(--shadow-dropdown);
      padding: 20px;
      backdrop-filter: blur(20px);
      display: none;
      z-index: 1000;
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .dropdown-panel.active {
      display: block;
    }

    .dropdown-panel h3 {
      font-size: 16px;
      color: var(--accent-primary);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border-light);
    }

    /* Connection Status */
    .connection-status {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 16px;
      background: rgba(15, 23, 42, 0.9);
      border-radius: var(--radius-full);
      border: 1px solid var(--border-medium);
    }

    .connection-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--accent-danger);
      box-shadow: 0 0 10px var(--accent-danger);
      transition: var(--transition-normal);
    }

    .connection-indicator.connected {
      background: var(--accent-success);
      box-shadow: 0 0 10px var(--accent-success);
    }

    .connection-text {
      font-size: 13px;
      color: var(--text-secondary);
    }

    /* Help Button */
    .help-btn {
      position: absolute;
      top: 24px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 100;
      padding: 10px 20px;
      background: rgba(26, 29, 43, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border-medium);
      color: var(--text-secondary);
      border-radius: var(--radius-full);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      transition: var(--transition-fast);
    }

    .help-btn:hover {
      background: rgba(37, 41, 88, 0.8);
      color: var(--text-primary);
      transform: translateX(-50%) translateY(-1px);
    }

    /* Main Layout */
    main.layout {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* Buttons */
    .btn {
      padding: 10px 20px;
      border-radius: var(--radius-full);
      border: none;
      font-family: 'Cairo', sans-serif;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition-normal);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      color: white;
      box-shadow: var(--shadow-sm);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-glow);
    }

    .btn-secondary {
      background: rgba(30, 41, 59, 0.8);
      color: var(--text-secondary);
      border: 1px solid var(--border-medium);
    }

    .btn-secondary:hover {
      background: rgba(51, 65, 85, 0.8);
      color: var(--text-primary);
    }

    .btn-danger {
      background: rgba(255, 71, 87, 0.1);
      color: var(--accent-danger);
      border: 1px solid rgba(255, 71, 87, 0.3);
    }

    .btn-danger:hover {
      background: rgba(255, 71, 87, 0.2);
    }

    .btn-success {
      background: rgba(46, 213, 115, 0.1);
      color: var(--accent-success);
      border: 1px solid rgba(46, 213, 115, 0.3);
    }

    .btn-success:hover {
      background: rgba(46, 213, 115, 0.2);
    }

    .btn-sm {
      padding: 8px 16px;
      font-size: 13px;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }

    /* Forms */
    .field {
      margin-bottom: 16px;
    }

    .field label {
      display: block;
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }

    .field input,
    .field select {
      width: 100%;
      padding: 10px 14px;
      background: rgba(15, 23, 42, 0.7);
      border: 1px solid var(--border-medium);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-family: 'Cairo', sans-serif;
      font-size: 14px;
      transition: var(--transition-fast);
    }

    .field input:focus,
    .field select:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(255, 71, 87, 0.1);
    }

    /* Players List in Dropdown */
    .players-dropdown-content {
      max-height: 300px;
      overflow-y: auto;
      padding: 8px;
    }

    .players-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .player-tag {
      background: rgba(30, 41, 59, 0.8);
      border: 1px solid var(--border-medium);
      border-radius: var(--radius-md);
      padding: 10px 12px;
      font-size: 13px;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 10px;
      transition: var(--transition-fast);
    }

    .player-tag:hover {
      background: rgba(51, 65, 85, 0.8);
      transform: translateX(-2px);
    }

    .player-tag.platform-twitch {
      border-color: #9146ff;
    }

    .player-tag.platform-kick {
      border-color: #53fc18;
    }

    .player-tag.empty {
      text-align: center;
      justify-content: center;
      opacity: 0.7;
    }

    /* Control Panel in Dropdown */
    .control-dropdown-content {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .control-group {
      background: rgba(15, 23, 42, 0.5);
      border-radius: var(--radius-md);
      padding: 16px;
      border: 1px solid var(--border-light);
    }

    .control-group h4 {
      font-size: 14px;
      color: var(--text-primary);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .quick-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    /* Connection Panel in Dropdown */
    .connection-dropdown-content {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .connection-form {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    /* Game Center */
    .center-panel {
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 20px;
      align-items: center;
    }

    .game-header {
      width: 100%;
      max-width: 800px;
      margin: 0 auto 24px;
    }

    .header-grid {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 20px;
      align-items: start;
    }

    .word-card {
      background: rgba(15, 23, 42, 0.9);
      border-radius: var(--radius-lg);
      padding: 16px;
      border: 1px solid var(--border-medium);
    }

    .word-card h3 {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .word-display {
      font-size: 24px;
      font-weight: 800;
      color: var(--text-primary);
      text-align: center;
      padding: 16px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: var(--radius-md);
      margin: 8px 0;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .timer-container {
      text-align: center;
      position: relative;
    }

    .timer-circle {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      border: 3px solid var(--border-medium);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto;
      position: relative;
      background: conic-gradient(
        var(--accent-primary) 0deg,
        transparent 0deg
      );
    }

    .timer-inner {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: rgba(15, 23, 42, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .timer-value {
      font-size: 40px;
      font-weight: 800;
      color: var(--text-primary);
    }

    /* Play/Pause Button for Timer */
    .timer-control {
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      border: none;
      color: white;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-sm);
      transition: var(--transition-normal);
      z-index: 10;
    }

    .timer-control:hover {
      transform: translateX(-50%) scale(1.1);
      box-shadow: var(--shadow-glow);
    }

    .timer-control:active {
      transform: translateX(-50%) scale(0.95);
    }

    .decision-panel {
      background: rgba(15, 23, 42, 0.9);
      border-radius: var(--radius-lg);
      padding: 16px;
      border: 1px solid var(--border-medium);
    }

    .decision-buttons {
      display: flex;
      gap: 12px;
      margin-top: 12px;
    }

    .decision-buttons .btn {
      flex: 1;
    }

    /* Game Table */
    .game-table {
      position: relative;
      width: 100%;
      max-width: 800px;
      aspect-ratio: 1;
      margin: 0 auto;
      background: rgba(15, 23, 42, 0.3);
      border-radius: 50%;
      border: 2px solid var(--border-light);
      box-shadow: 
        inset 0 0 50px rgba(0, 0, 0, 0.5),
        0 20px 60px rgba(0, 0, 0, 0.6);
    }

    .center-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 70%;
      text-align: center;
    }

    .current-word-container {
      margin-bottom: 20px;
    }

    .current-word {
      font-size: 32px;
      font-weight: 800;
      color: var(--accent-primary);
      margin-bottom: 8px;
      text-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      min-height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .word-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }

    .proposed-section {
      margin-top: 20px;
      padding: 15px;
      background: rgba(255, 71, 87, 0.1);
      border-radius: var(--radius-md);
      border: 1px solid rgba(255, 71, 87, 0.3);
      display: none;
      animation: slideDown 0.3s ease-out;
    }

    .proposed-word {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
      margin: 8px 0;
      min-height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .proposed-info {
      font-size: 11px;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    .proposed-info .player-name {
      color: var(--accent-primary);
      font-weight: 600;
    }

    .current-turn {
      font-size: 14px;
      color: var(--text-secondary);
      margin-top: 10px;
    }

    .current-turn .player {
      color: var(--accent-primary);
      font-weight: 700;
    }

    /* Players Ring */
    .player-node {
      position: absolute;
      transform: translate(-50%, -50%);
      min-width: 140px;
      padding: 12px;
      background: rgba(26, 29, 43, 0.95);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-medium);
      box-shadow: var(--shadow-md);
      transition: var(--transition-normal);
    }

    .player-node.active {
      border-color: var(--accent-primary);
      box-shadow: var(--shadow-glow);
      background: rgba(255, 71, 87, 0.1);
    }

    .player-node.winner {
      border-color: var(--accent-success);
      box-shadow: 0 0 20px rgba(46, 213, 115, 0.4);
      background: rgba(46, 213, 115, 0.1);
    }

    .player-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .player-name {
      font-weight: 700;
      color: var(--text-primary);
      font-size: 13px;
    }

    .player-cards {
      background: rgba(0, 0, 0, 0.3);
      padding: 4px 10px;
      border-radius: var(--radius-full);
      font-size: 12px;
      color: var(--text-secondary);
    }

    .player-cards strong {
      color: var(--accent-primary);
    }

    .player-status {
      font-size: 11px;
      color: var(--text-muted);
    }

    /* Cards Panel */
    .cards-panel {
      position: absolute;
      right: -180px;
      top: 50%;
      transform: translateY(-50%);
      width: 160px;
      background: rgba(26, 29, 43, 0.95);
      border-radius: var(--radius-lg);
      padding: 20px;
      border: 1px solid var(--border-medium);
      box-shadow: var(--shadow-lg);
    }

    .cards-panel h3 {
      font-size: 15px;
      color: var(--accent-primary);
      text-align: center;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .cards-grid {
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
    }

    .game-card {
      width: 80px;
      height: 80px;
      border-radius: var(--radius-md);
      background: linear-gradient(145deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.95));
      border: 2px solid var(--border-medium);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      font-weight: 800;
      color: var(--text-primary);
      position: relative;
      transition: var(--transition-normal);
    }

    .game-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-md);
    }

    .game-card.star {
      border-color: var(--accent-warning);
      box-shadow: 0 0 15px rgba(255, 165, 2, 0.4);
    }

    .card-number {
      position: absolute;
      top: 6px;
      right: 6px;
      font-size: 12px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
    }

    /* Turn Notification */
    .turn-notification {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      color: white;
      padding: 24px 48px;
      border-radius: var(--radius-lg);
      font-size: 32px;
      font-weight: 800;
      text-align: center;
      z-index: 1000;
      box-shadow: var(--shadow-glow);
      animation: fadeInOut 2s ease-in-out;
      display: none;
    }

    @keyframes fadeInOut {
      0%, 100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
      20%, 80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    }

    /* Winner Banner */
    .winner-banner {
      max-width: 800px;
      margin: 20px auto 0;
      padding: 20px;
      background: linear-gradient(135deg, rgba(46, 213, 115, 0.9), rgba(46, 213, 115, 0.6));
      border-radius: var(--radius-lg);
      color: white;
      text-align: center;
      font-size: 20px;
      font-weight: 700;
      display: none;
      animation: slideUp 0.5s ease-out;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .winner-name {
      font-size: 24px;
      color: white;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    /* Help Modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.75);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      backdrop-filter: blur(5px);
    }

    .modal-backdrop.active {
      display: flex;
    }

    .modal {
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      background: rgba(26, 29, 43, 0.98);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-medium);
      box-shadow: var(--shadow-lg);
      overflow: hidden;
    }

    .modal-header {
      padding: 20px;
      background: rgba(15, 23, 42, 0.8);
      border-bottom: 1px solid var(--border-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h3 {
      font-size: 20px;
      color: var(--accent-primary);
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 24px;
      cursor: pointer;
      padding: 4px 12px;
      border-radius: var(--radius-sm);
      transition: var(--transition-fast);
    }

    .modal-close:hover {
      background: rgba(255, 71, 87, 0.1);
      color: var(--accent-primary);
    }

    .modal-body {
      padding: 20px;
      overflow-y: auto;
      max-height: calc(80vh - 80px);
    }

    .modal-section {
      margin-bottom: 24px;
    }

    .modal-section h4 {
      font-size: 16px;
      color: var(--text-primary);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .modal-section p {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .modal-section ul {
      padding-right: 20px;
      margin-bottom: 12px;
    }

    .modal-section li {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: 6px;
    }

    code {
      background: rgba(0, 0, 0, 0.3);
      padding: 2px 6px;
      border-radius: var(--radius-sm);
      font-family: monospace;
      font-size: 13px;
      color: var(--accent-primary);
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .cards-panel {
        position: relative;
        right: auto;
        top: auto;
        transform: none;
        width: 100%;
        max-width: 800px;
        margin: 20px auto;
      }
      
      .cards-grid {
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .game-card {
        width: 70px;
        height: 70px;
        font-size: 28px;
      }
    }

    @media (max-width: 768px) {
      header {
        flex-direction: column;
        text-align: center;
        gap: 16px;
        padding: 16px;
      }
      
      .header-controls {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .help-btn {
        position: relative;
        top: auto;
        left: auto;
        transform: none;
        margin: 10px auto 0;
        width: fit-content;
      }
      
      .header-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .game-table {
        border-radius: var(--radius-lg);
      }
      
      .dropdown-panel {
        width: 90vw;
        left: 5vw;
      }
    }

    /* Hint Text */
    .hint {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 6px;
      line-height: 1.4;
    }

    /* Close button for dropdowns */
    .close-dropdown {
      position: absolute;
      top: 10px;
      left: 10px;
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 18px;
      cursor: pointer;
      padding: 4px;
      border-radius: var(--radius-sm);
      transition: var(--transition-fast);
    }

    .close-dropdown:hover {
      background: rgba(255, 71, 87, 0.1);
      color: var(--accent-primary);
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- Ø²Ø± Ø§Ù„Ø´Ø±Ø­ -->
    <button class="help-btn" id="helpBtn">
      <span>â„¹ï¸</span>
      <span>Ø´Ø±Ø­ Ø§Ù„Ù„Ø¹Ø¨Ø©</span>
    </button>

    <!-- Header -->
    <header>
      <div class="title-area">
        <h1>ğŸ¯ ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª</h1>
        <p>Ù„Ø¹Ø¨Ø© Ø¨Ø·Ø§Ù‚Ø§Øª Ù„ØºÙˆÙŠØ© - ÙƒÙ„ Ù„Ø§Ø¹Ø¨ Ù…Ø¹Ù‡ Ù¨ Ø¨Ø·Ø§Ù‚Ø§ØªØŒ ÙˆØ£ÙˆÙ„ ÙˆØ§Ø­Ø¯ ÙŠØ®Ù„Øµ Ø¨Ø·Ø§Ù‚Ø§ØªÙ‡ ÙŠÙÙˆØ²</p>
      </div>
      
      <div class="header-controls">
        <!-- Players Dropdown -->
        <div class="dropdown-container">
          <button class="header-btn" id="playersBtn">
            <span>ğŸ‘¥</span>
            <span>Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</span>
          </button>
          <div class="dropdown-panel" id="playersPanel">
            <button class="close-dropdown" data-target="playersPanel">âœ•</button>
            <h3>ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h3>
            <div class="players-dropdown-content">
              <div class="players-list" id="playersList">
                <div class="player-tag empty">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¨Ø¹Ø¯</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Control Dropdown -->
        <div class="dropdown-container">
          <button class="header-btn" id="controlBtn">
            <span>ğŸ›ï¸</span>
            <span>Ø§Ù„ØªØ­ÙƒÙ…</span>
          </button>
          <div class="dropdown-panel" id="controlPanel">
            <button class="close-dropdown" data-target="controlPanel">âœ•</button>
            <h3>ğŸ›ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
            <div class="control-dropdown-content">
              <div class="control-group">
                <div class="field">
                  <label for="turnSeconds">Ù…Ø¯Ø© Ø§Ù„Ø¯ÙˆØ± (Ø«ÙˆØ§Ù†ÙŠ)</label>
                  <input type="number" id="turnSeconds" min="5" max="300" value="30">
                </div>
                <button class="btn btn-secondary btn-sm" id="updateTurnSeconds">ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª</button>
              </div>
              
              <div class="control-group">
                <h4>ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</h4>
                <button class="btn btn-primary" id="startGame">
                  <span>ğŸš€</span>
                  <span>Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</span>
                </button>
                <p class="hint">ÙŠØ¬Ø¨ ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹</p>
              </div>
              
              <div class="control-group">
                <h4>â­ï¸ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¯ÙˆØ±</h4>
                <div class="quick-controls">
                  <button class="btn btn-secondary btn-sm" id="nextPlayer">
                    <span>â­ï¸</span>
                    <span>Ù„Ø§Ø¹Ø¨ ØªØ§Ù„ÙŠ</span>
                  </button>
                  <button class="btn btn-secondary btn-sm" id="restartTurn">
                    <span>ğŸ”</span>
                    <span>Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¤Ù‚Øª</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Connection Dropdown -->
        <div class="dropdown-container">
          <button class="header-btn" id="connectionBtn">
            <span>ğŸ”Œ</span>
            <span>Ø§Ù„Ø§ØªØµØ§Ù„</span>
          </button>
          <div class="dropdown-panel" id="connectionPanel">
            <button class="close-dropdown" data-target="connectionPanel">âœ•</button>
            <h3>ğŸ”Œ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„</h3>
            <div class="connection-dropdown-content">
              <div class="connection-form">
                <div class="field">
                  <label for="platform">Ø§Ù„Ù…Ù†ØµØ©</label>
                  <select id="platform">
                    <option value="twitch">Twitch</option>
                    <option value="kick">Kick</option>
                  </select>
                </div>
                
                <div class="field">
                  <label for="channel">Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø©</label>
                  <input type="text" id="channel" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø© Ø¨Ø¯ÙˆÙ† @">
                </div>
                
                <div class="quick-controls">
                  <button class="btn btn-primary" id="connectBtn">Ø§ØªØµØ§Ù„</button>
                  <button class="btn btn-danger" id="disconnectBtn" style="display: none;">Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„</button>
                </div>
              </div>
              
              <div class="control-group">
                <h4>ğŸ”§ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©</h4>
                <p class="hint">
                  <strong>!Ø¯Ø®ÙˆÙ„</strong> - Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ø¹Ø¨Ø©<br>
                  <strong>!Ø±Ù‚Ù… Ø±Ù‚Ù…</strong> - Ù„Ù„Ø¹Ø¨ (Ù…Ø«Ø§Ù„: !1 5)
                </p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Connection Status -->
        <div class="connection-status">
          <div class="connection-indicator" id="connectionIndicator"></div>
          <div class="connection-text" id="connectionText">ØºÙŠØ± Ù…ØªØµÙ„</div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="layout">
      <!-- Game Center -->
      <section class="panel center-panel">
        <!-- Game Header -->
        <div class="game-header">
          <div class="header-grid">
            <!-- Word Card -->
            <div class="word-card">
              <h3><span>ğŸ“</span> Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h3>
              <div class="field">
                <input type="text" id="initialWord" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰">
              </div>
              <button class="btn btn-secondary btn-sm" id="setInitialWord">ØªØ¹ÙŠÙŠÙ†</button>
            </div>
            
            <!-- Timer with Play/Pause Button -->
            <div class="timer-container">
              <div class="timer-circle" id="timerCircle">
                <div class="timer-inner">
                  <div class="timer-value" id="timerValue">--</div>
                </div>
              </div>
              <button class="timer-control" id="timerToggle">
                <span id="timerToggleIcon">â¸ï¸</span>
              </button>
              <p class="hint">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„Ø¯ÙˆØ±</p>
            </div>
            
            <!-- Decision Panel -->
            <div class="decision-panel">
              <h3><span>âœ…</span> Ù‚Ø±Ø§Ø± Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</h3>
              <div class="decision-buttons">
                <button class="btn btn-success" id="acceptWord">âœ… Ù‚Ø¨ÙˆÙ„</button>
                <button class="btn btn-danger" id="rejectWord">âŒ Ø±ÙØ¶</button>
              </div>
              <p class="hint">Ø§Ø®ØªØ± Ù‚Ø¨ÙˆÙ„ Ø£Ùˆ Ø±ÙØ¶ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</p>
            </div>
          </div>
        </div>

        <!-- Game Table -->
        <div class="game-table">
          <!-- Center Content -->
          <div class="center-content">
            <!-- Current Word -->
            <div class="current-word-container">
              <div class="word-label">Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</div>
              <div class="current-word" id="currentWord">â€” â€” â€”</div>
            </div>
            
            <!-- Proposed Word -->
            <div class="proposed-section" id="proposedSection">
              <div class="word-label">ÙƒÙ„Ù…Ø© Ù…Ù‚ØªØ±Ø­Ø©</div>
              <div class="proposed-word" id="proposedWord">â€”</div>
              <div class="proposed-info" id="proposerInfo">
                Ù…Ù†: <span class="player-name">â€”</span>
              </div>
            </div>
            
            <!-- Current Turn -->
            <div class="current-turn">
              <span>Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠ:</span>
              <span class="player" id="currentPlayer">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span>
            </div>
          </div>
          
          <!-- Players Ring -->
          <div class="players-ring" id="playersRing"></div>
        </div>

        <!-- Cards Panel -->
        <div class="cards-panel">
          <h3><span>ğŸ´</span> Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
          <div class="cards-grid" id="cardsGrid">
            <!-- Cards will be inserted here -->
          </div>
        </div>

        <!-- Turn Notification -->
        <div class="turn-notification" id="turnNotification"></div>

        <!-- Winner Banner -->
        <div class="winner-banner" id="winnerBanner">
          <span>ğŸ‰ Ø§Ù„ÙØ§Ø¦Ø² ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØ­Ø¯ÙŠ Ù‡Ùˆ: </span>
          <span class="winner-name" id="winnerName">â€”</span>
        </div>
      </section>
    </main>
  </div>

  <!-- Help Modal -->
  <div class="modal-backdrop" id="helpModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Ø´Ø±Ø­ Ù„Ø¹Ø¨Ø© ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª</h3>
        <button class="modal-close" id="closeHelp">&times;</button>
      </div>
      <div class="modal-body">
        <div class="modal-section">
          <h4><span>ğŸ¯</span> ÙÙƒØ±Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©</h4>
          <p>Ù„Ø¹Ø¨Ø© Ø¨Ø·Ø§Ù‚Ø§Øª Ù„ØºÙˆÙŠØ© Ø¨ÙŠÙ† Ù„Ø§Ø¹Ø¨ÙŠÙ†ØŒ ÙƒÙ„ Ù„Ø§Ø¹Ø¨ Ù…Ø¹Ù‡ Ù¨ Ø¨Ø·Ø§Ù‚Ø§Øª Ø­Ø±ÙˆÙØŒ ÙˆÙŠØªÙ†Ø§ÙØ³ÙˆÙ† Ø¹Ù„Ù‰ ØªÙƒÙˆÙŠÙ† ÙƒÙ„Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø­Ø±Ù ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· ÙÙŠ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©. Ø£ÙˆÙ„ Ù„Ø§Ø¹Ø¨ ÙŠØ®Ù„Øµ ÙƒÙ„ Ø¨Ø·Ø§Ù‚Ø§ØªÙ‡ Ù‡Ùˆ Ø§Ù„ÙØ§Ø¦Ø².</p>
        </div>
        
        <div class="modal-section">
          <h4><span>ğŸ§©</span> Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</h4>
          <ul>
            <li>Ù…Ù† Ø§Ù„Ø´Ø§Øª: ÙŠÙƒØªØ¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ <code>!Ø¯Ø®ÙˆÙ„</code></li>
            <li>Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù…ØªØ§Ø­ ÙÙ‚Ø· Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</li>
            <li>Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙŠØ¶Ø§Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø£Ù…Ø±</li>
          </ul>
        </div>
        
        <div class="modal-section">
          <h4><span>ğŸ´</span> Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</h4>
          <ul>
            <li>ÙƒÙ„ Ù„Ø§Ø¹Ø¨ ÙŠØ£Ø®Ø° Ù¨ Ø¨Ø·Ø§Ù‚Ø§Øª Ø­Ø±ÙˆÙ Ø¹Ø±Ø¨ÙŠØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©</li>
            <li>Ø¨Ø¹Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù‚Ø¯ ØªÙƒÙˆÙ† Ù†Ø¬Ù…Ø© â­ ÙˆØªÙ…Ø«Ù„ Ø£ÙŠ Ø­Ø±Ù</li>
          </ul>
        </div>
        
        <div class="modal-section">
          <h4><span>ğŸ“</span> Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù„Ø¹Ø¨</h4>
          <p>Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙˆÙ† Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ØŒ ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ù…Ø±:</p>
          <p><code>!Ù…ÙƒØ§Ù†_Ø§Ù„Ø­Ø±Ù Ø±Ù‚Ù…_Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</code></p>
          <p>Ù…Ø«Ø§Ù„: <code>!1 5</code> ÙŠØ¹Ù†ÙŠ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø­Ø±Ù Ø§Ù„Ø£ÙˆÙ„ Ø¨Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø±Ù‚Ù… 5</p>
        </div>
        
        <div class="modal-section">
          <h4><span>âœ…</span> Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª</h4>
          <p>Ø§Ù„Ø³ØªØ±ÙŠÙ…Ø± ÙŠÙ‚Ø±Ø± Ù‚Ø¨ÙˆÙ„ Ø£Ùˆ Ø±ÙØ¶ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== Game Data =====
    const MAX_PLAYERS = 10;
    const CARDS_PER_PLAYER = 8;
    const ARABIC_LETTERS = [
      'Ø§','Ø¨','Øª','Ø«','Ø¬','Ø­','Ø®','Ø¯','Ø°','Ø±','Ø²','Ø³','Ø´',
      'Øµ','Ø¶','Ø·','Ø¸','Ø¹','Øº','Ù','Ù‚','Ùƒ','Ù„','Ù…','Ù†','Ù‡','Ùˆ','ÙŠ'
    ];

    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠÙ† - Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙØ§Ø±ØºÙŠÙ† Ø§Ù„Ø¢Ù†
    let players = [];
    let currentPlayerIndex = -1;
    let turnSeconds = 30;
    let timerId = null;
    let remainingSeconds = 0;
    let gameStarted = false;
    let winnerFound = false;
    let pendingSuggestion = null;
    let timerPaused = false;

    // Connection
    let activePlatform = null;
    let activeChannel = null;
    let twitchClient = null;
    let kickSocket = null;

    // DOM Elements
    const connectionIndicator = document.getElementById('connectionIndicator');
    const connectionText = document.getElementById('connectionText');
    const helpBtn = document.getElementById('helpBtn');
    const helpModal = document.getElementById('helpModal');
    const closeHelp = document.getElementById('closeHelp');
    const timerValue = document.getElementById('timerValue');
    const timerCircle = document.getElementById('timerCircle');
    const currentWord = document.getElementById('currentWord');
    const currentPlayer = document.getElementById('currentPlayer');
    const cardsGrid = document.getElementById('cardsGrid');
    const playersRing = document.getElementById('playersRing');
    const playersList = document.getElementById('playersList');
    const turnNotification = document.getElementById('turnNotification');
    const winnerBanner = document.getElementById('winnerBanner');
    const winnerName = document.getElementById('winnerName');
    const proposedSection = document.getElementById('proposedSection');
    const proposedWord = document.getElementById('proposedWord');
    const proposerInfo = document.getElementById('proposerInfo');
    const timerToggle = document.getElementById('timerToggle');
    const timerToggleIcon = document.getElementById('timerToggleIcon');

    // Dropdown Elements
    const playersBtn = document.getElementById('playersBtn');
    const playersPanel = document.getElementById('playersPanel');
    const controlBtn = document.getElementById('controlBtn');
    const controlPanel = document.getElementById('controlPanel');
    const connectionBtn = document.getElementById('connectionBtn');
    const connectionPanel = document.getElementById('connectionPanel');
    const closeDropdowns = document.querySelectorAll('.close-dropdown');

    // Control Elements
    const turnSecondsInput = document.getElementById('turnSeconds');
    const updateTurnSecondsBtn = document.getElementById('updateTurnSeconds');
    const startGameBtn = document.getElementById('startGame');
    const nextPlayerBtn = document.getElementById('nextPlayer');
    const restartTurnBtn = document.getElementById('restartTurn');
    const initialWordInput = document.getElementById('initialWord');
    const setInitialWordBtn = document.getElementById('setInitialWord');
    const acceptWordBtn = document.getElementById('acceptWord');
    const rejectWordBtn = document.getElementById('rejectWord');
    const platformSelect = document.getElementById('platform');
    const channelInput = document.getElementById('channel');
    const connectBtn = document.getElementById('connectBtn');
    const disconnectBtn = document.getElementById('disconnectBtn');

    // ===== Dropdown Management =====
    function closeAllDropdowns() {
      playersPanel.classList.remove('active');
      controlPanel.classList.remove('active');
      connectionPanel.classList.remove('active');
      playersBtn.classList.remove('active');
      controlBtn.classList.remove('active');
      connectionBtn.classList.remove('active');
    }

    playersBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      if (playersPanel.classList.contains('active')) {
        playersPanel.classList.remove('active');
        playersBtn.classList.remove('active');
      } else {
        closeAllDropdowns();
        playersPanel.classList.add('active');
        playersBtn.classList.add('active');
      }
    });

    controlBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      if (controlPanel.classList.contains('active')) {
        controlPanel.classList.remove('active');
        controlBtn.classList.remove('active');
      } else {
        closeAllDropdowns();
        controlPanel.classList.add('active');
        controlBtn.classList.add('active');
      }
    });

    connectionBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      if (connectionPanel.classList.contains('active')) {
        connectionPanel.classList.remove('active');
        connectionBtn.classList.remove('active');
      } else {
        closeAllDropdowns();
        connectionPanel.classList.add('active');
        connectionBtn.classList.add('active');
      }
    });

    // Close dropdowns when clicking outside
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.dropdown-container')) {
        closeAllDropdowns();
      }
    });

    // Close dropdowns with close buttons
    closeDropdowns.forEach(btn => {
      btn.addEventListener('click', () => {
        const target = btn.getAttribute('data-target');
        document.getElementById(target).classList.remove('active');
        document.querySelector(`#${target.replace('Panel', 'Btn')}`).classList.remove('active');
      });
    });

    // ===== Helper Functions =====
    function randomCard() {
      return Math.random() < 0.12 ? 'â­' : ARABIC_LETTERS[Math.floor(Math.random() * ARABIC_LETTERS.length)];
    }

    function dealCards() {
      players.forEach(p => {
        p.cards = Array.from({ length: CARDS_PER_PLAYER }, randomCard);
        p.isWinner = false;
      });
      renderCards();
      updatePlayersList();
    }

    function renderCards() {
      cardsGrid.innerHTML = '';
      if (currentPlayerIndex < 0 || !gameStarted || currentPlayerIndex >= players.length) return;
      
      const player = players[currentPlayerIndex];
      player.cards.forEach((card, idx) => {
        const cardEl = document.createElement('div');
        cardEl.className = 'game-card';
        if (card === 'â­') cardEl.classList.add('star');
        cardEl.textContent = card;
        
        const numberEl = document.createElement('div');
        numberEl.className = 'card-number';
        numberEl.textContent = idx + 1;
        cardEl.appendChild(numberEl);
        
        cardsGrid.appendChild(cardEl);
      });
    }

    function updatePlayersList() {
      playersList.innerHTML = '';
      
      if (players.length === 0) {
        const empty = document.createElement('div');
        empty.className = 'player-tag empty';
        empty.textContent = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¨Ø¹Ø¯';
        playersList.appendChild(empty);
        return;
      }
      
      players.forEach((player, idx) => {
        const tag = document.createElement('div');
        tag.className = `player-tag platform-${player.platform || 'manual'}`;
        
        const platformIcon = player.platform === 'twitch' ? 'ğŸ“º' : 
                           player.platform === 'kick' ? 'ğŸ¥¾' : 'ğŸ‘¤';
        
        tag.innerHTML = `
          <span style="font-size: 16px;">${platformIcon}</span>
          <div style="flex: 1;">
            <div style="font-weight: 600; color: var(--text-primary);">${player.name}</div>
            <div style="font-size: 11px; color: var(--text-muted);">${player.cards.length} Ø¨Ø·Ø§Ù‚Ø©</div>
          </div>
          ${idx === currentPlayerIndex && gameStarted ? '<span style="color: var(--accent-primary);">ğŸ®</span>' : ''}
        `;
        
        playersList.appendChild(tag);
      });
    }

    function layoutPlayersRing() {
      playersRing.innerHTML = '';
      if (players.length === 0) return;
      
      const radius = 40;
      const centerX = 50;
      const centerY = 50;
      
      players.forEach((player, idx) => {
        const angle = (2 * Math.PI * idx / players.length) - Math.PI / 2;
        const x = centerX + radius * Math.cos(angle);
        const y = centerY + radius * Math.sin(angle);
        
        const node = document.createElement('div');
        node.className = 'player-node';
        if (idx === currentPlayerIndex && gameStarted) node.classList.add('active');
        if (player.isWinner) node.classList.add('winner');
        
        node.style.left = `${x}%`;
        node.style.top = `${y}%`;
        
        node.innerHTML = `
          <div class="player-info">
            <div class="player-name">${player.name}</div>
            <div class="player-cards"><strong>${player.cards.length}</strong> / ${CARDS_PER_PLAYER}</div>
          </div>
          <div class="player-status">
            ${player.isWinner ? 'Ø§Ù„ÙØ§Ø¦Ø² ğŸ‰' : idx === currentPlayerIndex ? 'Ø¯ÙˆØ±Ù‡ Ø§Ù„Ø¢Ù†' : 'ÙŠÙ†ØªØ¸Ø±'}
          </div>
        `;
        
        playersRing.appendChild(node);
      });
    }

    function updateTimer() {
      if (timerId) {
        clearInterval(timerId);
      }
      
      remainingSeconds = turnSeconds;
      updateTimerDisplay();
      
      timerId = setInterval(() => {
        remainingSeconds--;
        updateTimerDisplay();
        
        if (remainingSeconds <= 0) {
          clearInterval(timerId);
          timerId = null;
          nextPlayer();
        }
      }, 1000);
      
      timerPaused = false;
      timerToggleIcon.textContent = 'â¸ï¸';
    }

    function updateTimerDisplay() {
      timerValue.textContent = remainingSeconds;
      const percentage = (remainingSeconds / turnSeconds) * 100;
      const deg = (percentage / 100) * 360;
      timerCircle.style.background = `conic-gradient(
        var(--accent-primary) 0deg,
        var(--accent-primary) ${deg}deg,
        transparent ${deg}deg,
        transparent 360deg
      )`;
    }

    function toggleTimer() {
      if (timerId) {
        clearInterval(timerId);
        timerId = null;
        timerPaused = true;
        timerToggleIcon.textContent = 'â–¶ï¸';
      } else {
        if (remainingSeconds > 0 && !winnerFound && gameStarted) {
          timerId = setInterval(() => {
            remainingSeconds--;
            updateTimerDisplay();
            
            if (remainingSeconds <= 0) {
              clearInterval(timerId);
              timerId = null;
              nextPlayer();
            }
          }, 1000);
          timerPaused = false;
          timerToggleIcon.textContent = 'â¸ï¸';
        }
      }
    }

    function showTurnNotification(playerName) {
      turnNotification.textContent = `ğŸ® Ø¯ÙˆØ±: ${playerName}`;
      turnNotification.style.display = 'block';
      
      setTimeout(() => {
        turnNotification.style.display = 'none';
      }, 2000);
    }

    function nextPlayer() {
      if (!gameStarted || players.length === 0) return;
      
      let attempts = 0;
      let idx = currentPlayerIndex;
      
      while (attempts < players.length) {
        idx = (idx + 1) % players.length;
        if (players[idx].cards.length > 0) {
          currentPlayerIndex = idx;
          break;
        }
        attempts++;
      }
      
      layoutPlayersRing();
      renderCards();
      updatePlayersList();
      currentPlayer.textContent = players[currentPlayerIndex]?.name || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
      showTurnNotification(players[currentPlayerIndex]?.name || '');
      updateTimer();
    }

    function checkWinner(player) {
      if (player.cards.length === 0) {
        player.isWinner = true;
        winnerFound = true;
        winnerName.textContent = player.name;
        winnerBanner.style.display = 'block';
        clearInterval(timerId);
        timerId = null;
      }
    }

    function clearProposal() {
      pendingSuggestion = null;
      proposedSection.style.display = 'none';
    }

    function showProposal(suggestion) {
      pendingSuggestion = suggestion;
      proposedWord.textContent = suggestion.word;
      
      const player = players[suggestion.playerIndex];
      const playerName = player ? player.name : 'Ù…Ø¬Ù‡ÙˆÙ„';
      const cardUsed = player && player.cards[suggestion.cardIndex] ? player.cards[suggestion.cardIndex] : 'ØŸ';
      
      proposerInfo.innerHTML = `
        Ù…Ù†: <span class="player-name">${playerName}</span> 
        | Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø­Ø±Ù ${suggestion.position} 
        Ø¨Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ${suggestion.cardIndex + 1} (${cardUsed})
      `;
      
      proposedSection.style.display = 'block';
    }

    function acceptProposal() {
      if (!pendingSuggestion) return;
      
      const player = players[pendingSuggestion.playerIndex];
      
      // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
      if (pendingSuggestion.cardIndex >= player.cards.length) {
        alert('Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©!');
        clearProposal();
        return;
      }
      
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
      player.cards.splice(pendingSuggestion.cardIndex, 1);
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„ØªØµØ¨Ø­ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©
      currentWord.textContent = pendingSuggestion.word;
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
      renderCards();
      layoutPlayersRing();
      updatePlayersList();
      clearProposal();
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙÙˆØ²
      checkWinner(player);
      
      // Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„ØªØ§Ù„ÙŠ ÙÙ‚Ø· Ø¥Ø°Ø§ Ù„Ù… ÙŠÙØ²
      if (!winnerFound) {
        nextPlayer();
      }
    }

    function rejectProposal() {
      if (!pendingSuggestion) return;
      
      // Ø¹Ù†Ø¯ Ø§Ù„Ø±ÙØ¶ØŒ Ù†Ø¨Ù‚Ù‰ Ù…Ø¹ Ù†ÙØ³ Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙˆÙ†Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø¤Ù‚Øª
      clearProposal();
      updateTimer(); // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¤Ù‚Øª Ù„Ù†ÙØ³ Ø§Ù„Ù„Ø§Ø¹Ø¨
    }

    // ===== Player Management =====
    function addPlayer(name, platform) {
      // Check if game has started
      if (gameStarted) {
        console.log(`ğŸš« ${name} Ø­Ø§ÙˆÙ„ ÙŠØ¯Ø®Ù„ Ø¨Ø¹Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©`);
        return false;
      }
      
      // Check max players
      if (players.length >= MAX_PLAYERS) {
        console.log(`ğŸš« ÙˆØµÙ„ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† (${MAX_PLAYERS})`);
        return false;
      }
      
      // Check if player already exists
      const existingPlayer = players.find(p => 
        p.name.toLowerCase() === name.toLowerCase() && p.platform === platform
      );
      
      if (existingPlayer) {
        console.log(`â„¹ï¸ ${name} Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„`);
        return false;
      }
      
      // Add new player
      const newPlayer = {
        name: name,
        platform: platform,
        cards: [],
        isWinner: false
      };
      
      players.push(newPlayer);
      console.log(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„Ø§Ø¹Ø¨: ${name} (${platform})`);
      
      updatePlayersList();
      layoutPlayersRing();
      
      return true;
    }

    // ===== Chat Connection & Commands =====
    function updateConnectionUI(connected = false) {
      if (connected) {
        connectionIndicator.classList.add('connected');
        connectionText.textContent = `Ù…ØªØµÙ„ Ø¨Ù€ ${activePlatform} - ${activeChannel}`;
        connectBtn.style.display = 'none';
        disconnectBtn.style.display = 'inline-flex';
      } else {
        connectionIndicator.classList.remove('connected');
        connectionText.textContent = 'ØºÙŠØ± Ù…ØªØµÙ„';
        connectBtn.style.display = 'inline-flex';
        disconnectBtn.style.display = 'none';
        activePlatform = null;
        activeChannel = null;
      }
    }

    function disconnectAll() {
      // Disconnect Twitch
      if (twitchClient) {
        try {
          twitchClient.disconnect();
        } catch (e) {
          console.error('Error disconnecting Twitch:', e);
        }
        twitchClient = null;
      }
      
      // Disconnect Kick
      if (kickSocket) {
        try {
          if (kickSocket._pingInterval) clearInterval(kickSocket._pingInterval);
          if (kickSocket.readyState === WebSocket.OPEN) {
            kickSocket.close();
          }
        } catch (e) {
          console.error('Error disconnecting Kick:', e);
        }
        kickSocket = null;
      }
      
      updateConnectionUI(false);
    }

    function connectTwitch(channel) {
      disconnectAll();
      
      activePlatform = 'twitch';
      activeChannel = channel.toLowerCase().replace('@', '');
      
      twitchClient = new tmi.Client({
        options: { debug: false },
        connection: {
          secure: true,
          reconnect: true
        },
        channels: [activeChannel]
      });
      
      twitchClient.connect().then(() => {
        console.log(`âœ… Connected to Twitch: ${activeChannel}`);
        updateConnectionUI(true);
      }).catch(err => {
        console.error('âŒ Failed to connect to Twitch:', err);
        alert('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨ØªÙˆÙŠØªØ´. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø©.');
        updateConnectionUI(false);
      });
      
      // Handle messages
      twitchClient.on('message', (channel, tags, message, self) => {
        if (self) return;
        
        const username = tags['display-name'] || tags.username;
        const cleanedMessage = message.trim();
        
        console.log(`[Twitch] ${username}: ${cleanedMessage}`);
        handleChatCommand('twitch', username, cleanedMessage);
      });
    }

    function connectKick(channel) {
      disconnectAll();
      
      activePlatform = 'kick';
      activeChannel = channel.toLowerCase().replace('@', '');
      
      // Kick connection requires a different approach
      // This is a simplified version - may need adjustments
      console.log(`âš ï¸ Kick connection requires additional setup`);
      alert('Ø§ØªØµØ§Ù„ Kick ÙŠØ­ØªØ§Ø¬ Ø¥Ø¹Ø¯Ø§Ø¯ Ø¥Ø¶Ø§ÙÙŠ. Ø§Ø³ØªØ®Ø¯Ù… Twitch Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±.');
      updateConnectionUI(false);
    }

    function handleChatCommand(platform, username, message) {
      // Clean and parse message
      const cleanMessage = message.trim().toLowerCase();
      
      // !Ø¯Ø®ÙˆÙ„ command
      if (cleanMessage === '!Ø¯Ø®ÙˆÙ„' || cleanMessage === '!Ø¯Ø®Ù„') {
        const added = addPlayer(username, platform);
        if (added) {
          // You could send a confirmation message back to chat here
          console.log(`âœ… ${username} joined the game`);
        }
        return;
      }
      
      // !Ø±Ù‚Ù… Ø±Ù‚Ù… command (Ù…Ø«Ù„ !1 5)
      const moveMatch = cleanMessage.match(/^!(\d+)\s+(\d+)$/);
      if (moveMatch && gameStarted) {
        const position = parseInt(moveMatch[1]);
        const cardNumber = parseInt(moveMatch[2]);
        
        // Find player
        const playerIndex = players.findIndex(p => 
          p.name.toLowerCase() === username.toLowerCase() && p.platform === platform
        );
        
        if (playerIndex === -1) {
          console.log(`ğŸš« ${username} Ù„ÙŠØ³ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©`);
          return;
        }
        
        if (playerIndex !== currentPlayerIndex) {
          console.log(`ğŸš« Ù„ÙŠØ³ Ø¯ÙˆØ± ${username} Ø§Ù„Ø¢Ù†`);
          return;
        }
        
        // Get current word
        const currentWordText = currentWord.textContent;
        if (!currentWordText || currentWordText === 'â€” â€” â€”') {
          console.log(`ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø© Ø­Ø§Ù„ÙŠØ©`);
          return;
        }
        
        // Check position validity
        if (position < 1 || position > currentWordText.length) {
          console.log(`ğŸš« Ø±Ù‚Ù… Ø§Ù„Ø­Ø±Ù ØºÙŠØ± ØµØ§Ù„Ø­ (1-${currentWordText.length})`);
          return;
        }
        
        // Check card number validity
        const player = players[playerIndex];
        if (cardNumber < 1 || cardNumber > player.cards.length) {
          console.log(`ğŸš« Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ØºÙŠØ± ØµØ§Ù„Ø­ (1-${player.cards.length})`);
          return;
        }
        
        // Get the card
        const cardChar = player.cards[cardNumber - 1];
        
        // Create new word by replacing character
        const newWord = currentWordText.substring(0, position - 1) + 
                       cardChar + 
                       currentWordText.substring(position);
        
        // Create suggestion
        const suggestion = {
          playerIndex: playerIndex,
          cardIndex: cardNumber - 1,
          word: newWord,
          position: position,
          playerName: username
        };
        
        // Show the proposal
        showProposal(suggestion);
        console.log(`ğŸ® ${username} Ø§Ù‚ØªØ±Ø­: ${newWord}`);
        
        // Stop timer while waiting for decision
        if (timerId) {
          clearInterval(timerId);
          timerId = null;
        }
      }
    }

    // ===== Event Listeners =====
    startGameBtn.addEventListener('click', () => {
      if (players.length === 0) {
        alert('Ø£Ø¶Ù Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø£ÙˆÙ„Ø§Ù‹ Ø¹Ù† Ø·Ø±ÙŠÙ‚ ÙƒØªØ§Ø¨Ø© !Ø¯Ø®ÙˆÙ„ ÙÙŠ Ø§Ù„Ø´Ø§Øª!');
        return;
      }
      
      if (!currentWord.textContent || currentWord.textContent === 'â€” â€” â€”') {
        alert('Ø¹ÙŠÙ‘Ù† Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø£ÙˆÙ„Ø§Ù‹!');
        return;
      }
      
      gameStarted = true;
      winnerFound = false;
      winnerBanner.style.display = 'none';
      currentPlayerIndex = 0;
      clearProposal();
      
      dealCards();
      layoutPlayersRing();
      renderCards();
      updatePlayersList();
      currentPlayer.textContent = players[currentPlayerIndex].name;
      showTurnNotification(players[currentPlayerIndex].name);
      updateTimer();
    });

    nextPlayerBtn.addEventListener('click', nextPlayer);
    
    restartTurnBtn.addEventListener('click', () => {
      updateTimer();
    });
    
    timerToggle.addEventListener('click', toggleTimer);
    
    updateTurnSecondsBtn.addEventListener('click', () => {
      const val = parseInt(turnSecondsInput.value);
      if (val >= 5 && val <= 300) {
        turnSeconds = val;
        updateTimerDisplay();
      }
    });
    
    setInitialWordBtn.addEventListener('click', () => {
      const word = initialWordInput.value.trim();
      if (word) {
        currentWord.textContent = word;
      }
    });
    
    acceptWordBtn.addEventListener('click', acceptProposal);
    rejectWordBtn.addEventListener('click', rejectProposal);
    
    connectBtn.addEventListener('click', () => {
      const platform = platformSelect.value;
      const channel = channelInput.value.trim();
      
      if (!channel) {
        alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø©!');
        return;
      }
      
      if (platform === 'twitch') {
        connectTwitch(channel);
      } else if (platform === 'kick') {
        connectKick(channel);
      }
    });
    
    disconnectBtn.addEventListener('click', () => {
      disconnectAll();
    });

    // Help Modal
    helpBtn.addEventListener('click', () => {
      helpModal.classList.add('active');
    });
    
    closeHelp.addEventListener('click', () => {
      helpModal.classList.remove('active');
    });
    
    helpModal.addEventListener('click', (e) => {
      if (e.target === helpModal) {
        helpModal.classList.remove('active');
      }
    });

    // Initialize
    function init() {
      // No sample players - list is empty
      updatePlayersList();
      layoutPlayersRing();
      updateTimerDisplay();
      proposedSection.style.display = 'none';
      
      // Add test players button for debugging
      const testBtn = document.createElement('button');
      testBtn.className = 'btn btn-secondary btn-sm';
      testBtn.innerHTML = '<span>ğŸ§ª</span><span>Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠ</span>';
      testBtn.style.marginTop = '10px';
      testBtn.onclick = () => {
        if (!gameStarted) {
          addPlayer(`ØªØ¬Ø±ÙŠØ¨ÙŠ_${Math.floor(Math.random() * 1000)}`, 'manual');
        }
      };
      document.querySelector('.players-dropdown-content').appendChild(testBtn);
    }

    init();
  </script>
</body>
</html>
