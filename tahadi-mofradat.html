<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ¯ ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <!-- tmi.js Ù„ØªÙˆÙŠØªØ´ -->
  <script src="tmi.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tmi.js@1.8.5/dist/tmi.min.js"></script>

  <style>
    :root{
      /* Ø£Ù„ÙˆØ§Ù† Ø³ØªØ§ÙŠÙ„2026 */
      --bg:#15171d;
      --bg-soft:#1b1e26;
      --panel:rgba(26,29,38,0.96);
      --panel-soft:rgba(24,27,36,0.9);
      --accent:#ff3333;
      --accent-soft:rgba(255,51,51,0.18);
      --accent-strong:#ff5555;
      --line:#2a2f3b;
      --text-main:#f5f7ff;
      --text-muted:#9ca3af;
      --good:#22c55e;
      --warn:#facc15;
      --bad:#f97373;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      min-height:100vh;
      font-family:'Cairo',sans-serif;
      background:
        radial-gradient(circle at top left, #262b3a 0, transparent 55%),
        radial-gradient(circle at bottom right, #1e2635 0, transparent 55%),
        linear-gradient(135deg,#0d0f16,#12141b 45%,#181b24 80%,#10121a);
      color:var(--text-main);
      padding:16px;
    }
    .page{
      max-width:1400px;
      margin:0 auto;
      position:relative;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom:16px;
    }
    .title-area h1{
      font-size:26px;
      color:var(--accent);
      margin-bottom:4px;
    }
    .title-area p{
      font-size:13px;
      color:var(--text-muted);
    }

    .pill{
      padding:6px 12px;
      border-radius:999px;
      background:rgba(15,23,42,0.85);
      border:1px solid rgba(148,163,184,0.35);
      font-size:12px;
      color:var(--text-muted);
      display:inline-flex;
      align-items:center;
      gap:6px;
      white-space:nowrap;
    }
    .pill span.dot{
      width:8px;height:8px;border-radius:50%;
      background:var(--bad);
      box-shadow:0 0 6px rgba(248,113,113,0.8);
    }
    .pill.connected span.dot{
      background:var(--good);
      box-shadow:0 0 6px rgba(34,197,94,0.8);
    }

    /* Ø²Ø± Ø§Ù„Ø´Ø±Ø­ ÙˆØ³Ø· ÙÙˆÙ‚ */
    .help-btn{
      position:absolute;
      top:16px;
      left:50%;
      transform:translateX(-50%);
      z-index:50;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(15,23,42,0.9);
      border:1px solid rgba(148,163,184,0.5);
      font-size:12px;
      color:var(--text-muted);
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
      backdrop-filter:blur(10px);
    }
    @media(max-width:900px){
      .help-btn{
        top:8px;
        left:auto;
        right:8px;
        transform:none;
      }
    }

    main.layout{
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .panel{
      background:var(--panel);
      border-radius:16px;
      padding:14px 14px 16px;
      border:1px solid rgba(148,163,184,0.25);
      box-shadow:0 18px 40px rgba(0,0,0,0.5);
      backdrop-filter:blur(18px);
    }

    h2{
      font-size:16px;
      margin-bottom:8px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    h2 span.icon{font-size:17px}
    small{font-size:11px;color:var(--text-muted);}

    .field{
      margin-top:10px;
      display:flex;
      flex-direction:column;
      gap:4px;
      font-size:13px;
    }
    .field label{color:var(--text-muted);}
    .field input[type="text"],
    .field input[type="number"],
    .field select{
      background:var(--bg-soft);
      border-radius:10px;
      border:1px solid var(--line);
      padding:7px 10px;
      color:var(--text-main);
      font-family:'Cairo',sans-serif;
      font-size:13px;
      outline:none;
      transition:border-color .15s, box-shadow .15s, background .15s;
    }
    .field input:focus,
    .field select:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 1px rgba(248,113,113,0.4);
    }

    button{
      border:none;
      border-radius:999px;
      padding:7px 14px;
      font-family:'Cairo',sans-serif;
      font-size:13px;
      cursor:pointer;
      transition:background .15s,transform .08s,box-shadow .12s,opacity .15s;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    button.primary{
      background:linear-gradient(135deg,var(--accent),var(--accent-strong));
      color:#fff;
      box-shadow:0 10px 24px rgba(248,113,113,0.4);
    }
    button.primary:hover{
      transform:translateY(-1px);
      box-shadow:0 14px 28px rgba(248,113,113,0.55);
    }
    button.soft{
      background:rgba(15,23,42,0.9);
      color:var(--text-muted);
      border:1px solid rgba(148,163,184,0.35);
    }
    button.soft:hover{background:rgba(30,41,59,0.9);}
    button.danger{
      background:rgba(248,113,113,0.1);
      color:var(--bad);
      border:1px solid rgba(248,113,113,0.35);
    }
    button.danger:hover{background:rgba(248,113,113,0.18);}
    button.small{padding:5px 10px;font-size:12px;}
    button:disabled{
      opacity:.5;cursor:not-allowed;transform:none;box-shadow:none;
    }

    .divider{
      margin:10px 0;
      border-top:1px dashed rgba(55,65,81,0.8);
    }

    .hint{
      margin-top:6px;
      font-size:11px;
      color:var(--text-muted);
      line-height:1.5;
    }

    /* Ù†Ø®ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù†ØµÙŠØ© (Ø§Ù„Ù…Ù†Ø·Ù‚ ÙÙ‚Ø· ÙŠØ¨Ù‚Ù‰) */
    .players-list{display:none;}

    /* Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (ÙÙˆÙ‚ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù„Ø¹Ø¨Ø© â€“ Ø®Ø§Ø±Ø¬Ù‡Ø§) */
    .control-panel{
      max-width:1100px;
      margin:0 auto;
    }

    /* Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆÙ‚Øª Ø§Ù„Ø¯ÙˆØ± + Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… */
    .control-row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:flex-end;
    }

    /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ */
    .cards-row{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:6px;
      min-height:40px;
    }
    .card{
  min-width:44px;
  padding:8px 12px;
  border-radius:14px;
  background:radial-gradient(circle at top,#1f2937 0,transparent 60%),
             linear-gradient(145deg,rgba(15,23,42,0.96),rgba(11,15,25,0.98));
  border:1px solid rgba(148,163,184,0.7);
  text-align:center;
  font-size:22px;       /* â† Ø®Ø· Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ØµØ§Ø± Ø£ÙƒØ¨Ø± */
  font-weight:900;      /* â† Ø³Ù…Ø§ÙƒØ© Ø£ÙƒØ¨Ø± */
  user-select:none;
}
.card.star{
  border-color:var(--warn);
  box-shadow:0 0 14px rgba(250,204,21,0.55);
}

    .card.star{
      border-color:var(--warn);
      box-shadow:0 0 12px rgba(250,204,21,0.5);
    }

    .current-row-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:12px;
      color:var(--text-muted);
      margin-bottom:4px;
    }
    .current-row-header span.name{font-weight:700;color:#e5e7eb;}
    .current-row-header span.cards{font-size:11px;}

    .status-bar{
      margin-top:6px;
      font-size:11px;
      color:var(--text-muted);
      min-height:16px;
    }
    .status-bar span.ok{color:var(--good);}
    .status-bar span.err{color:var(--bad);}

    .label-badge{
      margin-top:6px;
      padding:2px 7px;
      border-radius:999px;
      background:rgba(15,23,42,0.9);
      border:1px solid rgba(148,163,184,0.5);
      font-size:11px;
      color:var(--text-muted);
      display:inline-flex;
      align-items:center;
      gap:4px;
    }
    .label-badge strong{color:#e5e7eb;}

    /* Ø§Ù„ÙƒÙ„Ù…Ø© + Ø§Ù„ØªØ§ÙŠÙ…Ø± + Ø§Ù„Ù‚Ø±Ø§Ø± Ø¯Ø§Ø®Ù„ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù„Ø¹Ø¨Ø© */
    .in-game-header{
      width:100%;
      max-width:650px;
      margin:0 auto 8px auto;
    }
    .top-control-row{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .badge-panel{
      flex:1;
      min-width:220px;
      padding:8px 10px;
      border-radius:14px;
      background:rgba(15,23,42,0.96);
      border:1px solid rgba(148,163,184,0.55);
      box-shadow:0 10px 25px rgba(0,0,0,0.6);
      font-size:11px;
      color:var(--text-muted);
      backdrop-filter:blur(12px);
    }
    .badge-panel-title{
      font-size:12px;
      font-weight:700;
      color:#e5e7eb;
      margin-bottom:4px;
      display:flex;
      align-items:center;
      gap:4px;
    }
    .badge-panel-title span.icon{font-size:13px;}

    .badge-panel .field{margin-top:6px;}
    .badge-panel .field-inline{
      display:flex;
      gap:6px;
      align-items:flex-end;
      margin-top:4px;
    }
    .badge-panel .field-inline .field{flex:1;margin-top:0;}
    .badge-panel .decision-buttons{
      display:flex;
      gap:6px;
      margin-top:6px;
    }
    .badge-panel .decision-buttons button{
      flex:1;
      font-weight:700;
    }

    .timer-box{
      width:120px;
      height:120px;
      border-radius:50%;
      border:3px solid var(--line);
      background:rgba(15,23,42,0.96);
      display:flex;
      align-items:center;
      justify-content:center;
      flex-shrink:0;
      box-shadow:0 10px 30px rgba(0,0,0,0.7);
    }
    .timer-box span{
      font-size:50px;
      font-weight:800;
      color:var(--text-muted);
    }

    /* Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù„Ø¹Ø¨Ø© */
    .center-panel{
      position:relative;
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:center;
    }
    .table{
      position:relative;
      width:100%;
      max-width:650px;
      aspect-ratio:1/1;
      margin:0 auto;
    }

    .center-word-card{
      position:absolute;
      left:50%;
      top:50%;
      transform:translate(-50%,-50%);
      min-width:210px;
      max-width:280px;
      padding:10px 12px 12px;
      border-radius:18px;
      background:
        radial-gradient(circle at top,#1f2937 0,transparent 60%),
        linear-gradient(145deg,rgba(15,23,42,0.96),rgba(11,15,25,0.98));
      border:1px solid rgba(148,163,184,0.65);
      box-shadow:0 16px 40px rgba(0,0,0,0.7);
      text-align:center;
    }
    .center-word-label{
      font-size:11px;
      color:var(--text-muted);
      margin-bottom:4px;
    }
    .center-word{
      font-size:22px;
      font-weight:800;
      letter-spacing:1px;
      color:#fff;
      margin-bottom:4px;
      min-height:26px;
    }
    .center-word-sub{
      font-size:11px;
      color:var(--text-muted);
    }

    .turn-indicator{
      margin-top:6px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      font-size:11px;
      color:var(--text-muted);
    }
    .turn-indicator span.player-name{
      color:#e5e7eb;
      font-weight:700;
    }
    .turn-indicator span.timer{
      padding:2px 8px;
      border-radius:999px;
      background:rgba(15,23,42,0.9);
      border:1px solid rgba(148,163,184,0.5);
      font-variant-numeric:tabular-nums;
    }

    .proposed-block{
      margin-top:8px;
      padding-top:6px;
      border-top:1px dashed rgba(55,65,81,0.9);
      display:none;
    }
    .proposed-label{
      font-size:11px;
      color:var(--text-muted);
      margin-bottom:3px;
    }
    .proposed-word{
      font-size:17px;
      font-weight:700;
      color:#e5e7eb;
      margin-bottom:6px;
      min-height:22px;
    }
    .proposed-meta{
      font-size:10px;
      color:var(--text-muted);
      margin-bottom:4px;
    }

    .players-ring{
      position:absolute;
      inset:0;
    }
    .player-node{
      position:absolute;
      transform:translate(-50%,-50%);
      min-width:120px;
      max-width:150px;
      padding:7px 8px;
      border-radius:999px;
      background:rgba(15,23,42,0.96);
      border:1px solid rgba(148,163,184,0.55);
      box-shadow:0 10px 26px rgba(0,0,0,0.65);
      display:flex;
      flex-direction:column;
      gap:2px;
      font-size:11px;
    }
    .player-node-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:4px;
    }
    .player-node-name{
      font-weight:700;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .player-node-cards-count{
      padding:1px 6px;
      border-radius:999px;
      background:rgba(15,23,42,0.95);
      border:1px solid rgba(148,163,184,0.6);
      color:var(--text-muted);
      font-size:10px;
    }
    .player-node-cards-count strong{color:var(--accent);}
    .player-node-status{
      font-size:10px;
      color:var(--text-muted);
    }
    .player-node.active{
      border-color:var(--accent);
      box-shadow:0 0 0 1px rgba(248,113,113,0.7),0 14px 30px rgba(248,113,113,0.45);
      background:linear-gradient(135deg,rgba(15,23,42,0.98),rgba(30,64,175,0.95));
    }
    .player-node.active .player-node-name{color:#fff;}
    .player-node.winner{
      border-color:var(--good);
      box-shadow:0 0 0 1px rgba(34,197,94,0.8),0 12px 30px rgba(22,163,74,0.5);
      background:linear-gradient(135deg,rgba(6,95,70,0.95),rgba(21,128,61,0.98));
    }
    .player-node.winner .player-node-status{
      color:#bbf7d0;
      font-weight:600;
    }

    .winner-banner{
      margin-top:8px;
      padding:7px 9px;
      border-radius:12px;
      background:linear-gradient(135deg,rgba(21,128,61,0.95),rgba(22,163,74,0.98));
      color:#e5f9ee;
      font-size:13px;
      display:none;
      max-width:650px;
      margin-inline:auto;
      text-align:center;
    }
    .winner-banner span.name{font-weight:800;}

    /* Ù„ÙˆØ­Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø© */
    .bottom-panel h2{margin-bottom:6px;}
    .connection-row{
      display:flex;
      gap:6px;
      align-items:flex-end;
      flex-wrap:wrap;
    }
    .connection-row .field{
      margin-top:0;
      min-width:120px;
      flex:1;
    }
    .connection-status{
      margin-top:6px;
      font-size:11px;
      color:var(--text-muted);
    }
    .connection-status span.platform{
      color:#e5e7eb;
      font-weight:600;
    }

    /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø´Ø±Ø­ */
    .help-modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.65);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:100;
    }
    .help-modal-backdrop.active{display:flex;}
    .help-modal{
      max-width:520px;
      width:100%;
      margin:16px;
      background:var(--panel-soft);
      border-radius:18px;
      border:1px solid rgba(148,163,184,0.4);
      box-shadow:0 20px 45px rgba(0,0,0,0.8);
      padding:14px 14px 16px;
    }
    .help-modal-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:6px;
    }
    .help-modal-header h3{
      font-size:18px;
      color:var(--accent);
    }
    .help-modal-close{
      border:none;
      background:transparent;
      color:var(--text-muted);
      font-size:18px;
      cursor:pointer;
    }
    .help-modal-body{
      font-size:13px;
      color:var(--text-main);
      line-height:1.7;
      max-height:60vh;
      overflow:auto;
    }
    .help-modal-body h4{
      font-size:14px;
      margin-top:8px;
      margin-bottom:4px;
      color:#e5e7eb;
    }
    .help-modal-body ul{
      padding-right:18px;
      margin:0;
    }
    .help-modal-body li{
      margin-bottom:4px;
      color:var(--text-muted);
    }
    .help-modal-body code{
      background:rgba(15,23,42,0.9);
      padding:1px 4px;
      border-radius:6px;
      font-family:monospace;
      font-size:12px;
      direction:ltr;
      unicode-bidi:plaintext;
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- Ø²Ø± Ø´Ø±Ø­ Ø§Ù„Ù„Ø¹Ø¨Ø© -->
    <button class="help-btn" id="helpBtn">â„¹ï¸ Ø´Ø±Ø­ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>

    <header>
      <div class="title-area">
        <h1>ğŸ¯ ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª</h1>
        <p>ÙƒÙ„ Ù„Ø§Ø¹Ø¨ Ù„Ø­Ø§Ù„Ù‡ØŒ Ù…Ù† Ù¨ Ø¨Ø·Ø§Ù‚Ø§ØªØŒ ÙˆØ£ÙˆÙ„ ÙˆØ§Ø­Ø¯ ÙŠØ®Ù„Ù‘Øµ Ø¨Ø·Ø§Ù‚Ø§ØªÙ‡ ÙŠÙÙˆØ² â€” Ø§Ù„ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„ Ø¨ÙŠØ¯Ùƒ ÙŠØ§ Ø³ØªØ±ÙŠÙ…Ø±.</p>
      </div>
      <div class="pill" id="connectionPill">
        <span class="dot"></span>
        <span id="connectionPillText">ØºÙŠØ± Ù…ØªØµÙ„ â€” Ø§Ø±Ø¨Ø· Ø§Ù„Ø´Ø§Øª Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ø§ØªØµØ§Ù„</span>
      </div>
    </header>

    <main class="layout">
      <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (ÙÙˆÙ‚ â€“ Ø®Ø§Ø±Ø¬ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù„Ø¹Ø¨Ø©) -->
      <section class="panel control-panel">
        <h2><span class="icon">ğŸ›ï¸</span> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
        <small>Ù…Ù† Ù‡Ù†Ø§ ØªØªØ­ÙƒÙ… Ø¨ÙˆÙ‚Øª Ø§Ù„Ø¯ÙˆØ± ÙˆØ¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±.</small>

        <div class="divider"></div>

        <div class="control-row">
          <div style="flex:1;min-width:200px;">
            <div class="field">
              <label for="turnSecondsInput">Ù…Ø¯Ø© Ø§Ù„Ø¯ÙˆØ± (Ø«ÙˆØ§Ù†ÙŠ)</label>
              <input id="turnSecondsInput" type="number" min="5" max="300" value="30" />
            </div>
            <button class="soft small" id="updateTurnSecondsBtn" style="margin-top:6px;">ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª</button>
            <div class="hint">
              Ø£ÙŠ Ø¯ÙˆØ± Ø¬Ø¯ÙŠØ¯ Ø³ÙŠØ³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙŠÙ…Ø©. Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ <strong>30 Ø«Ø§Ù†ÙŠØ©</strong>.
            </div>
          </div>

          <div style="flex:1.4;min-width:260px;">
            <div style="font-size:12px;color:var(--text-muted);margin-bottom:4px;">Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø³Ø±ÙŠØ¹ Ø¨Ø§Ù„Ø¯ÙˆØ±</div>
            <div style="display:flex;flex-wrap:wrap;gap:6px;">
              <button class="primary small" id="startGameBtn">ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</button>
              <button class="soft small" id="nextPlayerBtn">â­ï¸ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„ØªØ§Ù„ÙŠ</button>
              <button class="soft small" id="restartTurnBtn">ğŸ” Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¤Ù‚Øª Ù„Ù†ÙØ³ Ø§Ù„Ù„Ø§Ø¹Ø¨</button>
              <button class="danger small" id="stopTimerBtn">â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª</button>
            </div>
            <div class="hint">
              Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙŠØ¯Ø®Ù„ÙˆÙ† Ù…Ù† Ø§Ù„ØªØ´Ø§Øª Ø¨Ù€ <strong>!Ø¯Ø®ÙˆÙ„</strong> Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡. Ø¨Ø¹Ø¯ Ø§Ù„Ø¨Ø¯Ø¡ ÙŠØ³ØªØ®Ø¯Ù…ÙˆÙ†:
              <strong>!Ù…ÙƒØ§Ù†_Ø§Ù„Ø­Ø±Ù Ø±Ù‚Ù…_Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</strong> (Ù…Ø«Ø§Ù„: <strong>!1 5</strong>).
            </div>
          </div>
        </div>
      </section>

      <!-- Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù„Ø¹Ø¨Ø© ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ -->
      <section class="panel center-panel">
        <!-- Ø§Ù„ÙƒÙ„Ù…Ø© + Ø§Ù„ØªØ§ÙŠÙ…Ø± + Ø§Ù„Ù‚Ø±Ø§Ø± Ø¯Ø§Ø®Ù„ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù„Ø¹Ø¨Ø© -->
        <div class="in-game-header">
          <div class="top-control-row">
            <!-- Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙŠÙ…ÙŠÙ† -->
            <div class="badge-panel">
              <div class="badge-panel-title">
                <span class="icon">ğŸ“</span>
                <span>Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</span>
              </div>
              <div class="field-inline">
                <div class="field">
                  <label for="initialWordInput">Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</label>
                  <input id="initialWordInput" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù…ÙˆØ²" />
                </div>
                <button class="soft small" id="setInitialWordBtn">ØªØ¹ÙŠÙŠÙ†</button>
              </div>
            </div>

            <!-- Ø§Ù„ØªØ§ÙŠÙ…Ø± ÙÙŠ Ø§Ù„ÙˆØ³Ø· -->
            <div class="timer-box">
              <span id="bigTimerValue">--</span>
            </div>

            <!-- Ù‚Ø±Ø§Ø± Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© ÙŠØ³Ø§Ø± -->
            <div class="badge-panel">
              <div class="badge-panel-title">
                <span class="icon">âœ…</span>
                <span>Ù‚Ø±Ø§Ø± Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</span>
              </div>
              <div class="decision-buttons">
                <button class="primary small" id="centerAcceptBtn">Ù‚Ø¨ÙˆÙ„</button>
                <button class="danger small" id="centerRejectBtn">Ø±ÙØ¶</button>
              </div>
              <div class="hint" style="font-size:10px;">
                Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© ØªØ¸Ù‡Ø± ÙÙŠ ÙˆØ³Ø· Ø§Ù„Ø·Ø§ÙˆÙ„Ø©ØŒ ÙˆÙ…Ù† Ù‡Ù†Ø§ ØªÙ‚Ø±Ø± Ù‚Ø¨ÙˆÙ„Ù‡Ø§ Ø£Ùˆ Ø±ÙØ¶Ù‡Ø§.
              </div>
            </div>
          </div>
        </div>

        <div class="divider" style="max-width:650px;width:100%;margin:10px auto;"></div>

        <div class="table">
          <div class="center-word-card">
            <div class="center-word-label">Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</div>
            <div class="center-word" id="centerWord">â€” â€” â€”</div>
            <div class="center-word-sub">ØªØªØ¹ÙŠÙ‘Ù† Ù…Ù† Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</div>

            <div class="turn-indicator">
              <span>Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠ:</span>
              <span class="player-name" id="turnPlayerName">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span>
              <span class="timer" id="turnTimer">-- Ø«Ø§Ù†ÙŠØ©</span>
            </div>

            <div class="proposed-block" id="proposedBlock">
              <div class="proposed-label">Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© Ù…Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨:</div>
              <div class="proposed-word" id="proposedWordText">â€”</div>
              <div class="proposed-meta" id="proposedMeta">â€”</div>
            </div>
          </div>

          <div class="players-ring" id="playersRing"></div>
        </div>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ÙØ§Ø¦Ø² -->
        <div class="winner-banner" id="winnerBanner">
          Ø§Ù„ÙØ§Ø¦Ø² ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØ­Ø¯ÙŠ Ù‡Ùˆ: <span class="name" id="winnerName">â€”</span> ğŸ‰
        </div>

        <!-- Ø®Ø· ÙØ§ØµÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø·Ø§ÙˆÙ„Ø© ÙˆØ­Ø±ÙˆÙ Ø§Ù„Ù„Ø§Ø¹Ø¨ -->
        <div class="divider" style="max-width:650px;width:100%;margin:10px auto;"></div>

        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ + Ø§Ù„Ø­Ø±ÙˆÙ Ø¯Ø§Ø®Ù„ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù„Ø¹Ø¨Ø© -->
        <div style="max-width:650px;width:100%;margin:0 auto;">
          <div class="current-row-header">
            <span class="name" id="currentPlayerName">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ Ù†Ø´Ø·</span>
            <span class="cards" id="currentPlayerCardsInfo">â€” Ø¨Ø·Ø§Ù‚Ø§Øª</span>
          </div>
          <div class="cards-row" id="currentPlayerCardsRow">
            <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ -->
          </div>
          <div class="status-bar" id="statusBar">
            Ø£Ø¶ÙÙ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ù† Ø§Ù„ØªØ´Ø§Øª Ø«Ù… Ø¹ÙŠÙ‘Ù† Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙˆØ§Ø¶ØºØ· "Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©".
          </div>
          <div class="label-badge">
            Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ:
            <strong id="currentPlayerLabel">Ù„Ø§ ÙŠÙˆØ¬Ø¯</strong>
          </div>
        </div>

        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù†ØµÙŠØ© (Ù…Ù†Ø·Ù‚ ÙÙ‚Ø·) -->
        <div id="playersList" class="players-list"></div>
      </section>

      <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø© -->
      <section class="panel bottom-panel">
        <h2><span class="icon">ğŸ”Œ</span> Ù„ÙˆØ­Ø© Ø§Ù„Ø§ØªØµØ§Ù„</h2>
        <small>Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØµØ© ÙˆØ§Ø±Ø¨Ø· Ø§Ù„Ø´Ø§Øª. Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©: <strong>!Ø¯Ø®ÙˆÙ„</strong> Ùˆ <strong>!Ù…ÙƒØ§Ù†_Ø§Ù„Ø­Ø±Ù Ø±Ù‚Ù…_Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</strong>.</small>

        <div class="connection-row" style="margin-top:8px;">
          <div class="field">
            <label for="platformSelect">Ø§Ù„Ù…Ù†ØµØ©</label>
            <select id="platformSelect">
              <option value="twitch">Twitch</option>
              <option value="kick">Kick</option>
            </select>
          </div>
          <div class="field">
            <label for="channelInput">Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø©</label>
            <input id="channelInput" type="text" placeholder="Ù…Ø«Ø§Ù„: medo_dv" />
          </div>
          <button class="primary small" id="connectBtn">Ø§ØªØµØ§Ù„</button>
        </div>
        <div class="connection-status" id="connectionStatus">
          ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ø£ÙŠ Ù…Ù†ØµØ© Ø­Ø§Ù„ÙŠÙ‹Ø§.
        </div>
      </section>
    </main>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø´Ø±Ø­ Ø§Ù„Ù„Ø¹Ø¨Ø© -->
  <div class="help-modal-backdrop" id="helpModalBackdrop">
    <div class="help-modal">
      <div class="help-modal-header">
        <h3>Ø´Ø±Ø­ Ù„Ø¹Ø¨Ø© ØªØ­Ø¯Ù‘ÙŠ Ø§Ù„Ù…ÙØ±Ø¯Ø§Øª</h3>
        <button class="help-modal-close" id="helpModalClose">&times;</button>
      </div>
      <div class="help-modal-body">
        <h4>ğŸ¯ ÙÙƒØ±Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©</h4>
        <p>Ù„Ø¹Ø¨Ø© Ø¨Ø·Ø§Ù‚Ø§Øª Ù„ØºÙˆÙŠØ© Ø¨ÙŠÙ† Ù„Ø§Ø¹Ø¨ÙŠÙ†ØŒ ÙƒÙ„ Ù„Ø§Ø¹Ø¨ Ù…Ø¹Ù‡ Ù¨ Ø¨Ø·Ø§Ù‚Ø§Øª Ø­Ø±ÙˆÙ (Ø¨Ø¹Ø¶Ù‡Ø§ Ù†Ø¬Ù…Ø© â­)ØŒ ÙˆÙŠØªÙ†Ø§ÙØ³ÙˆÙ† Ø¹Ù„Ù‰ ØªÙƒÙˆÙŠÙ† ÙƒÙ„Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø­Ø±Ù ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· ÙÙŠ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©. Ø£ÙˆÙ„ Ù„Ø§Ø¹Ø¨ ÙŠØ®Ù„Ù‘Øµ ÙƒÙ„ Ø¨Ø·Ø§Ù‚Ø§ØªÙ‡ Ù‡Ùˆ Ø§Ù„ÙØ§Ø¦Ø².</p>

        <h4>ğŸ§© Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</h4>
        <ul>
          <li>Ù…Ù† Ø§Ù„Ø´Ø§Øª (Twitch / Kick): ÙŠÙƒØªØ¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ <code>!Ø¯Ø®ÙˆÙ„</code></li>
          <li>Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù…ØªØ§Ø­ ÙÙ‚Ø· <strong>Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</strong>.</li>
        </ul>

        <h4>ğŸ´ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</h4>
        <ul>
          <li>ÙƒÙ„ Ù„Ø§Ø¹Ø¨ ÙŠØ£Ø®Ø° <strong>Ù¨ Ø¨Ø·Ø§Ù‚Ø§Øª</strong> Ø­Ø±ÙˆÙ Ø¹Ø±Ø¨ÙŠØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©.</li>
          <li>Ø¨Ø¹Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù‚Ø¯ ØªÙƒÙˆÙ† Ù†Ø¬Ù…Ø© <strong>â­</strong> ÙˆØªÙ…Ø«Ù„ Ø£ÙŠ Ø­Ø±Ù.</li>
        </ul>

        <h4>ğŸ“ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h4>
        <ul>
          <li>Ø§Ù„Ø³ØªØ±ÙŠÙ…Ø± ÙŠØ¶Ø¹ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…Ù† Ø¯Ø§Ø®Ù„ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù„Ø¹Ø¨Ø© (ÙŠÙ…ÙŠÙ† Ø§Ù„ØªØ§ÙŠÙ…Ø±).</li>
          <li>Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙ„Ù…Ø© ØªØ¸Ù‡Ø± ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„Ø·Ø§ÙˆÙ„Ø© ÙˆÙŠØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ø®Ù„Ø§Ù„ Ø§Ù„Ù„Ø¹Ø¨.</li>
        </ul>

        <h4>âŒ¨ï¸ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù„Ø¹Ø¨ Ù…Ù† Ø§Ù„ØªØ´Ø§Øª</h4>
        <p>Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙˆÙ† Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ØŒ ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„ØµÙŠØºØ©:</p>
        <p><code>!Ù…ÙƒØ§Ù†_Ø§Ù„Ø­Ø±Ù Ø±Ù‚Ù…_Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</code></p>
        <ul>
          <li><code>!1 5</code> â†’ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ <strong>Ø§Ù„Ø­Ø±Ù Ø§Ù„Ø£ÙˆÙ„</strong> Ù…Ù† Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ø§Ù„Ø­Ø±Ù Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ <strong>Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø±Ù‚Ù… 5</strong>.</li>
        </ul>

        <h4>âœ… / âŒ Ù‚Ø¨ÙˆÙ„ ÙˆØ±ÙØ¶ Ø§Ù„ÙƒÙ„Ù…Ø©</h4>
        <ul>
          <li>Ø¹Ù†Ø¯Ù…Ø§ ÙŠØ±Ø³Ù„ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø£Ù…Ø±Ù‡ØŒ ÙŠØªÙ… Ø§Ù‚ØªØ±Ø§Ø­ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ ÙˆØ³Ø· Ø§Ù„Ø´Ø§Ø´Ø© ØªØ­Øª Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©.</li>
          <li>Ø§Ù„Ø³ØªØ±ÙŠÙ…Ø± ÙŠÙ‚Ø±Ø± Ù…Ù† Ù…Ø±Ø¨Ø¹ "Ù‚Ø±Ø§Ø± Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©" ÙŠØ³Ø§Ø± Ø§Ù„ØªØ§ÙŠÙ…Ø±:
            <ul>
              <li><strong>Ù‚Ø¨ÙˆÙ„</strong> â†’ ØªØ«Ø¨ÙŠØª Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© + Ø­Ø°Ù Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© + Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù‘Ø§Ø¹Ø¨ Ø§Ù„ØªØ§Ù„ÙŠ.</li>
              <li><strong>Ø±ÙØ¶</strong> â†’ ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØªØºÙŠÙŠØ± ÙˆØ§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù‘Ø§Ø¹Ø¨ Ø§Ù„ØªØ§Ù„ÙŠ.</li>
            </ul>
          </li>
        </ul>

        <h4>ğŸ† Ø§Ù„ÙÙˆØ²</h4>
        <ul>
          <li>Ø£ÙˆÙ„ Ù„Ø§Ø¹Ø¨ ÙŠØ®Ù„Ù‘Øµ ÙƒÙ„ Ø¨Ø·Ø§Ù‚Ø§ØªÙ‡ ÙŠØµØ¨Ø­ Ø§Ù„ÙØ§Ø¦Ø².</li>
          <li>ÙŠØ¸Ù‡Ø± Ø´Ø±ÙŠØ· ÙÙˆØ² Ø£Ø®Ø¶Ø± Ø¨Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ ØªØ­Øª Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù„Ø¹Ø¨Ø©.</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    // ===== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¹Ø§Ù…Ø© =====
    const MAX_PLAYERS = 10;
    const CARDS_PER_PLAYER = 8;

    const ARABIC_LETTERS = [
      'Ø§','Ø¨','Øª','Ø«','Ø¬','Ø­','Ø®','Ø¯','Ø°','Ø±','Ø²','Ø³','Ø´',
      'Øµ','Ø¶','Ø·','Ø¸','Ø¹','Øº','Ù','Ù‚','Ùƒ','Ù„','Ù…','Ù†','Ù‡','Ùˆ','ÙŠ'
    ];

    // players: {key, name, platform, cards:[], isWinner:false}
    let players = [];
    let currentPlayerIndex = -1;
    let turnSeconds = 30;
    let timerId = null;
    let remainingSeconds = 0;
    let gameStarted = false;
    let winnerFound = false;

    // pendingSuggestion: {playerIndex, cardIndex, word, position, fromPlatform, fromName}
    let pendingSuggestion = null;

    // Ø§ØªØµØ§Ù„
    let activePlatform = null;      // 'twitch' | 'kick' | null
    let activeChannel = null;
    let twitchClient = null;
    let kickSocket = null;

    // Ø¹Ù†Ø§ØµØ± DOM
    const playersListEl = document.getElementById('playersList');

    const initialWordInput = document.getElementById('initialWordInput');
    const setInitialWordBtn = document.getElementById('setInitialWordBtn');
    const centerWordEl = document.getElementById('centerWord');

    const playersRingEl = document.getElementById('playersRing');
    const turnPlayerNameEl = document.getElementById('turnPlayerName');
    const turnTimerEl = document.getElementById('turnTimer');

    const platformSelect = document.getElementById('platformSelect');
    const channelInput = document.getElementById('channelInput');
    const connectBtn = document.getElementById('connectBtn');
    const connectionStatusEl = document.getElementById('connectionStatus');
    const connectionPill = document.getElementById('connectionPill');
    const connectionPillText = document.getElementById('connectionPillText');

    const turnSecondsInput = document.getElementById('turnSecondsInput');
    const updateTurnSecondsBtn = document.getElementById('updateTurnSecondsBtn');
    const startGameBtn = document.getElementById('startGameBtn');
    const nextPlayerBtn = document.getElementById('nextPlayerBtn');
    const restartTurnBtn = document.getElementById('restartTurnBtn');
    const stopTimerBtn = document.getElementById('stopTimerBtn');

    const currentPlayerLabelEl = document.getElementById('currentPlayerLabel');
    const currentPlayerNameEl = document.getElementById('currentPlayerName');
    const currentPlayerCardsInfoEl = document.getElementById('currentPlayerCardsInfo');
    const currentPlayerCardsRowEl = document.getElementById('currentPlayerCardsRow');

    const statusBarEl = document.getElementById('statusBar');

    const winnerBannerEl = document.getElementById('winnerBanner');
    const winnerNameEl = document.getElementById('winnerName');

    const proposedBlockEl = document.getElementById('proposedBlock');
    const proposedWordTextEl = document.getElementById('proposedWordText');
    const proposedMetaEl = document.getElementById('proposedMeta');
    const centerAcceptBtn = document.getElementById('centerAcceptBtn');
    const centerRejectBtn = document.getElementById('centerRejectBtn');

    const helpBtn = document.getElementById('helpBtn');
    const helpModalBackdrop = document.getElementById('helpModalBackdrop');
    const helpModalClose = document.getElementById('helpModalClose');

    const bigTimerValueEl = document.getElementById('bigTimerValue');

    // ===== ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¹Ø§Ù…Ø© =====
    function setStatus(message,type='info'){
      console.log('[STATUS]', type, message);
      if(type === 'ok'){
        statusBarEl.innerHTML = `<span class="ok">${message}</span>`;
      }else if(type === 'err'){
        statusBarEl.innerHTML = `<span class="err">${message}</span>`;
      }else{
        statusBarEl.textContent = message;
      }
    }

    function randomCard(){
      const r = Math.random();
      if(r < 0.12){
        return 'â­';
      }
      const idx = Math.floor(Math.random()*ARABIC_LETTERS.length);
      return ARABIC_LETTERS[idx];
    }

    function dealCardsToPlayers(){
      players.forEach(p=>{
        p.cards = [];
        for(let i=0;i<CARDS_PER_PLAYER;i++){
          p.cards.push(randomCard());
        }
        p.isWinner = false;
      });
      renderPlayersList();
    }

    function renderPlayersList(){
      if(!playersListEl) return;
      playersListEl.innerHTML = '';
      if(players.length === 0){
        const empty = document.createElement('div');
        empty.textContent = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†. Ø§Ø³ØªØ®Ø¯Ù… !Ø¯Ø®ÙˆÙ„ Ù…Ù† Ø§Ù„ØªØ´Ø§Øª.';
        playersListEl.appendChild(empty);
        return;
      }

      players.forEach((p,idx)=>{
        const item = document.createElement('div');
        const nameSpan = document.createElement('span');
        nameSpan.textContent = `${idx+1}. ${p.name} ${p.platform ? '('+p.platform+')' : ''}`;
        const badge = document.createElement('span');
        const cardsCount = p.cards ? p.cards.length : 0;
        badge.innerHTML = ` Ø¨Ø·Ø§Ù‚Ø§Øª: <strong>${cardsCount}</strong> / ${CARDS_PER_PLAYER}`;
        item.appendChild(nameSpan);
        item.appendChild(badge);
        playersListEl.appendChild(item);
      });
    }

    function layoutPlayersRing(){
      playersRingEl.innerHTML = '';
      const n = players.length;
      if(n === 0) return;

      const centerX = 50;
      const centerY = 50;
      const radius = 38;

      for(let i=0;i<n;i++){
        const angle = (2*Math.PI*i/n) - Math.PI/2;
        const x = centerX + radius*Math.cos(angle);
        const y = centerY + radius*Math.sin(angle);

        const p = players[i];
        const node = document.createElement('div');
        node.className = 'player-node';
        if(i === currentPlayerIndex && !winnerFound && gameStarted){
          node.classList.add('active');
        }
        if(p.isWinner){
          node.classList.add('winner');
        }

        node.style.left = `${x}%`;
        node.style.top = `${y}%`;

        const header = document.createElement('div');
        header.className = 'player-node-header';

        const nameEl = document.createElement('div');
        nameEl.className = 'player-node-name';
        nameEl.textContent = p.name;

        const cardsCountEl = document.createElement('div');
        cardsCountEl.className = 'player-node-cards-count';
        cardsCountEl.innerHTML = `ğŸ´ <strong>${p.cards.length}</strong>`;

        header.appendChild(nameEl);
        header.appendChild(cardsCountEl);

        const statusEl = document.createElement('div');
        statusEl.className = 'player-node-status';
        if(p.isWinner){
          statusEl.textContent = 'Ø§Ù„ÙØ§Ø¦Ø² ğŸ‰';
        }else if(i === currentPlayerIndex && gameStarted){
          statusEl.textContent = 'Ø¯ÙˆØ±Ù‡ Ø§Ù„Ø¢Ù†';
        }else{
          statusEl.textContent = 'ÙŠÙ†ØªØ¸Ø± Ø¯ÙˆØ±Ù‡';
        }

        node.appendChild(header);
        node.appendChild(statusEl);
        playersRingEl.appendChild(node);
      }
    }

    function renderCurrentPlayer(){
      currentPlayerCardsRowEl.innerHTML = '';

      if(currentPlayerIndex < 0 || currentPlayerIndex >= players.length){
        currentPlayerLabelEl.textContent = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
        currentPlayerNameEl.textContent = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ Ù†Ø´Ø·';
        currentPlayerCardsInfoEl.textContent = 'â€” Ø¨Ø·Ø§Ù‚Ø§Øª';
        return;
      }

      const p = players[currentPlayerIndex];
      currentPlayerLabelEl.textContent = p.name;
      currentPlayerNameEl.textContent = p.name;
      currentPlayerCardsInfoEl.textContent = `${p.cards.length} Ø¨Ø·Ø§Ù‚Ø© Ù…ØªØ¨Ù‚ÙŠØ©`;

      p.cards.forEach((cardChar,idx)=>{
        const cardEl = document.createElement('div');
        cardEl.className = 'card';
        if(cardChar === 'â­'){
          cardEl.classList.add('star');
        }
        cardEl.textContent = cardChar;
        cardEl.title = `Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø±Ù‚Ù… ${idx+1}`;
        currentPlayerCardsRowEl.appendChild(cardEl);
      });
    }

    function updateTimerHeader(){
      if(currentPlayerIndex < 0 || currentPlayerIndex >= players.length || !gameStarted){
        turnPlayerNameEl.textContent = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
        turnTimerEl.textContent = '-- Ø«Ø§Ù†ÙŠØ©';
        bigTimerValueEl.textContent = '--';
        bigTimerValueEl.style.color = 'var(--text-muted)';
        return;
      }
      const p = players[currentPlayerIndex];
      turnPlayerNameEl.textContent = p.name;
      turnTimerEl.textContent = `${remainingSeconds} Ø«Ø§Ù†ÙŠØ©`;
      bigTimerValueEl.textContent = remainingSeconds;

      let ratio = remainingSeconds / turnSeconds;
      let color;
      if(ratio >= 0.7){
        color = 'var(--good)';
      }else if(ratio >= 0.4){
        color = 'var(--warn)';
      }else{
        color = 'var(--bad)';
      }
      bigTimerValueEl.style.color = color;
    }

    function startTurnTimer(){
      clearInterval(timerId);
      remainingSeconds = turnSeconds;
      timerId = setInterval(()=>{
        remainingSeconds--;
        if(remainingSeconds < 0){
          clearInterval(timerId);
          timerId = null;
          setStatus('Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ØŒ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„ØªØ§Ù„ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.', 'err');
          clearPendingSuggestionUI();
          goToNextPlayer();
          return;
        }
        updateTimerHeader();
      },1000);
      updateTimerHeader();
    }

    function stopTurnTimer(){
      clearInterval(timerId);
      timerId = null;
      updateTimerHeader();
    }

    function goToNextPlayer(){
      if(!gameStarted || players.length === 0) return;
      if(winnerFound){
        stopTurnTimer();
        return;
      }

      let attempts = 0;
      const n = players.length;
      let idx = currentPlayerIndex;

      while(attempts < n){
        idx = (idx + 1) % n;
        if(players[idx].cards.length > 0){
          currentPlayerIndex = idx;
          layoutPlayersRing();
          renderCurrentPlayer();
          startTurnTimer();
          setStatus(`Ø§Ù„Ø¢Ù† Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨: ${players[idx].name}`, 'info');
          return;
        }
        attempts++;
      }

      stopTurnTimer();
      setStatus('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…ØªØ¨Ù‚ÙŠÙ† Ø¨Ø¨Ø·Ø§Ù‚Ø§Øª. Ø£Ø¹Ø¯ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©.', 'err');
    }

    function checkForWinner(player){
      if(player.cards.length === 0){
        player.isWinner = true;
        winnerFound = true;
        stopTurnTimer();
        layoutPlayersRing();
        winnerNameEl.textContent = player.name;
        winnerBannerEl.style.display = 'block';
        setStatus(`Ø§Ù„ÙØ§Ø¦Ø² ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆÙ„Ø© Ù‡Ùˆ: ${player.name}`, 'ok');
      }
    }

    // ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª =====
    function clearPendingSuggestionUI(){
      pendingSuggestion = null;
      proposedBlockEl.style.display = 'none';
      proposedWordTextEl.textContent = 'â€”';
      proposedMetaEl.textContent = 'â€”';
    }

    function showPendingSuggestion(){
      if(!pendingSuggestion){
        clearPendingSuggestionUI();
        return;
      }
      const p = players[pendingSuggestion.playerIndex];
      proposedBlockEl.style.display = 'block';
      proposedWordTextEl.textContent = pendingSuggestion.word;
      let meta = `Ù…Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨: ${p.name}`;
      if(pendingSuggestion.fromPlatform && pendingSuggestion.fromName){
        meta += ` (Ù…Ù† ${pendingSuggestion.fromPlatform}: ${pendingSuggestion.fromName})`;
      }
      meta += ` â€” Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø­Ø±Ù Ø±Ù‚Ù… ${pendingSuggestion.position} Ø¨Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø±Ù‚Ù… ${pendingSuggestion.cardIndex+1}`;
      if(p.cards[pendingSuggestion.cardIndex] === 'â­'){
        meta += ' (Ø¨Ø·Ø§Ù‚Ø© Ù†Ø¬Ù…Ø© â­ â€” ØªÙ…Ø«Ù„ Ø£ÙŠ Ø­Ø±Ù)';
      }
      proposedMetaEl.textContent = meta;
    }

    function acceptSuggestion(){
      if(!pendingSuggestion){
        setStatus('Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø© Ù…Ù‚ØªØ±Ø­Ø© Ù„Ù‚Ø¨ÙˆÙ„Ù‡Ø§.', 'err');
        return;
      }
      const {playerIndex, cardIndex, word} = pendingSuggestion;
      const p = players[playerIndex];

      if(cardIndex < 0 || cardIndex >= p.cards.length){
        setStatus('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© (Ø±Ø¨Ù…Ø§ ØªØºÙŠÙ‘Ø±Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª).', 'err');
        clearPendingSuggestionUI();
        return;
      }

      p.cards.splice(cardIndex,1);
      centerWordEl.textContent = word;

      renderPlayersList();
      layoutPlayersRing();
      renderCurrentPlayer();
      clearPendingSuggestionUI();

      setStatus(`ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„ÙƒÙ„Ù…Ø© "${word}" Ù„Ù„Ø§Ø¹Ø¨: ${p.name}`, 'ok');
      checkForWinner(p);

      if(!winnerFound){
        goToNextPlayer();
      }
    }

    function rejectSuggestion(){
      if(!pendingSuggestion){
        setStatus('Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø© Ù…Ù‚ØªØ±Ø­Ø© Ù„Ø±ÙØ¶Ù‡Ø§.', 'err');
        return;
      }
      const {playerIndex, word} = pendingSuggestion;
      const p = players[playerIndex];

      setStatus(`ØªÙ… Ø±ÙØ¶ Ø§Ù„ÙƒÙ„Ù…Ø© "${word}" Ù„Ù„Ø§Ø¹Ø¨: ${p.name}. Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„ØªØ§Ù„ÙŠ.`, 'err');
      clearPendingSuggestionUI();
      goToNextPlayer();
    }

    // ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† =====
    function makePlayerKey(platform, name){
      return `${platform || 'manual'}:${(name || '').toLowerCase()}`;
    }

    function findPlayerIndexByPlatformName(platform,name){
      const key = makePlayerKey(platform,name);
      return players.findIndex(p=>p.key === key);
    }

    function addPlayerByName(name, platform=null){
      if(players.length >= MAX_PLAYERS){
        setStatus(`ÙˆØµÙ„Øª Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ (${MAX_PLAYERS}) Ù…Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†.`, 'err');
        return null;
      }
      const key = makePlayerKey(platform,name);
      if(players.some(p=>p.key === key)){
        setStatus(`Ø§Ù„Ù„Ø§Ø¹Ø¨ ${name} Ù…Ø³Ø¬Ù‘Ù„ Ø¨Ø§Ù„ÙØ¹Ù„.`, 'info');
        return null;
      }
      const p = {
        key,
        name,
        platform,
        cards:[],
        isWinner:false
      };
      players.push(p);
      renderPlayersList();
      layoutPlayersRing();
      setStatus(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„Ø§Ø¹Ø¨: ${name}${platform ? ' ('+platform+')' : ''}`, 'ok');
      return p;
    }

    // ===== Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ù†ØµØ§Øª =====
    function updateConnectionUI(){
      if(activePlatform && activeChannel){
        connectionStatusEl.innerHTML = `Ù…ØªØµÙ„ Ø¨Ù€ <span class="platform">${activePlatform}</span> â€” Ù‚Ù†Ø§Ø©: <strong>${activeChannel}</strong>.`;
        connectionPill.classList.add('connected');
        connectionPillText.textContent = 'Ù…ØªØµÙ„ â€” Ø§Ù„Ø£ÙˆØ§Ù…Ø± ØªØ¹Ù…Ù„ Ø§Ù„Ø¢Ù† Ù…Ù† Ø§Ù„ØªØ´Ø§Øª';
      }else{
        connectionStatusEl.textContent = 'ØºÙŠØ± Ù…ØªØµÙ„ Ø¨Ø£ÙŠ Ù…Ù†ØµØ© Ø­Ø§Ù„ÙŠÙ‹Ø§.';
        connectionPill.classList.remove('connected');
        connectionPillText.textContent = 'ØºÙŠØ± Ù…ØªØµÙ„ â€” Ø§Ø±Ø¨Ø· Ø§Ù„Ø´Ø§Øª Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ø§ØªØµØ§Ù„';
      }
    }

    function disconnectAll(){
      if(twitchClient){
        try{ twitchClient.disconnect(); }catch(e){}
        twitchClient = null;
      }
      if(kickSocket){
        try{
          if(kickSocket._pingInterval) clearInterval(kickSocket._pingInterval);
          if(typeof kickSocket.close === 'function'){
            kickSocket.close();
          }
        }catch(e){}
        kickSocket = null;
      }
      activePlatform = null;
      activeChannel = null;
      updateConnectionUI();
    }

    function connectTwitch(channel){
      disconnectAll();
      activePlatform = 'twitch';
      activeChannel = channel.toLowerCase();

      twitchClient = new tmi.Client({
        connection:{secure:true,reconnect:true},
        channels:[activeChannel]
      });

      twitchClient.connect().then(()=>{
        updateConnectionUI();
        setStatus(`ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨ØªÙˆÙŠØªØ´ â€” Ù‚Ù†Ø§Ø©: ${activeChannel}`, 'ok');
      }).catch(err=>{
        console.error(err);
        setStatus('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨ØªÙˆÙŠØªØ´. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø© ÙˆØ£Ù† Ø§Ù„ØµÙØ­Ø© ØªØ¹Ù…Ù„ Ø¹Ø¨Ø± HTTPS.', 'err');
        disconnectAll();
      });

      twitchClient.on('message', (chan, tags, message, self)=>{
        if(self) return;
        const displayName = tags['display-name'] || tags.username || 'Ù…Ø¬Ù‡ÙˆÙ„';
        console.log('[TWITCH MESSAGE]', displayName, message);
        handleChatMessage('twitch', displayName, message);
      });
    }

    // Ø±Ø¨Ø· Kick Ù…Ø¨Ø§Ø´Ø±Ø©
    function connectKick(channel){
      disconnectAll();
      activePlatform = 'kick';
      activeChannel = channel.toLowerCase();
      updateConnectionUI();

      setStatus('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Kick...', 'info');

      fetch(`https://kick.com/api/v2/channels/${activeChannel}`)
        .then(res=>{
          if(!res.ok) throw new Error('HTTP '+res.status);
          return res.json();
        })
        .then(data=>{
          const roomId = data.chatroom && data.chatroom.id;
          if(!roomId){
            throw new Error('Ù„Ù… ÙŠØªÙ… Ø¥ÙŠØ¬Ø§Ø¯ ØºØ±ÙØ© Ø§Ù„Ø´Ø§Øª Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ù†Ø§Ø©.');
          }

          const wsUrl = "wss://ws-us2.pusher.com/app/32cbd69e4b950bf97679?protocol=7&client=js&version=8.4.0-rc2";
          const socket = new WebSocket(wsUrl);
          kickSocket = socket;

          socket.onopen = ()=>{
            const subPayload = {
              event:"pusher:subscribe",
              data:{
                auth:"",
                channel:`chatrooms.${roomId}.v2`
              }
            };
            socket.send(JSON.stringify(subPayload));

            socket._pingInterval = setInterval(()=>{
              if(socket.readyState === WebSocket.OPEN){
                socket.send(JSON.stringify({event:"pusher:ping",data:{}}));
              }
            },12000);

            setStatus(`ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Kick â€” Ù‚Ù†Ø§Ø©: ${activeChannel}`, 'ok');
            updateConnectionUI();
          };

          socket.onmessage = (event)=>{
            try{
              const payload = JSON.parse(event.data);
              if(payload.event === "App\\Events\\ChatMessageEvent"){
                const d = JSON.parse(payload.data);
                const user = (d.sender && d.sender.username) || 'Ù…Ø´Ø§Ø±Ùƒ';
                const raw = (d.content || '').toString();
                const cleaned = raw.replace(/<[^>]+>/g,'').trim();
                if(!cleaned) return;
                console.log('[KICK MESSAGE]', user, cleaned);
                handleChatMessage('kick', user, cleaned);
              }
            }catch(err){
              console.error('Kick message error:', err);
            }
          };

          socket.onerror = (err)=>{
            console.error('Kick socket error:', err);
            setStatus('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§ØªØµØ§Ù„ Kick.', 'err');
          };

          socket.onclose = ()=>{
            if(socket._pingInterval) clearInterval(socket._pingInterval);
            if(activePlatform === 'kick'){
              setStatus('ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§ØªØµØ§Ù„ Kick.', 'err');
              activePlatform = null;
              activeChannel = null;
              updateConnectionUI();
            }
          };
        })
        .catch(err=>{
          console.error('Kick connect error:', err);
          setStatus('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Kick. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø© Ø£Ùˆ Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ù‹Ø§.', 'err');
          disconnectAll();
        });
    }

    // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ù…Ù† Twitch Ùˆ Kick
    function handleChatMessage(platform, senderName, rawMessage){
      // ØªÙ†Ø¸ÙŠÙ HTML Ù„Ùˆ ÙƒÙŠÙƒ ÙŠØ±Ø³Ù„ Ø±Ø³Ø§Ø¦Ù„ ÙÙŠÙ‡Ø§ <span> ÙˆØºÙŠØ±Ù‡
      let text = (rawMessage || '').replace(/<[^>]+>/g,'').trim();

      // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ù€ ! Ø£Ùˆ ï¼ (Ø¨Ø¹Ø¶ Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯Ø§Øª)
      if(!/^[!ï¼]/.test(text)) return;

      // !Ø¯Ø®ÙˆÙ„
      if(/^([!ï¼])\s*Ø¯Ø®ÙˆÙ„$/i.test(text)){
        if(gameStarted){
          setStatus(`@${senderName} Ø­Ø§ÙˆÙ„ ÙŠØ¯Ø®Ù„ Ø¨Ø¹Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© â€” Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù…ØºÙ„Ù‚ Ø§Ù„Ø¢Ù†.`, 'err');
          return;
        }
        const added = addPlayerByName(senderName, platform);
        if(added){
          console.log('[JOIN]', platform, senderName);
        }
        return;
      }

      // !Ø±Ù‚Ù… Ø±Ù‚Ù… (Ù…Ø«Ù„ !1 5)
      const match = text.match(/^([!ï¼])(\d+)\s+(\d+)$/);
      if(match){
        const pos = parseInt(match[2],10);
        const cardNum = parseInt(match[3],10);
        console.log('[MOVE]', platform, senderName, 'pos=',pos,'card=',cardNum);
        processPlayerMoveFromChat(platform, senderName, pos, cardNum);
        return;
      }
    }

    function processPlayerMoveFromChat(platform, senderName, position, cardNum){
      if(!gameStarted){
        setStatus('Ø§Ù„Ù„Ø¹Ø¨Ø© Ù„Ù… ØªØ¨Ø¯Ø£ Ø¨Ø¹Ø¯. Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù‚Ø¨Ù„ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª.', 'err');
        return;
      }
      if(!centerWordEl.textContent || centerWordEl.textContent === 'â€” â€” â€”'){
        setStatus('Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø© Ø­Ø§Ù„ÙŠØ© ÙÙŠ Ø§Ù„ÙˆØ³Ø·. Ø¹ÙŠÙ‘Ù† Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø£ÙˆÙ„Ø§Ù‹.', 'err');
        return;
      }
      if(pendingSuggestion){
        setStatus('ÙŠÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø© Ù…Ù‚ØªØ±Ø­Ø© Ù„Ù… ÙŠØªÙ… Ù‚Ø¨ÙˆÙ„Ù‡Ø§ Ø£Ùˆ Ø±ÙØ¶Ù‡Ø§ Ø¨Ø¹Ø¯. Ø§Ø­Ø³Ù… Ø§Ù„Ù‚Ø±Ø§Ø± Ø£ÙˆÙ„Ø§Ù‹.', 'err');
        return;
      }

      const idx = findPlayerIndexByPlatformName(platform,senderName);
      if(idx === -1){
        setStatus(`@${senderName} Ø­Ø§ÙˆÙ„ ÙŠÙ„Ø¹Ø¨ Ø¨Ø¯ÙˆÙ† Ù…Ø§ ÙŠØ¯Ø®Ù„. Ø§Ø³ØªØ®Ø¯Ù… !Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.`, 'err');
        return;
      }
      const p = players[idx];

      if(idx !== currentPlayerIndex){
        setStatus(`Ù…Ùˆ Ø¯ÙˆØ± ${p.name} Ø­Ø§Ù„ÙŠÙ‹Ø§. Ø§Ù„Ø¯ÙˆØ± Ø¹Ù„Ù‰: ${players[currentPlayerIndex]?.name || 'â€”'}`, 'err');
        return;
      }

      const word = centerWordEl.textContent.trim();
      const wordLength = Array.from(word).length;
      if(position < 1 || position > wordLength){
        setStatus(`@${senderName} Ø±Ù‚Ù… Ø§Ù„Ø­Ø±Ù (${position}) ØºÙŠØ± ØµØ§Ù„Ø­ Ù„Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ø·ÙˆÙ„Ù‡Ø§ ${wordLength}).`, 'err');
        return;
      }

      if(cardNum < 1 || cardNum > p.cards.length){
        setStatus(`@${senderName} Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© (${cardNum}) ØºÙŠØ± ØµØ§Ù„Ø­. Ø¹Ø¯Ø¯ Ø¨Ø·Ø§Ù‚Ø§ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${p.cards.length}.`, 'err');
        return;
      }

      const cardIndex = cardNum - 1;
      const letter = p.cards[cardIndex];

      const chars = Array.from(word);
      chars[position-1] = letter;
      const newWord = chars.join('');

      pendingSuggestion = {
        playerIndex: idx,
        cardIndex,
        word: newWord,
        position,
        fromPlatform: platform,
        fromName: senderName
      };
      showPendingSuggestion();
      setStatus(`Ø§Ù‚ØªØ±Ø§Ø­ Ø¬Ø¯ÙŠØ¯ Ù…Ù† ${p.name}: "${newWord}" â€” Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ø±Ø§Ø±Ùƒ (Ù‚Ø¨ÙˆÙ„/Ø±ÙØ¶).`, 'info');
    }

    // ===== Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø± =====
    setInitialWordBtn.addEventListener('click',()=>{
      const w = initialWordInput.value.trim();
      if(!w){
        setStatus('Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù‚Ø¨Ù„ ØªØ¹ÙŠÙŠÙ†Ù‡Ø§.', 'err');
        return;
      }
      centerWordEl.textContent = w;
      setStatus(`ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: ${w}`, 'ok');
    });

    updateTurnSecondsBtn.addEventListener('click',()=>{
      const val = parseInt(turnSecondsInput.value,10);
      if(isNaN(val) || val < 5 || val > 300){
        setStatus('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ…Ø© Ø¨ÙŠÙ† 5 Ùˆ 300 Ø«Ø§Ù†ÙŠØ©.', 'err');
        return;
      }
      turnSeconds = val;
      setStatus(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…Ø¯Ø© Ø§Ù„Ø¯ÙˆØ± Ø¥Ù„Ù‰ ${val} Ø«Ø§Ù†ÙŠØ©.`, 'ok');
      if(timerId){
        updateTimerHeader();
      }
    });

    startGameBtn.addEventListener('click',()=>{
      if(players.length === 0){
        setStatus('Ø£Ø¶ÙÙ Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© (Ø¹Ø¨Ø± !Ø¯Ø®ÙˆÙ„).', 'err');
        return;
      }
      if(!centerWordEl.textContent || centerWordEl.textContent === 'â€” â€” â€”'){
        setStatus('Ø¹ÙŠÙ‘Ù† Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙÙŠ Ø§Ù„ÙˆØ³Ø· Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©.', 'err');
        return;
      }
      gameStarted = true;
      winnerFound = false;
      winnerBannerEl.style.display = 'none';
      clearPendingSuggestionUI();

      dealCardsToPlayers();
      currentPlayerIndex = 0;
      layoutPlayersRing();
      renderCurrentPlayer();
      startTurnTimer();
      setStatus(`ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©! Ø§Ù„Ø¢Ù† Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨: ${players[currentPlayerIndex].name}`, 'ok');
    });

    nextPlayerBtn.addEventListener('click',()=>{
      clearPendingSuggestionUI();
      goToNextPlayer();
    });

    restartTurnBtn.addEventListener('click',()=>{
      if(currentPlayerIndex < 0){
        setStatus('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ Ù†Ø´Ø· Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¤Ù‚Øª.', 'err');
        return;
      }
      clearPendingSuggestionUI();
      startTurnTimer();
      setStatus(`ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¤Ù‚Øª Ù„Ù†ÙØ³ Ø§Ù„Ù„Ø§Ø¹Ø¨: ${players[currentPlayerIndex].name}`, 'ok');
    });

    stopTimerBtn.addEventListener('click',()=>{
      stopTurnTimer();
      setStatus('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª Ù…Ø¤Ù‚ØªÙ‹Ø§.', 'info');
    });

    centerAcceptBtn.addEventListener('click',()=>{
      acceptSuggestion();
    });

    centerRejectBtn.addEventListener('click',()=>{
      rejectSuggestion();
    });

    connectBtn.addEventListener('click',()=>{
      const platform = platformSelect.value;
      const channel = channelInput.value.trim();
      if(!channel){
        setStatus('Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø§ØªØµØ§Ù„.', 'err');
        return;
      }
      if(platform === 'twitch'){
        connectTwitch(channel);
      }else if(platform === 'kick'){
        connectKick(channel);
      }
    });

    // Ù†Ø§ÙØ°Ø© Ø§Ù„Ø´Ø±Ø­
    helpBtn.addEventListener('click',()=>{
      helpModalBackdrop.classList.add('active');
    });
    helpModalClose.addEventListener('click',()=>{
      helpModalBackdrop.classList.remove('active');
    });
    helpModalBackdrop.addEventListener('click',(e)=>{
      if(e.target === helpModalBackdrop){
        helpModalBackdrop.classList.remove('active');
      }
    });

    // Ø±Ù†Ø¯Ø± Ø£ÙˆÙ„ÙŠ
    renderPlayersList();
    layoutPlayersRing();
    updateConnectionUI();
    updateTimerHeader();
    setStatus('Ø£Ø¶ÙÙ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ù† Ø§Ù„ØªØ´Ø§Øª (!Ø¯Ø®ÙˆÙ„)ØŒ Ø¹ÙŠÙ‘Ù† Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ØŒ Ø«Ù… Ø§Ø¶ØºØ· "Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©".');
  </script>
</body>
</html>
