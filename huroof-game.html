<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ Ø³Ø¨Ø§Ù‚ Ø§Ù„Ø­Ø±ÙˆÙ</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">

<!-- Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø´Ø§Øª: Ù†Ø­ØªØ§Ø¬ tmi Ù„ØªÙˆÙŠØªØ´ ÙÙ‚Ø· -->
<script src="tmi.min.js"></script>

<style>
  :root{
    --bg:#0f1115; --panel:#151923; --panel-2:#1b2030; --text:#e9eef7; --muted:#a7b0c0;
    --primary:#ff3333; --accent:#00d86c; --blue:#3aa7ff; --red:#ff5964; --gold:#f8d35e;
    --success:#19c37d; --warning:#f7a94d;

    /* âœ… Ù…ØªØºÙŠØ±Ø§Øª Ø®Ù„ÙÙŠØ© Style2026 */
    --bg1:#1a1a3d;
    --bg2:#004466;
    --fgText:#fff;
  }
  /* ÙˆØ¶Ø¹ ÙØ§ØªØ­ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) */
  [data-theme="light"]{
    --bg1:#f2f6ff;
    --bg2:#dfe9ff;
    --fgText:#111;
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    color:var(--fgText);
    font-family:"Cairo", system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Color Emoji", sans-serif;
    min-height:100svh; display:flex; flex-direction:column; gap:16px; padding:20px;

    /* âœ… Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© Ø§Ù„Ù…ÙˆØ­Ø¯Ø© */
    background: linear-gradient(-45deg, var(--bg1), var(--bg2), var(--bg1), var(--bg2));
    background-size: 400% 400%;
    animation: gradientBG 20s ease infinite;
  }
  /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø®Ù„ÙÙŠØ© */
  @keyframes gradientBG {
    0% { background-position: 0% 50% }
    50% { background-position: 100% 50% }
    100% { background-position: 0% 50% }
  }

  header{display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap}
  .brand{display:flex; gap:12px; align-items:center}
  .logo{width:40px; height:40px; border-radius:12px; background:
    conic-gradient(from 210deg, var(--primary), #d62222 40%, #111 41%, #111 59%, #00d86c 60%, #008f47 100%);
    box-shadow:0 6px 16px rgba(0,0,0,.35); position:relative; overflow:hidden;}
  .logo::after{content:"ST"; position:absolute; inset:0; display:grid; place-items:center; font-weight:800; color:#fff; text-shadow:0 2px 8px rgba(0,0,0,.5)}
  h1{margin:0; font-size:20px; font-weight:800; letter-spacing:.2px}

  /* Ø²Ø± Ø§Ù„Ø´Ø±Ø­ Ø£Ø¹Ù„Ù‰ ÙŠØ³Ø§Ø± */
  #helpBtn{
    position:fixed; top:12px; left:12px; z-index:20;
    background:var(--primary); color:#fff; border:none; padding:8px 14px; border-radius:10px; cursor:pointer; font-weight:800;
    box-shadow:0 6px 16px rgba(255,51,51,.3);
  }
  #helpModal{display:none; position:fixed; inset:0; background:rgba(0,0,0,.75); z-index:30; align-items:center; justify-content:center; padding:16px}
  #helpBox{background:var(--panel); border:1px solid #2a3142; border-radius:16px; max-width:640px; width:100%; padding:16px;}
  #helpBox h2{margin:0 0 8px; color:var(--primary)}
  #closeHelp{margin-top:10px; background:#2a3142; color:#fff; border:none; padding:8px 14px; border-radius:10px; cursor:pointer}

  /* Ù„ÙˆØ­ØªØ§Ù† Ø¬Ø¯ÙŠØ¯ØªØ§Ù† (Ø§ØªØµØ§Ù„ + Ø³ØªØ±ÙŠÙ…Ø±) */
  .card{
    background:var(--panel); border-radius:18px; padding:16px; box-shadow:0 6px 24px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.03);
  }
  .panel-collapsible{width:100%; max-width:900px; margin:0 auto}
  .panel-head{
    display:flex; align-items:center; justify-content:space-between; gap:12px; cursor:pointer;
    background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.05));
    border:1px solid #2a3142; border-radius:14px; padding:12px 14px;
  }
  .panel-head h3{margin:0; font-weight:900; font-size:16px}
  .chev{transform:rotate(0deg); transition:.2s}
  .panel-body{display:none; padding:12px 0}
  .panel-open .panel-body{display:block}
  .panel-open .chev{transform:rotate(180deg)}

  /* Ù„ÙˆØ­Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¬Ø¯ÙŠØ¯ */
  .conn-grid{display:grid; grid-template-columns: repeat(4, minmax(140px,1fr)); gap:12px}
  label{font-size:12px; color:var(--muted)}
  input, select{
    background:var(--panel-2); color:var(--text); border:1px solid #2a3142; border-radius:10px; padding:10px 12px;
    outline:none; transition:.2s border-color;
  }
  input:focus, select:focus{border-color:var(--primary)}
  .status{
    font-size:12px; font-weight:800; padding:10px 12px; border-radius:999px; border:1px solid #2a3142; background:#0d1524; text-align:center
  }
  .status.ok{color:#b6ffd8; border-color:#1f6a47; background:#0f2d24}
  .status.bad{color:#ffd2d2; border-color:#6a1f2a; background:#2d0f15}
  .btn{
    appearance:none; border:none; border-radius:12px; padding:12px 16px; font-weight:800; cursor:pointer;
    background:linear-gradient(180deg, var(--primary), #d62222); color:#fff; box-shadow:0 6px 16px rgba(255,51,51,.3);
    transition:.15s transform,.2s filter;
  }
  .btn:active{transform:translateY(1px)}
  .ghost{background:transparent; border:1px solid #2a3142}

  /* Ù„ÙˆØ­Ø© Ø³ØªØ±ÙŠÙ…Ø± Ø¬Ø¯ÙŠØ¯ */
  .str-grid{display:grid; grid-template-columns: repeat(3, minmax(140px,1fr)); gap:12px}

  /* ØªØ®Ø·ÙŠØ· Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ù„ÙˆØ­ØªÙŠÙ† */
  main{display:grid; grid-template-columns: 1.3fr .7fr; gap:16px; margin-top:10px}

  /* ==== Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ù…Ø³ØªØ·ÙŠÙ„ ÙƒØ¨ÙŠØ± + Ø§Ù„ÙˆÙ‚Øª ÙŠØ³Ø§Ø±) ==== */
  .gamebar{
    display:flex; align-items:stretch; gap:14px; flex-wrap:nowrap; margin-bottom:12px
  }
  .timer{
    display:flex; align-items:center; gap:12px; padding:14px 16px;
    background:var(--panel-2); border:1px solid #2a3142; border-radius:16px; min-width:210px
  }
  .timer .ring{
    --p: 0turn;
    width:54px; height:54px; border-radius:999px; padding:5px;
    background:
      conic-gradient(#3aa7ff var(--p), #2b3348 0) content-box,
      radial-gradient(circle, transparent 60%, #2b3348 61%) border-box;
    box-sizing:border-box;
  }
  .timer .t{
    font-weight:900; font-size:28px; letter-spacing:.5px; line-height:1
  }

  .bigstrip{
    flex:1; display:grid; grid-template-columns: 1fr 320px; gap:14px;
  }
  .big-rect{
    display:grid; grid-template-columns: auto 1fr; gap:16px; align-items:center;
    padding:18px 20px; border-radius:18px; border:1px solid #2a3142;
    background:
      linear-gradient(180deg, rgba(255,51,51,.14), rgba(16,22,33,.8)),
      radial-gradient(600px 160px at 0% 0%, rgba(58,167,255,.18), transparent 60%),
      #121726;
    box-shadow: inset 0 1px 0 rgba(255,255,255,.03);
    min-height:88px;
  }
  .catBox{
    background:#182032; border:1px solid #2f3951; color:#cfe0ff;
    padding:10px 14px; border-radius:12px; font-weight:800; font-size:20px; min-width:140px; text-align:center;
  }
  .letterBox{
    display:flex; align-items:center; justify-content:center;
    background:#1c2335; border:1px solid #2f3951; color:#fff;
    border-radius:14px; font-weight:900; font-size:48px; letter-spacing:1px;
    position:relative; min-height:64px;
  }
  .letterBox::after{
    content: attr(data-count);
    position:absolute; top:-10px; inset-inline-end:-10px;
    font-size:12px; font-weight:800; padding:3px 7px; border-radius:999px;
    background:#27314a; border:1px solid #3a4561; color:#dbe7ff;
  }

  .round-status{margin:8px 0 12px; color:var(--muted); font-size:14px}
  .cols{display:grid; grid-template-columns:1fr 1fr; gap:12px}
  .panel-title{font-weight:800; margin:0 0 10px; color:#dce6ff}
  .list{display:flex; flex-direction:column; gap:8px; max-height:44vh; overflow:auto; padding-right:4px}
  .row{display:flex; align-items:center; justify-content:space-between; background:var(--panel-2); border:1px solid #2a3142; border-radius:12px; padding:10px 12px}
  .row .name{font-weight:700}
  .row .score{font-weight:900; color:#fff; background:#27314a; padding:4px 10px; border-radius:999px; border:1px solid #3a4561}
  .teams{display:grid; grid-template-columns:1fr 1fr; gap:12px}
  .team-box{border-radius:14px; padding:12px; border:1px solid #2a3142}
  .team-blue{background:linear-gradient(180deg, rgba(58,167,255,.15), rgba(17,22,33,.6));}
  .team-red{background:linear-gradient(180deg, rgba(255,89,100,.15), rgba(17,22,33,.6));}
  .team-hdr{display:flex; align-items:center; justify-content:space-between; margin-bottom:10px}
  .team-hdr h3{margin:0; font-weight:900}
  .score-badge{background:#0d1524; padding:6px 10px; border-radius:999px; border:1px solid #2a3142; font-weight:900}
  .muted{color:var(--muted); font-size:13px}
  .inline-kbd{background:#00000033; border:1px solid #2a3142; padding:2px 8px; border-radius:6px; font-family:ui-monospace, SFMono-Regular, Menlo, monospace; font-size:12px}
  .footer{display:flex; flex-wrap:wrap; gap:8px; align-items:center; justify-content:space-between}
  .chip{font-size:12px}
  .manual{display:flex; gap:8px; margin-top:10px}
  .manual input{flex:1}

  .review{
    margin-top:14px; padding:12px; border-radius:14px; border:1px solid #384155; background:#121826;
    display:none; flex-direction:column; gap:12px;
  }
  .review h4{margin:0; font-weight:900; color:#f2f6ff}
  .review-list{display:flex; flex-direction:column; gap:8px; max-height:36vh; overflow:auto}
  .review-row{display:grid; grid-template-columns:auto 1fr auto; gap:10px; align-items:center; background:#0f1524; border:1px solid #2b3348; padding:8px 10px; border-radius:10px}
  .badge{background:#0d1524; border:1px solid #2a3142; padding:3px 8px; border-radius:999px; font-weight:800; font-size:12px}
  .players{color:#a8b4ca; font-size:12px}

  /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© */
  @media (max-width: 980px){
    .bigstrip{grid-template-columns: 1fr; gap:10px}
    .timer{min-width:unset; width:100%}
    .letterBox{font-size:42px}
    .catBox{font-size:18px}
    .conn-grid{grid-template-columns:1fr 1fr}
    .str-grid{grid-template-columns:1fr 1fr}
    main{grid-template-columns:1fr}
  }
</style>
</head>
<body>

  <!-- Ø²Ø± Ø§Ù„Ø´Ø±Ø­ -->
  <button id="helpBtn">Ø´Ø±Ø­ ØªÙØµÙŠÙ„ÙŠ</button>
  <div id="helpModal">
    <div id="helpBox">
      <h2>Ø´Ø±Ø­ Ù„Ø¹Ø¨Ø© Ø³Ø¨Ø§Ù‚ Ø§Ù„Ø­Ø±ÙˆÙ</h2>
      <p>
        â€¢ ÙŠÙ†Ø¶Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ†: Ø³ÙˆÙ„Ùˆ <span class="inline-kbd">!Ø¯Ø®ÙˆÙ„</span>ØŒ ØªÙŠÙ…Ø§Øª <span class="inline-kbd">!Ø§Ø²Ø±Ù‚</span> / <span class="inline-kbd">!Ø§Ø­Ù…Ø±</span>.<br>
        â€¢ Ø§Ø¶Ø¨Ø· Ù…Ø¯Ø© Ø§Ù„Ø±Ø§ÙˆÙ†Ø¯ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ø³ØªØ±ÙŠÙ…Ø±ØŒ Ø«Ù… Ø§Ø¶ØºØ· <b>Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</b>.<br>
        â€¢ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© ØªÙÙ‚Ø¨Ù„ Ø£ÙŠ ÙƒÙ„Ù…Ø© ØªØ¨Ø¯Ø£ Ø¨Ø§Ù„Ø­Ø±Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„ÙØ¦Ø© Ø§Ù„Ø¸Ø§Ù‡Ø±Ø©.<br>
        â€¢ Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚ØªØŒ Ø±Ø§Ø¬Ø¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ø«Ù… Ø§Ø¶ØºØ· <b>Ø§Ø­ØªØ³Ø§Ø¨</b>ØŒ ÙˆØ¨Ø¹Ø¯Ù‡Ø§ <b>Ø§Ù„ØªØ§Ù„ÙŠ</b> Ù„Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©.
      </p>
      <button id="closeHelp">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  </div>

  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>ğŸ Ø³Ø¨Ø§Ù‚ Ø§Ù„Ø­Ø±ÙˆÙ</h1>
        <div class="muted">Ø³ÙˆÙ„Ùˆ Ø£Ùˆ ØªÙŠÙ…Ø§Øª â€¢ Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„Ø´Ø§Øª (Twitch/Kick) â€¢ Ø±Ø§ÙˆÙ†Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠ 60 Ø«Ø§Ù†ÙŠØ© â€¢ Ù…Ø±Ø§Ø¬Ø¹Ø© ÙŠØ¯ÙˆÙŠØ©</div>
      </div>
    </div>
  </header>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¬Ø¯ÙŠØ¯ (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø·ÙŠ) -->
  <section class="panel-collapsible card" id="connWrap">
    <div class="panel-head" id="connHead">
      <h3>Ù„ÙˆØ­Ø© Ø§Ù„Ø§ØªØµØ§Ù„</h3>
      <div style="display:flex; align-items:center; gap:10px">
        <span id="connStatus" class="status bad">ØºÙŠØ± Ù…ØªØµÙ„</span>
        <span class="chev">âŒ„</span>
      </div>
    </div>
    <div class="panel-body">
      <div class="conn-grid">
        <div>
          <label>Ù…Ù†ØµØ© Ø§Ù„Ø´Ø§Øª</label>
          <select id="platform">
            <option value="twitch">Twitch</option>
            <option value="kick">Kick</option>
            <option value="offline">Manual (Ø¨Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„)</option>
          </select>
        </div>
        <div>
          <label>Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø©</label>
          <input id="channel" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø© Ø¨Ø¯ÙˆÙ† @" />
        </div>
        <div style="display:flex; flex-direction:column; gap:6px">
          <label>&nbsp;</label>
          <button class="btn" id="connectBtn">Ø§ØªØµØ§Ù„</button>
        </div>
        <div style="display:flex; align-items:center; gap:8px">
          <input type="checkbox" id="rememberChk" checked />
          <label for="rememberChk">ØªØ°ÙƒÙ‘Ø±Ù†ÙŠ</label>
        </div>
      </div>
      <div id="manualBox" class="manual" style="display:none; margin-top:12px">
        <input id="manualUser" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨" />
        <input id="manualMsg" placeholder="Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø´Ø§Øª (Ù…Ø«Ù„Ø§Ù‹: Ø¨Ø·ÙŠØ® / !Ø¯Ø®ÙˆÙ„ / !Ø§Ø²Ø±Ù‚)" />
        <button class="btn ghost" id="manualSend">Ø¥Ø±Ø³Ø§Ù„</button>
      </div>
    </div>
  </section>

  <!-- Ù„ÙˆØ­Ø© Ø³ØªØ±ÙŠÙ…Ø± Ø¬Ø¯ÙŠØ¯ -->
  <section class="panel-collapsible card" id="strWrap">
    <div class="panel-head" id="strHead">
      <h3>Ù„ÙˆØ­Ø© Ø§Ù„Ø³ØªØ±ÙŠÙ…Ø±</h3>
      <span class="chev">âŒ„</span>
    </div>
    <div class="panel-body">
      <div class="str-grid">
        <div>
          <label>Ø·ÙˆÙ„ Ø§Ù„Ø±Ø§ÙˆÙ†Ø¯ (Ø«ÙˆØ§Ù†Ù)</label>
          <input id="roundSeconds" type="number" min="10" value="60" />
        </div>
        <div style="display:flex; align-items:end">
          <button class="btn" id="startBtn" style="width:100%">Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
        </div>
        <div style="display:flex; align-items:end">
          <button class="btn ghost" id="stopBtn" style="width:100%">Ø¥ÙŠÙ‚Ø§Ù</button>
        </div>
      </div>
    </div>
  </section>

  <main>
    <section class="card">
      <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
      <div class="gamebar">
        <!-- Ø§Ù„ÙˆÙ‚Øª ÙŠØ³Ø§Ø±: Ø£Ø±Ù‚Ø§Ù… ÙƒØ¨ÙŠØ±Ø© + Ø¯Ø§Ø¦Ø±Ø© -->
        <div class="timer">
          <div class="ring" id="ring"></div>
          <div class="t" id="timeLeft">00:00</div>
        </div>

        <!-- Ù…Ø³ØªØ·ÙŠÙ„ ÙƒØ¨ÙŠØ± Ù„Ù„ÙØ¦Ø© ÙˆØ§Ù„Ø­Ø±Ù -->
        <div class="bigstrip">
          <div class="big-rect">
            <div class="catBox" id="categoryPill">â€”</div>
            <div class="letterBox" id="letterPill" data-count="0">â€”</div>
          </div>
          <div style="display:none"></div>
        </div>
      </div>

      <div class="round-status" id="roundStatus">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØµØ© ÙˆØ§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø© Ø«Ù… Ø§Ø¶ØºØ· â€œØ§ØªØµØ§Ù„â€.</div>

      <div class="cols">
        <div>
          <h3 class="panel-title">Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ†</h3>
          <div class="list" id="playersList"></div>
        </div>

        <div>
          <h3 class="panel-title">Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h3>
          <div id="scoresBox">
            <div id="soloScores" class="list"></div>

            <div id="teamsScores" class="teams" style="display:none">
              <div class="team-box team-blue">
                <div class="team-hdr">
                  <h3>ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚</h3>
                  <div class="score-badge" id="blueScore">0</div>
                </div>
                <div class="muted">Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…: <span class="inline-kbd">!Ø§Ø²Ø±Ù‚</span></div>
                <div class="list" id="blueMembers"></div>
              </div>
              <div class="team-box team-red">
                <div class="team-hdr">
                  <h3>ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø­Ù…Ø±</h3>
                  <div class="score-badge" id="redScore">0</div>
                </div>
                <div class="muted">Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…: <span class="inline-kbd">!Ø§Ø­Ù…Ø±</span></div>
                <div class="list" id="redMembers"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="review" id="reviewPanel">
        <h4>Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª â€” Ø§Ø®ØªØ± Ø§Ù„ØµØ­ÙŠØ­ Ø«Ù… Ø§Ø¶ØºØ· â€œØ§Ø­ØªØ³Ø§Ø¨â€</h4>
        <div class="review-list" id="reviewList"></div>
        <div class="review-actions">
          <button class="btn" id="scoreBtn">Ø§Ø­ØªØ³Ø§Ø¨ âœ…</button>
          <button class="btn ghost" id="nextRoundBtn" disabled>Ø§Ù„ØªØ§Ù„ÙŠ â­ï¸</button>
        </div>
        <div class="muted">Ù…Ù„Ø§Ø­Ø¸Ø©: ØªÙÙ…Ù†Ø­ Ù†Ù‚Ø·Ø© Ù„ÙƒÙ„ ÙƒÙ„Ù…Ø© Ù…Ø¹ØªÙ…ÙØ¯Ø© ÙŠÙƒØªØ¨Ù‡Ø§ Ø§Ù„Ù„Ø§Ø¹Ø¨ (ÙŠÙ…ÙƒÙ† Ø§Ø­ØªØ³Ø§Ø¨ Ø¹Ø¯Ø© ÙƒÙ„Ù…Ø§Øª Ù„Ù†ÙØ³ Ø§Ù„Ù„Ø§Ø¹Ø¨).</div>
      </div>

      <div style="margin-top:12px" class="footer">
        <div class="muted">Ø³ÙˆÙ„Ùˆ: <span class="inline-kbd">!Ø¯Ø®ÙˆÙ„</span> â€¢ ØªÙŠÙ…Ø§Øª: <span class="inline-kbd">!Ø§Ø²Ø±Ù‚</span> / <span class="inline-kbd">!Ø§Ø­Ù…Ø±</span> â€¢ Ø®Ù„Ø§Ù„ Ø§Ù„Ø¬ÙˆÙ„Ø©: ØªÙÙ‚Ø¨Ù„ Ø£ÙŠ ÙƒÙ„Ù…Ø© ØªØ¨Ø¯Ø£ Ø¨Ø§Ù„Ø­Ø±Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</div>
        <div class="chip pill">Ù…Ù† ØªØµÙ…ÙŠÙ…: Medo_DV â€” StreamerTop</div>
      </div>
    </section>

    <aside class="card">
      <h3 class="panel-title">Ø³ÙØ¬Ù„ Ø§Ù„Ø´Ø§Øª</h3>
      <div class="list" id="chatLog" style="max-height:64vh"></div>
    </aside>
  </main>

  <!-- Ø«ÙŠÙ… Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¯Ø§ÙƒÙ† Ù„Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© -->
  <script>document.documentElement.setAttribute('data-theme','dark');</script>

  <!-- ChatBridge v1 â€” Ø¯Ù…Ø¬ Twitch/Kick Ù…Ø¹ Ø­ÙØ¸ Ø§Ù„Ù‚Ù†Ø§Ø© -->
  <script>
  (function(global){
    const LS_TWITCH='cb_twitch_channel';
    const LS_KICK  ='cb_kick_channel';

    const state = {
      twitchClient:null,
      kickSocket:null,
      kickRoomId:null,
      connected:{twitch:false, kick:false},
      handlers:{
        status: (txt)=>console.log('[Status]',txt),
        message:(username, text, platform)=>console.log('[Msg]', platform, username+':', text),
        badge:  (platform, status)=>{}, // ok | wait | err
      }
    };

    function setStatus(s){ state.handlers.status(s); }
    function setBadge(p, st){ state.handlers.badge(p, st); }
    function saveChannel(platform, channel){
      try{ localStorage.setItem(platform==='twitch'?LS_TWITCH:LS_KICK, channel); }catch{}
    }
    function loadSaved(platform){
      try{ return localStorage.getItem(platform==='twitch'?LS_TWITCH:LS_KICK)||''; }catch{ return ''; }
    }

    async function connectTwitch(channel){
      if (!window.tmi){ setStatus('âŒ tmi.js ØºÙŠØ± Ù…ÙØ­Ù…Ù‘ÙÙ„'); return; }
      try{
        setBadge('twitch','wait');
        const client = new tmi.Client({ channels:[channel], connection:{ secure:true, reconnect:true } });
        state.twitchClient = client;

        client.on('connected',()=>{
          state.connected.twitch = true;
          saveChannel('twitch', channel);
          setStatus(`âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Twitch: #${channel}`);
          setBadge('twitch','ok');
        });

        client.on('disconnected', (r)=>{ 
          state.connected.twitch = false; 
          setStatus(`âš ï¸ Ø§Ù†ÙØµÙ„ Twitch: ${r||'-'}`);
          setBadge('twitch','err');
        });

        client.on('message',(ch, tags, message, self)=>{
          if(self) return;
          const user = tags['display-name'] || tags.username || 'Ù…Ø´Ø§Ø±Ùƒ';
          const text = (message||'').trim();
          state.handlers.message(user, text, 'twitch');
        });

        await client.connect();
      }catch(e){
        setStatus('âŒ ÙØ´Ù„ Ø§ØªØµØ§Ù„ Twitch: '+e.message);
        setBadge('twitch','err');
      }
    }

    async function connectKick(channel){
      try{
        setBadge('kick','wait');
        const res = await fetch(`https://kick.com/api/v2/channels/${channel}`);
        const data = await res.json().catch(()=>null);
        const roomId = data?.chatroom?.id;
        if (!roomId){ setStatus('âŒ ÙØ´Ù„ Ø¬Ù„Ø¨ ØºØ±ÙØ© ÙƒÙŠÙƒ'); setBadge('kick','err'); return; }

        const ws = new WebSocket("wss://ws-us2.pusher.com/app/32cbd69e4b950bf97679?protocol=7&client=js&version=8.4.0-rc2&flash=false");
        state.kickSocket = ws;

        ws.onopen = ()=>{
          ws.send(JSON.stringify({event:"pusher:subscribe",data:{auth:"",channel:`chatrooms.${roomId}.v2`}}));
          setInterval(()=>{ if(ws.readyState===WebSocket.OPEN){ ws.send(JSON.stringify({event:"pusher:ping",data:{}})); } },12000);
          state.connected.kick = true;
          saveChannel('kick', channel);
          setStatus(`âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Kick: ${channel}`);
          setBadge('kick','ok');
        };

        ws.onmessage = (event)=>{
          const pkt = JSON.parse(event.data);
          if (pkt.event === "App\\Events\\ChatMessageEvent"){
            const d = JSON.parse(pkt.data);
            const user = d?.sender?.username || 'Ù…Ø´Ø§Ø±Ùƒ';
            const text = (d?.content || '').trim();
            state.handlers.message(user, text, 'kick');
          }
        };

        ws.onerror = ()=>{ state.connected.kick = false; setStatus('âŒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§ØªØµØ§Ù„ Kick'); setBadge('kick','err'); };
        ws.onclose  = ()=>{ state.connected.kick = false; setStatus('âš ï¸ ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§ØªØµØ§Ù„ Kick'); setBadge('kick','err'); };
      }catch(e){
        setStatus('âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Kick: '+e.message);
        setBadge('kick','err');
      }
    }

    const ChatBridge = {
      on({status, message, badge}={}){
        if (status)  state.handlers.status = status;
        if (message) state.handlers.message= message;
        if (badge)   state.handlers.badge  = badge;
        return this;
      },
      connect(platform, channel, {remember=true}={}){
        if (!channel || !platform) return;
        if (remember) saveChannel(platform, channel);
        if (platform==='twitch') connectTwitch(channel);
        else if (platform==='kick') connectKick(channel);
      },
      getSaved(platform){ return loadSaved(platform); },
      isConnected(){ return {...state.connected}; },
      disconnect(platform){
        if (platform==='twitch' && state.twitchClient){
          try{ state.twitchClient.disconnect(); }catch{}
          state.connected.twitch=false;
          setBadge('twitch','err');
        }
        if (platform==='kick' && state.kickSocket){
          try{ state.kickSocket.close(); }catch{}
          state.connected.kick=false;
          setBadge('kick','err');
        }
      }
    };

    global.ChatBridge = ChatBridge;
  })(window);
  </script>

  <script>
  const CATEGORIES = ["Ø§Ø³Ù…", "Ø­ÙŠÙˆØ§Ù†", "Ù†Ø¨Ø§Øª", "Ø¬Ù…Ø§Ø¯", "Ù…Ø¯ÙŠÙ†Ø©"];
  const LETTERS = ["Ø§","Ø¨","Øª","Ø«","Ø¬","Ø­","Ø®","Ø¯","Ø°","Ø±","Ø²","Ø³","Ø´","Øµ","Ø¶","Ø·","Ø¸","Ø¹","Øº","Ù","Ù‚","Ùƒ","Ù„","Ù…","Ù†","Ù‡","Ùˆ","ÙŠ"];

  const UI = {
    mode: null,
    platform: document.getElementById('platform'),
    channel: document.getElementById('channel'),
    roundSeconds: document.getElementById('roundSeconds'),
    startBtn: document.getElementById('startBtn'),
    stopBtn: document.getElementById('stopBtn'),
    connectBtn: document.getElementById('connectBtn'),
    connStatus: document.getElementById('connStatus'),
    categoryPill: document.getElementById('categoryPill'),
    letterPill: document.getElementById('letterPill'),
    timeLeft: document.getElementById('timeLeft'),
    ring: document.getElementById('ring'),
    roundStatus: document.getElementById('roundStatus'),
    playersList: document.getElementById('playersList'),
    soloScores: document.getElementById('soloScores'),
    teamsScores: document.getElementById('teamsScores'),
    blueScore: document.getElementById('blueScore'),
    redScore: document.getElementById('redScore'),
    blueMembers: document.getElementById('blueMembers'),
    redMembers: document.getElementById('redMembers'),
    chatLog: document.getElementById('chatLog'),
    manualBox: document.getElementById('manualBox'),
    manualUser: document.getElementById('manualUser'),
    manualMsg: document.getElementById('manualMsg'),
    manualSend: document.getElementById('manualSend'),
    reviewPanel: document.getElementById('reviewPanel'),
    reviewList: document.getElementById('reviewList'),
    scoreBtn: document.getElementById('scoreBtn'),
    nextRoundBtn: document.getElementById('nextRoundBtn'),
    rememberChk: document.getElementById('rememberChk')
  };

  const state = {
    running: false,
    phase: "idle",
    currentCategory: null,
    currentLetter: null,
    roundEndsAt: 0,
    timerHandle: null,

    soloPlayers: new Map(), // name -> {score}
    teamBlue: new Map(),
    teamRed: new Map(),
    teamScores: {blue:0, red:0},

    submissionsByWord: new Map(),   // word -> Set(playerName)
    submissionsByPlayer: new Map(), // player -> Set(word)

    isConnected: false,
    connectedPlatform: null,
    connFlags: { twitch:false, kick:false }
  };

  const normalizeArabic = (s="") => s
    .replace(/[Ø¥Ø£Ø¢Ø§]/g,"Ø§").replace(/Ù‰/g,"ÙŠ").replace(/Ø¤/g,"Ùˆ").replace(/Ø¦/g,"ÙŠ").replace(/Ø©/g,"Ù‡")
    .replace(/[^\u0600-\u06FF\s]/g,"").trim();

  const startsWithLetter = (word, letter) => {
    const w = normalizeArabic(word); const l = normalizeArabic(letter);
    return w && l && w[0] === l[0];
  };
  const rand = arr => arr[Math.floor(Math.random()*arr.length)];
  const fmtTime = (ms) => {
    ms = Math.max(0, ms); const s = Math.ceil(ms/1000);
    const mm = String(Math.floor(s/60)).padStart(2,"0");
    const ss = String(s % 60).padStart(2,"0");
    return `${mm}:${ss}`;
  };

  const setConnStatus = (ok, platformName=null) => {
    state.isConnected = !!ok; state.connectedPlatform = ok ? platformName : null;
    UI.connStatus.textContent = ok ? `Ù…ØªØµÙ„ Ø¨Ù€ ${platformName}` : `ØºÙŠØ± Ù…ØªØµÙ„`;
    UI.connStatus.className = `status ${ok ? 'ok' : 'bad'}`;
    if(ok) UI.roundStatus.textContent = `ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ ${platformName}. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©.`;
    else UI.roundStatus.textContent = `Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØµØ© ÙˆØ§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø© Ø«Ù… Ø§Ø¶ØºØ· â€œØ§ØªØµØ§Ù„â€.`;
    UI.manualBox.style.display = (UI.platform.value==='offline') ? 'flex' : 'none';
  };

  const logChat = (user, msg, badge=null) => {
    const row = document.createElement('div'); row.className = 'row';

    const left = document.createElement('div');
    const nameSpan = document.createElement('span');
    nameSpan.className = 'name';
    nameSpan.textContent = `@${user}`;
    const dash = document.createTextNode(' â€” ');
    const msgSpan = document.createElement('span');
    msgSpan.textContent = msg;

    left.append(nameSpan, dash, msgSpan);

    const right = document.createElement('div');
    if(badge==='ok'){
      right.innerHTML = `<span class="score" style="background:#144a2f;border-color:#1c6a46">Ø³ÙØ¬Ù„Øª</span>`;
    } else if(badge==='dup'){
      right.innerHTML = `<span class="score" style="background:#4a1420;border-color:#6a1c2c">Ù…ÙƒØ±Ø±Ø©</span>`;
    }

    row.append(left, right);
    UI.chatLog.prepend(row);

    while(UI.chatLog.children.length > 200){ UI.chatLog.lastChild?.remove(); }
  };

  const renderPlayers = () => {
    UI.playersList.innerHTML = "";

    const makePlayerRow = (name, score=null) => {
      const row = document.createElement('div'); row.className='row';
      const nameDiv = document.createElement('div'); nameDiv.className = 'name'; nameDiv.textContent = name;
      row.appendChild(nameDiv);
      if(score !== null){
        const scoreDiv = document.createElement('div'); scoreDiv.className = 'score'; scoreDiv.textContent = String(score ?? 0);
        row.appendChild(scoreDiv);
      }
      return row;
    };

    for(const [name, p] of state.soloPlayers){
      UI.playersList.appendChild(makePlayerRow(name, p.score ?? 0));
    }
    UI.teamsScores.style.display = "none";
    UI.soloScores.style.display = "flex";
    UI.soloScores.innerHTML = "";
    for(const [name, p] of [...state.soloPlayers].sort((a,b)=> (b[1].score||0)-(a[1].score||0))){
      UI.soloScores.appendChild(makePlayerRow(name, p.score ?? 0));
    }
  };

  const ensurePlayer = (name) => state.soloPlayers.has(name);
  const joinSolo = (name) => { if(!state.soloPlayers.has(name)){ state.soloPlayers.set(name, {score:0}); renderPlayers(); } };
  const awardPoint = (name) => { const p = state.soloPlayers.get(name); if(!p) return; p.score = (p.score||0) + 1; };
  const clearSubmissions = () => {
    state.submissionsByWord.clear();
    state.submissionsByPlayer.clear();
    UI.letterPill.setAttribute('data-count', '0');
  };

  const toReviewMode = () => {
    state.phase = "review";
    UI.roundStatus.textContent = "Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª â€” Ø±Ø§Ø¬Ø¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø£Ø¯Ù†Ø§Ù‡ Ø«Ù… Ø§Ø¶ØºØ· Ø§Ø­ØªØ³Ø§Ø¨.";
    UI.reviewPanel.style.display = "flex";
    UI.scoreBtn.disabled = false;
    UI.nextRoundBtn.disabled = true;

    UI.reviewList.innerHTML = "";
    const entries = [...state.submissionsByWord.entries()]
      .sort((a,b)=> a[0].localeCompare(b[0], 'ar'));

    if(entries.length === 0){
      const empty = document.createElement('div');
      empty.className = 'muted';
      empty.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø§Øª Ù…Ø³Ø¬Ù‘Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§ÙˆÙ†Ø¯.";
      UI.reviewList.appendChild(empty);
      return;
    }

    for(const [word, playersSet] of entries){
      const row = document.createElement('div'); row.className = 'review-row';

      const checkbox = document.createElement('input'); checkbox.type = 'checkbox';
      checkbox.dataset.word = word;

      const label = document.createElement('div');
      const strong = document.createElement('strong'); strong.textContent = word;
      const playersDiv = document.createElement('div'); playersDiv.className = 'players';
      playersDiv.textContent = `Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ†: ${[...playersSet].join(", ")}`;
      label.append(strong, playersDiv);

      const count = document.createElement('div');
      count.className = 'badge';
      count.textContent = `${playersSet.size} Ù„Ø§Ø¹Ø¨`;

      row.append(checkbox, label, count);
      UI.reviewList.appendChild(row);
    }
  };

  const startRound = () => {
    state.phase = "play";
    state.currentCategory = ["Ø§Ø³Ù…","Ø­ÙŠÙˆØ§Ù†","Ù†Ø¨Ø§Øª","Ø¬Ù…Ø§Ø¯","Ù…Ø¯ÙŠÙ†Ø©"][Math.floor(Math.random()*5)];
    state.currentLetter = ["Ø§","Ø¨","Øª","Ø«","Ø¬","Ø­","Ø®","Ø¯","Ø°","Ø±","Ø²","Ø³","Ø´","Øµ","Ø¶","Ø·","Ø¸","Ø¹","Øº","Ù","Ù‚","Ùƒ","Ù„","Ù…","Ù†","Ù‡","Ùˆ","ÙŠ"][Math.floor(Math.random()*28)];
    clearSubmissions();

    UI.categoryPill.textContent = state.currentCategory;
    UI.letterPill.textContent = state.currentLetter;
    UI.roundStatus.textContent = "Ø£Ø±Ø³Ù„ÙˆØ§ ÙƒÙ„Ù…Ø§ØªÙƒÙ… ÙÙŠ Ø§Ù„Ø´Ø§Øªâ€¦ (Ø§Ù„Ø§Ø­ØªØ³Ø§Ø¨ Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª)";

    UI.reviewPanel.style.display = "none";
    UI.scoreBtn.disabled = true;
    UI.nextRoundBtn.disabled = true;

    const dur = Math.max(10, Number(UI.roundSeconds.value||60)) * 1000;
    state.roundEndsAt = Date.now() + dur;
    if(state.timerHandle) cancelAnimationFrame(state.timerHandle);
    const tick = () => {
      const left = state.roundEndsAt - Date.now();
      UI.timeLeft.textContent = fmtTime(left);

      const progress = 1 - Math.max(0, Math.min(1, left/dur));
      UI.ring.style.setProperty('--p', `${progress}turn`);

      if(left > 0 && state.running){
        state.timerHandle = requestAnimationFrame(tick);
      } else {
        UI.timeLeft.textContent = "00:00";
        toReviewMode();
      }
    };
    tick();
  };

  function onChatMessage(user, text){
    const msg = text.trim();

    if(/^!Ø¯Ø®ÙˆÙ„$/i.test(msg)){ joinSolo(user); logChat(user, msg); return; }

    if(!state.running || state.phase !== "play" || !state.currentLetter) {
      logChat(user, msg, null);
      return;
    }

    if(!ensurePlayer(user)) return;

    const word = msg.split(/\s+/)[0];
    if(!startsWithLetter(word, state.currentLetter)) {
      logChat(user, msg, null);
      return;
    }

    const keyWord = normalizeArabic(word);

    if (state.submissionsByWord.has(keyWord)) {
      logChat(user, word, 'dup'); 
      return;
    }

    if(!state.submissionsByPlayer.has(user)) state.submissionsByPlayer.set(user, new Set());
    const userSet = state.submissionsByPlayer.get(user);
    if(userSet.has(keyWord)){
      logChat(user, word, 'dup'); 
      return;
    }
    userSet.add(keyWord);

    if(!state.submissionsByWord.has(keyWord)) state.submissionsByWord.set(keyWord, new Set());
    state.submissionsByWord.get(keyWord).add(user);

    UI.letterPill.setAttribute('data-count', String(state.submissionsByWord.size));
    logChat(user, word, 'ok');
  }
  window.onChatMessage = onChatMessage;

  // ====== Ø±Ø¨Ø· ChatBridge Ù…Ø¹ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ======
  ChatBridge.on({
    status: (txt)=> { UI.roundStatus.textContent = txt; },
    badge:  (platform, st)=>{
      if (platform==='twitch') state.connFlags.twitch = (st==='ok');
      if (platform==='kick')   state.connFlags.kick   = (st==='ok');

      const cur = UI.platform.value;
      if (cur==='twitch'){
        setConnStatus(state.connFlags.twitch, state.connFlags.twitch ? 'Twitch' : null);
      } else if (cur==='kick'){
        setConnStatus(state.connFlags.kick, state.connFlags.kick ? 'Kick' : null);
      }
    },
    message: (user, text, platform)=>{ onChatMessage(user, text); }
  });

  // Ø§ØªØµØ§Ù„
  document.getElementById('connectBtn').addEventListener('click', ()=>{
    const platform = UI.platform.value;
    const channel = (UI.channel.value||"").trim();
    const remember = UI.rememberChk?.checked ?? true;

    ChatBridge.disconnect('twitch');
    ChatBridge.disconnect('kick');
    state.connFlags = {twitch:false, kick:false};
    setConnStatus(false, null);

    if(platform==='twitch'){
      if(!channel){ alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ù‚Ù†Ø§Ø© Twitch"); return; }
      ChatBridge.connect('twitch', channel, {remember});
    } else if(platform==='kick'){
      if(!channel){ alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ù‚Ù†Ø§Ø© Kick"); return; }
      ChatBridge.connect('kick', channel, {remember});
    } else {
      setConnStatus(true, "Manual");
      UI.roundStatus.textContent = "ÙˆØ¶Ø¹ Manual: Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¯Ø®Ù„ Ø¨Ø§Ù„Ø£Ø³ÙÙ„ Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø´Ø§Øª.";
      UI.manualBox.style.display = 'flex';
    }
  });

  // Ø§Ù„Ù…Ù†ØµØ©
  UI.platform.addEventListener('change', ()=>{
    if (UI.platform.value==='twitch'){
      UI.channel.value = ChatBridge.getSaved('twitch') || "";
      setConnStatus(false, null);
      UI.manualBox.style.display = 'none';
    } else if (UI.platform.value==='kick'){
      UI.channel.value = ChatBridge.getSaved('kick') || "";
      setConnStatus(false, null);
      UI.manualBox.style.display = 'none';
    } else {
      UI.channel.value = "";
      setConnStatus(true, "Manual");
      UI.manualBox.style.display = 'flex';
    }
  });

  // ØªØ¹Ø¨Ø¦Ø© Ù…Ø¨Ø¯Ø¦ÙŠØ©
  window.addEventListener('DOMContentLoaded', ()=>{
    const initial = UI.platform.value || 'twitch';
    UI.channel.value = ChatBridge.getSaved(initial) || "";
  });

  const startGame = () => {
    const platform = UI.platform.value;
    if(platform!=='offline'){
      const ok = (platform==='twitch') ? state.connFlags.twitch : state.connFlags.kick;
      if(!ok){ alert("Ø§ØªØµÙ„ Ø£ÙˆÙ„Ù‹Ø§ Ø¨Ø§Ù„Ù…Ù†ØµØ© Ø¹Ø¨Ø± Ø²Ø± 'Ø§ØªØµØ§Ù„'. Ø£Ùˆ Ø§Ø®ØªØ± Manual."); return; }
    }
    state.running = true;

    // ØªØµÙÙŠØ± Ù†Ù‚Ø§Ø· Ø§Ù„Ø³ÙˆÙ„Ùˆ ÙÙ‚Ø·
    for (const [name, p] of state.soloPlayers) { p.score = 0; }
    renderPlayers();

    UI.soloScores.style.display = "flex";
    UI.teamsScores.style.display = "none";
    UI.manualBox.style.display = (platform==='offline') ? 'flex' : 'none';
    startRound();
  };

  const stopGame = () => {
    state.running = false;
    state.phase = "idle";
    if(state.timerHandle) cancelAnimationFrame(state.timerHandle);
    UI.timeLeft.textContent = "00:00";
    UI.roundStatus.textContent = "Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…ØªÙˆÙ‚ÙØ©.";
    UI.reviewPanel.style.display = "none";
  };

  UI.scoreBtn.addEventListener('click', ()=>{
    if(state.phase !== "review") return;

    const checks = [...UI.reviewList.querySelectorAll('input[type="checkbox"]')];
    const approved = checks.filter(c=>c.checked).map(c=>c.dataset.word);

    for (const w of approved){
      const players = state.submissionsByWord.get(w);
      if (!players) continue;
      for (const name of players){
        if (ensurePlayer(name)) awardPoint(name);
      }
    }

    renderPlayers();
    UI.scoreBtn.disabled = true;
    UI.nextRoundBtn.disabled = false;
    UI.roundStatus.textContent = "ØªÙ… Ø§Ù„Ø§Ø­ØªØ³Ø§Ø¨ â€” Ø§Ø¶ØºØ· â€œØ§Ù„ØªØ§Ù„ÙŠâ€ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©.";
  });

  UI.nextRoundBtn.addEventListener('click', ()=>{ if(!state.running) return; startRound(); });
  UI.startBtn.addEventListener('click', startGame);
  UI.stopBtn.addEventListener('click', stopGame);

  // Manual
  UI.manualSend.addEventListener('click', ()=>{
    const u = UI.manualUser.value.trim() || "Guest";
    const m = UI.manualMsg.value.trim();
    if(!m) return;
    onChatMessage(u, m);
    UI.manualMsg.value = "";
    UI.manualMsg.focus();
  });
  UI.manualMsg.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ UI.manualSend.click(); }});
  UI.manualUser.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ UI.manualMsg.focus(); }});

  // Ø·ÙŠ Ø§Ù„Ø£Ù„ÙˆØ§Ø­
  const connWrap = document.getElementById('connWrap');
  const strWrap  = document.getElementById('strWrap');
  document.getElementById('connHead').addEventListener('click', ()=> connWrap.classList.toggle('panel-open'));
  document.getElementById('strHead').addEventListener('click', ()=> strWrap.classList.toggle('panel-open'));
  // Ø§ÙØªØ­Ù‡Ù… Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§
  connWrap.classList.add('panel-open');
  strWrap.classList.add('panel-open');

  // Ù†Ø§ÙØ°Ø© Ø§Ù„Ø´Ø±Ø­
  const helpBtn = document.getElementById('helpBtn');
  const helpModal = document.getElementById('helpModal');
  const closeHelp = document.getElementById('closeHelp');
  helpBtn.addEventListener('click', ()=> helpModal.style.display='flex');
  closeHelp.addEventListener('click', ()=> helpModal.style.display='none');
  helpModal.addEventListener('click', (e)=>{ if(e.target===helpModal) helpModal.style.display='none'; });

  // ØªÙ†Ø¸ÙŠÙ
  UI.channel.value = "";
  </script>
</body>
</html>
