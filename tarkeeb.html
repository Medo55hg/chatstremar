<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ğŸ¯ ØªØ±ÙƒÙŠØ¨ Ø§Ù„ÙƒÙ„Ù…Ø§Øª</title>
  <link rel="stylesheet" href="style.css">
  <script src="tmi.min.js"></script>
  <style>
   body { background: #111; color: #fff; font-family: 'Cairo', sans-serif; text-align: center; padding: 20px; }
    h1 { color: #ff3333; margin-top: 10px; }
    .teams-container { display: flex; justify-content: center; align-items: flex-start; margin: 40px auto; width: 100%; gap: 40px; flex-wrap: wrap; }
    .team { width: 250px; padding: 15px; border-radius: 15px; text-align: center; box-shadow: 0 0 10px rgba(0,0,0,0.5); }
    .team-blue { background-color: #0b0f2e; border: 2px solid #0099ff; }
    .team-red { background-color: #2e0b0b; border: 2px solid #ff3333; }
    .players-list { background: #333; padding: 10px; border-radius: 8px; min-height: 50px; font-size: 18px; text-align: right; color: #fff; }
    .player-entry { display: flex; justify-content: space-between; align-items: center; margin: 2px 0; }
    .player-input { width: 90%; padding: 10px; font-size: 16px; margin: 10px 0; border-radius: 8px; border: none; background: #3a3a3a; color: #ccc; text-align: center; }
    .add-btn { background-color: #cc0000; color: white; padding: 8px 16px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; margin-bottom: 10px; }
    .add-btn span { color: #00ccff; font-weight: bold; margin-right: 5px; }
    .game-description { flex: 1; max-width: 500px; background: #222; border: 1px solid #888; border-radius: 10px; padding: 20px; font-size: 18px; line-height: 1.8; }
    .game-description strong { color: #00ff99; }
    .commands-highlight { color: #ff3333; font-weight: bold; margin-top: 10px; display: block; }
    .commands-highlight .blue { color: #0099ff; }
    .commands-highlight .red { color: #ff4444; }
    button { padding: 10px 20px; font-size: 18px; background: #444; color: white; border: none; border-radius: 8px; cursor: pointer; margin: 5px; }
    button:hover { background: #555; }
    .game-box { margin-top: 40px; max-width: 800px; margin-inline: auto; border-radius: 15px; padding: 30px 20px; }
    .team-turn-blue { background: rgba(0, 60, 120, 0.3); border: 2px solid #0099ff; }
    .team-turn-red { background: rgba(120, 0, 0, 0.3); border: 2px solid #ff3333; }
    .letter-used { background-color: #27ae60 !important; border-color: #1e8449 !important; }
    .word-point { color: #f1c40f; font-weight: bold; }
    .score-table { width: 100%; margin-top: 20px; border-collapse: collapse; }
    .score-table th, .score-table td { padding: 10px; border: 1px solid #444; text-align: center; }
    .score-table th { background-color: #333; }
    .score-table tr:nth-child(even) { background-color: #222; }
    .score-table tr:hover { background-color: #2a2a2a; }
  </style>
</head>
<body>
  <h1>ğŸ¯ ØªØ±ÙƒÙŠØ¨ Ø§Ù„ÙƒÙ„Ù…Ø§Øª</h1>

  <div class="teams-container">
    <div class="team team-blue">
      <h3>ğŸ”µ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚</h3>
      <input type="text" id="bluePlayerInput" class="player-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨">
      <button class="add-btn" onclick="addPlayerFromInput('blue')"><span>+</span>Ø¥Ø¶Ø§ÙØ©</button>
      <div id="bluePlayers" class="players-list"></div>
    </div>

    <div class="game-description">
      âœ… <strong>Ø´Ø±Ø­ Ø§Ù„Ù„Ø¹Ø¨Ø©:</strong><br>
      Ø³ØªØ¸Ù‡Ø± Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ø­Ø±ÙˆÙ ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„Ø´Ø§Ø´Ø©.<br>
      Ø¹Ù„Ù‰ Ø§Ù„ÙØ±ÙŠÙ‚ ØªØ±ÙƒÙŠØ¨ Ø£ÙƒØ¨Ø± Ø¹Ø¯Ø¯ Ù…Ù…ÙƒÙ† Ù…Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø© Ø®Ù„Ø§Ù„ 5 Ø¯Ù‚Ø§Ø¦Ù‚.<br>
      ÙƒÙ„ ÙƒÙ„Ù…Ø© = 1 Ù†Ù‚Ø·Ø© ğŸ†<br>
      Ø§Ù„ÙØ§Ø¦Ø² Ù‡Ùˆ Ù…Ù† ÙŠØ¬Ù…Ø¹ Ø£ÙƒØ«Ø± Ù†Ù‚Ø§Ø·!<br>
      <span class="commands-highlight">
        ğŸ“„ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø´Ø§Øª:<br>
        <span class="blue">ğŸ”µ !Ø§Ø²Ø±Ù‚</span> Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚<br>
        <span class="red">ğŸ”´ !Ø§Ø­Ù…Ø±</span> Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø­Ù…Ø±
      </span>
      
      <table class="score-table">
        <thead>
          <tr>
            <th>Ø§Ù„Ø¬ÙˆÙ„Ø©</th>
            <th>Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚</th>
            <th>Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø­Ù…Ø±</th>
          </tr>
        </thead>
        <tbody id="scoreTableBody">
          <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
        </tbody>
        <tfoot>
          <tr>
            <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
            <th id="blueTotalScore">0</th>
            <th id="redTotalScore">0</th>
          </tr>
        </tfoot>
      </table>
    </div>

    <div class="team team-red">
      <h3>ğŸ”´ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø­Ù…Ø±</h3>
      <input type="text" id="redPlayerInput" class="player-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨">
      <button class="add-btn" onclick="addPlayerFromInput('red')"><span>+</span>Ø¥Ø¶Ø§ÙØ©</button>
      <div id="redPlayers" class="players-list"></div>
    </div>
  </div>

  <div id="gameBox" class="game-box">
    <div class="info">
      <div class="category" id="category" style="font-size: 26px; font-weight: bold; margin-bottom: 10px;">Ø§Ù„ÙØ¦Ø©: ...</div>
      <div class="timer" id="timer" style="font-size: 24px; color: #ffcc00; font-weight: bold;">Ø§Ù„ÙˆÙ‚Øª: 5:00</div>
      <div id="currentTeam" style="font-size: 20px; margin-top: 10px;">Ø§Ù„Ø¯ÙˆØ±: Ù„Ø§ Ø£Ø­Ø¯</div>
      <div id="pointsInfo" style="font-size: 18px; margin-top: 5px; color: #f1c40f;"></div>
    </div>

    <div class="controls" style="margin: 20px 0;">
      <button onclick="startRound()">ğŸ® Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¬ÙˆÙ„Ø©</button>
      <button onclick="resetGame()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
    </div>

    <div class="letters" id="letters" style="display: flex; flex-wrap: wrap; justify-content: center; max-width: 600px; margin: 0 auto; gap: 8px;"></div>
    <div class="words-found" id="wordsFound" style="margin-top: 20px; max-width: 400px; margin-inline: auto; text-align: right;"></div>
  </div>

  <div style="margin-top: 40px;">
    <h2>ğŸ› ï¸ Ø±Ø¨Ø· Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø§Ù„Ø´Ø§Øª</h2>
    <select id="platformSelect" style="padding:10px;font-size:18px;">
      <option value="twitch">Twitch</option>
      <option value="kick">Kick</option>
    </select>
    <input type="text" id="channelInput" placeholder="ğŸ® Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø©" style="padding:10px;font-size:18px;">
    <button onclick="connectChat()" style="padding:10px;font-size:18px;background:#28a745;color:#fff;border:none;border-radius:6px;cursor:pointer;">
      âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    </button>
    <div id="chatStatus" style="margin-top:10px;font-size:16px;color:#0f0;"></div>
  </div>

<script>
// Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
let bluePlayers = [];
let redPlayers = [];
let currentTeam = '';
let currentTeamIndex = 0;
let roundTimer;
let secondsLeft = 300;
let foundWords = [];
let roundWords = [];
let roundLetters = [];
let availableLetters = [];
let chatClient = null;
let kickSocket = null;
let totalPoints = 0;
let roundScores = []; // Ù„ØªØ®Ø²ÙŠÙ† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª

// ÙØ¦Ø§Øª Ø§Ù„ÙƒÙ„Ù…Ø§Øª
const allCategories = {
  "Ø­ÙŠÙˆØ§Ù†Ø§Øª": [
    "Ø£Ø³Ø¯", "Ù†Ù…Ø±", "ÙÙ‡Ø¯", "Ø°Ø¦Ø¨", "Ø¯Ø¨", "Ø²Ø±Ø§ÙØ©", "ÙÙŠÙ„", "ØºØ²Ø§Ù„", "Ø¶Ø¨Ø¹", "Ø«Ø¹Ù„Ø¨",
    "Ù‚Ø±Ø¯", "Ø¨Ø§Ù†Ø¯Ø§", "ØºÙˆØ±ÙŠÙ„Ø§", "Ø´Ù…Ø¨Ø§Ù†Ø²ÙŠ", "Ø¸Ø¨ÙŠ", "Ù†Ù…Ø³", "ÙƒÙ†ØºØ±", "Ø®Ù†Ø²ÙŠØ±", "Ø¬Ø§Ù…ÙˆØ³", "Ø±Ø§ÙƒÙˆÙ†",
    "Ù‚Ù†ÙØ°", "Ø®ÙØ§Ø´", "Ø³Ù†Ø¬Ø§Ø¨", "Ù‚Ù†Ø¯Ø³", "Ø¸Ø±Ø¨Ø§Ù†", "ÙƒÙˆØ§Ù„Ø§", "Ø¨Ø§Ù†ØºÙˆÙ„ÙŠÙ†", "Ø£Ø±Ù…Ø§Ø¯ÙŠÙ„Ùˆ", "ÙÙ‡Ø¯", "Ø°Ø¦Ø¨",
    "Ø«Ø¹Ù„Ø¨", "Ø¶Ø¨Ø¹", "Ù†Ù…Ø±", "Ø£Ø³Ø¯", "Ø²Ø±Ø§ÙØ©", "ÙÙŠÙ„", "ØºØ²Ø§Ù„", "Ø¯Ø¨", "Ø¨Ø§Ù†Ø¯Ø§", "ØºÙˆØ±ÙŠÙ„Ø§",
    "Ø´Ù…Ø¨Ø§Ù†Ø²ÙŠ", "Ø¸Ø¨ÙŠ", "Ù†Ù…Ø³", "ÙƒÙ†ØºØ±", "Ø®Ù†Ø²ÙŠØ±", "Ø¬Ø§Ù…ÙˆØ³", "Ø±Ø§ÙƒÙˆÙ†", "Ù‚Ù†ÙØ°", "Ø®ÙØ§Ø´", "Ø³Ù†Ø¬Ø§Ø¨"
  ],
  
  "ÙÙˆØ§ÙƒÙ‡ ÙˆØ®Ø¶Ø±ÙˆØ§Øª": [
    "ØªÙØ§Ø­", "Ù…ÙˆØ²", "Ø¨Ø±ØªÙ‚Ø§Ù„", "Ù„ÙŠÙ…ÙˆÙ†", "Ø±Ù…Ø§Ù†", "Ø¹Ù†Ø¨", "ØªÙ…Ø±", "Ø®ÙˆØ®", "ÙƒÙ…Ø«Ø±Ù‰", "Ù…Ø§Ù†Ø¬Ùˆ",
    "ÙØ±Ø§ÙˆÙ„Ø©", "ØªÙˆØª", "Ø£Ù†Ø§Ù†Ø§Ø³", "Ø¨Ø·ÙŠØ®", "Ø´Ù…Ø§Ù…", "ÙƒØ±Ø²", "Ø¬Ø±ÙŠØ¨ ÙØ±ÙˆØª", "ÙƒÙŠÙˆÙŠ", "Ù„ÙŠØªØ´ÙŠ", "Ù…Ø´Ù…Ø´",
    "Ø¬ÙˆØ§ÙØ©", "Ø³ÙØ±Ø¬Ù„", "ØªÙŠÙ†", "Ø²ÙŠØªÙˆÙ†", "Ù†Ø¨Ù‚", "Ø¨Ø§Ø´Ù† ÙØ±ÙˆØª", "ÙƒØ±Ø§Ù…Ø¨ÙˆÙ„Ø§", "ØªÙˆØª Ø´ÙˆÙƒÙŠ", "Ø³Ø¯Ø±", "Ø£ÙÙˆÙƒØ§Ø¯Ùˆ",
    "Ø¨ØµÙ„", "Ø«ÙˆÙ…", "Ø·Ù…Ø§Ø·Ù…", "Ø®ÙŠØ§Ø±", "Ø¬Ø²Ø±", "ÙØ¬Ù„", "Ø¨Ø§Ø°Ù†Ø¬Ø§Ù†", "ÙƒÙˆØ³Ø§", "Ø³Ø¨Ø§Ù†Ø®", "Ù…Ù„ÙÙˆÙ",
    "Ø®Ø³", "Ø¬Ø±Ø¬ÙŠØ±", "Ø´Ø¨Øª", "Ø¨Ù‚Ø¯ÙˆÙ†Ø³", "ÙƒØ²Ø¨Ø±Ø©", "Ø²Ù†Ø¬Ø¨ÙŠÙ„", "ÙƒØ±ÙƒÙ…", "ÙÙ„ÙÙ„", "Ø¨Ø·Ø§Ø·Ø§", "Ø¨Ø·Ø§Ø·Ø³"
  ],
  
  "Ù…Ø¯Ù† ÙˆØ¯ÙˆÙ„": [
    "Ø±ÙŠØ§Ø¶", "Ø¬Ø¯Ø©", "Ø¯Ø¨ÙŠ", "Ø¨ÙŠØ±ÙˆØª", "Ø¯Ù…Ø´Ù‚", "Ø¨ØºØ¯Ø§Ø¯", "Ø¹Ù…Ø§Ù†", "Ø§Ù„Ø¯ÙˆØ­Ø©", "Ø§Ù„ÙƒÙˆÙŠØª", "Ù…Ø³Ù‚Ø·",
    "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©", "Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©", "Ø·Ø±Ø§Ø¨Ù„Ø³", "ØªÙˆÙ†Ø³", "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±", "Ø§Ù„Ø±Ø¨Ø§Ø·", "Ø§Ù„Ø¯Ø§Ø± Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡", "Ù†ÙˆØ§ÙƒØ´ÙˆØ·", "Ø§Ù„Ø®Ø±Ø·ÙˆÙ…", "ØµÙ†Ø¹Ø§Ø¡",
    "Ù…ÙƒØ©", "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©", "Ø§Ù„Ù‚Ø¯Ø³", "Ø§Ø³Ø·Ù†Ø¨ÙˆÙ„", "Ø£Ù†Ù‚Ø±Ø©", "Ø£Ø«ÙŠÙ†Ø§", "Ø±ÙˆÙ…Ø§", "Ø¨Ø§Ø±ÙŠØ³", "Ù„Ù†Ø¯Ù†", "Ø¨Ø±Ù„ÙŠÙ†",
    "Ù…Ø¯Ø±ÙŠØ¯", "Ø¨Ø±Ø´Ù„ÙˆÙ†Ø©", "Ù…ÙˆØ³ÙƒÙˆ", "Ù†ÙŠÙˆÙŠÙˆØ±Ùƒ", "ÙˆØ§Ø´Ù†Ø·Ù†", "Ø¨ÙˆØ³Ø·Ù†", "Ù„ÙˆØ³ Ø£Ù†Ø¬Ù„ÙˆØ³", "Ø´ÙŠÙƒØ§ØºÙˆ", "ØªÙˆØ±Ù†ØªÙˆ", "Ù…ÙˆÙ†ØªØ±ÙŠØ§Ù„",
    "Ø³ÙŠØ¯Ù†ÙŠ", "Ù…Ù„Ø¨ÙˆØ±Ù†", "Ø·ÙˆÙƒÙŠÙˆ", "Ø£ÙˆØ³Ø§ÙƒØ§", "Ø³ÙŠØ¤ÙˆÙ„", "Ø¨ÙƒÙŠÙ†", "Ø´Ù†ØºÙ‡Ø§ÙŠ", "Ù‡ÙˆÙ†Øº ÙƒÙˆÙ†Øº", "Ø³Ù†ØºØ§ÙÙˆØ±Ø©", "Ø¨Ø§Ù†ÙƒÙˆÙƒ"
  ],
  
  "Ù…Ø§Ø±ÙƒØ§Øª": [
    "Ù†Ø§ÙŠÙƒÙŠ", "Ø£Ø¯ÙŠØ¯Ø§Ø³", "Ø¨ÙˆÙ…Ø©", "Ø¬ÙˆØªØ´ÙŠ", "ÙØ±Ø³Ø§ØªØ´ÙŠ", "Ù„ÙˆÙŠØ³ ÙÙˆÙŠØªÙˆÙ†", "Ø´Ø§Ù†ÙŠÙ„", "Ù‡ÙŠØ±Ù…ÙŠØ³", "Ø¨Ø±Ø§Ø¯Ø§", "Ø¯ÙˆÙ„ØªØ´ÙŠ",
    "ØºØ§Ø¨Ø§Ù†Ø§", "Ø£Ø±Ù…Ø§Ù†ÙŠ", "ÙÙŠØ±Ø³Ø§ØªØ´ÙŠ", "ÙƒØ§Ù„ÙÙ† ÙƒÙ„Ø§ÙŠÙ†", "ØªÙˆÙ…ÙŠ Ù‡ÙŠÙ„ÙÙŠØºØ±", "Ù‡ÙˆØºÙˆ Ø¨ÙˆØ³", "Ù„Ø§ÙƒÙˆØ³Øª", "Ø±Ø§Ù„Ù Ù„ÙˆØ±ÙŠÙ†", "Ø¨ÙˆØ±Ø¨ÙŠØ±ÙŠ", "Ù…Ø§ÙŠÙƒÙ„ ÙƒÙˆØ±Ø³",
    "Ø²Ø§Ø±Ø§", "Ø¥ØªØ´ Ø¢Ù†Ø¯ Ø¥Ù…", "ÙŠÙˆÙ†ÙŠÙƒÙ„Ùˆ", "Ø¨ÙŠÙ…Ùˆ", "Ø¬Ø§Ø¨", "Ø¨ÙŠÙ†ÙŠØªÙˆÙ†", "Ø³ÙŠØ³Ù„ÙŠ", "Ø¯ÙŠØ¯ÙŠ", "ÙƒØ§Ø±ØªÙŠØ±", "ØªÙŠÙØ§Ù†ÙŠ",
    "Ø±ÙˆÙ„ÙƒØ³", "Ø£ÙˆÙ…ÙŠØºØ§", "Ø¨Ø±ÙŠØªÙ„ÙŠÙ†Øº", "ØªØ§Øº Ù‡ÙˆÙŠØ±", "Ø¨Ø§Ø«ÙŠÙƒ ÙÙŠÙ„ÙŠØ¨", "Ø¢Ø¨Ù„", "Ø³Ø§Ù…Ø³ÙˆÙ†Ø¬", "Ø³ÙˆÙ†ÙŠ", "Ù‡ÙˆØ§ÙˆÙŠ", "Ø¥Ù„ Ø¬ÙŠ",
    "Ù†ÙˆÙƒÙŠØ§", "Ø¨Ù„Ø§Ùƒ Ø¨ÙŠØ±ÙŠ", "Ù…Ø§ÙŠÙƒØ±ÙˆØ³ÙˆÙØª", "ØºÙˆØºÙ„", "Ø£Ù…Ø§Ø²ÙˆÙ†", "ÙÙŠØ³Ø¨ÙˆÙƒ", "ØªÙˆÙŠØªØ±", "Ø¥Ù†Ø³ØªØºØ±Ø§Ù…", "Ø³Ù†Ø§Ø¨ Ø´Ø§Øª", "ØªÙŠÙƒ ØªÙˆÙƒ"
  ],
  
  "Ø³ÙŠØ§Ø±Ø§Øª": [
    "ØªÙˆÙŠÙˆØªØ§", "Ù‡ÙˆÙ†Ø¯Ø§", "Ù†ÙŠØ³Ø§Ù†", "ÙÙˆØ±Ø¯", "Ø´ÙŠÙØ±ÙˆÙ„ÙŠÙ‡", "Ø¨ÙŠ Ø¥Ù… Ø¯Ø¨Ù„ÙŠÙˆ", "Ù…Ø±Ø³ÙŠØ¯Ø³", "Ø£ÙˆØ¯ÙŠ", "ÙÙˆÙ„ÙƒØ³ÙØ§ØºÙ†", "Ø¨ÙˆØ±Ø´",
    "ÙÙŠØ±Ø§Ø±ÙŠ", "Ù„Ø§Ù…Ø¨ÙˆØ±ØºÙŠÙ†ÙŠ", "Ø¨Ù†ØªÙ„ÙŠ", "Ø±ÙˆÙ„Ø² Ø±ÙˆÙŠØ³", "Ø¬Ø§ØºÙˆØ§Ø±", "Ù„Ø§Ù†Ø¯ Ø±ÙˆÙØ±", "ØªÙŠØ³Ù„Ø§", "ÙƒÙŠØ§", "Ù‡ÙŠÙˆÙ†Ø¯Ø§ÙŠ", "Ù…Ø§Ø²Ø¯Ø§",
    "Ø³ÙˆØ¨Ø§Ø±Ùˆ", "Ù…ÙŠØªØ³ÙˆØ¨ÙŠØ´ÙŠ", "Ù„ÙƒØ²Ø³", "Ø¥Ù†ÙÙŠÙ†ÙŠØªÙŠ", "Ø£ÙƒÙˆØ±Ø§", "ÙƒØ§Ø¯ÙŠÙ„Ø§Ùƒ", "Ù„ÙŠÙ†ÙƒÙˆÙ„Ù†", "Ø¬ÙŠØ¨", "Ø¯ÙˆØ¯Ø¬", "ÙƒØ±Ø§ÙŠØ³Ù„Ø±",
    "Ø±Ø§Ù…", "ÙÙŠØ§Øª", "Ø£Ù„ÙØ§ Ø±ÙˆÙ…ÙŠÙˆ", "Ù…Ø§Ø²ÙŠØ±Ø§ØªÙŠ", "Ø£Ø³ØªÙˆÙ† Ù…Ø§Ø±ØªÙ†", "Ù…ÙƒÙ„Ø§Ø±ÙŠÙ†", "Ø¨ÙˆØºØ§ØªÙŠ", "ÙƒÙˆØ¨Ø±Ø§", "Ù„ÙˆØªØ³", "Ø³ÙŠØ§Øª",
    "Ø³ÙƒÙˆØ¯Ø§", "Ø±ÙŠÙ†Ùˆ", "Ø¨ÙŠØ¬Ùˆ", "Ø³ÙŠØªØ±ÙˆÙŠÙ†", "ÙÙˆÙ„ÙÙˆ", "Ø³Ø§Ø¨", "Ø£ÙˆØ¨Ù„", "Ù…ÙŠÙ†ÙŠ", "Ø³Ù…Ø§Ø±Øª", "Ù…Ø§ÙŠØ¨Ø§Ø®"
  ]
};

// Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø©
function startRound() {
  // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø­Ø§Ù„ÙŠ
  currentTeam = currentTeamIndex % 2 === 0 ? 'blue' : 'red';
  currentTeamIndex++;
  
  // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  document.getElementById('currentTeam').textContent = currentTeam === 'blue' ? 'ğŸ”µ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚' : 'ğŸ”´ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø­Ù…Ø±';
  document.getElementById('gameBox').className = currentTeam === 'blue' ? 'game-box team-turn-blue' : 'game-box team-turn-red';
  
  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ø¬ÙˆÙ„Ø©
  foundWords = [];
  totalPoints = 0;
  document.getElementById('wordsFound').innerHTML = '';
  document.getElementById('pointsInfo').textContent = '';
  secondsLeft = 300;
  updateTimer();
  clearInterval(roundTimer);
  
  // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø­Ø±ÙˆÙ ÙˆØ§Ù„ÙƒÙ„Ù…Ø§Øª
  generateRoundWords();
  showLetters();
  
  // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
  roundTimer = setInterval(() => {
    secondsLeft--;
    updateTimer();
    if (secondsLeft <= 0) {
      endRound();
    }
  }, 1000);
}

// ØªÙˆÙ„ÙŠØ¯ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¬ÙˆÙ„Ø©
function generateRoundWords() {
  const categories = Object.keys(allCategories);
  const randomCategory = categories[Math.floor(Math.random() * categories.length)];
  const wordList = [...allCategories[randomCategory]];
  shuffleArray(wordList);
  
  // Ø§Ø®ØªÙŠØ§Ø± 7 ÙƒÙ„Ù…Ø§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù…Ù† Ø§Ù„ÙØ¦Ø©
  roundWords = wordList.slice(0, 7);
  document.getElementById('category').textContent = `Ø§Ù„ÙØ¦Ø©: ${randomCategory}`;
  
  // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø­Ø±ÙˆÙ Ù…Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© (Ù…Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±)
  roundLetters = [];
  roundWords.forEach(word => {
    roundLetters.push(...word.split(''));
  });
  availableLetters = [...roundLetters];
  shuffleArray(roundLetters);
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø±ÙˆÙ
function showLetters() {
  const container = document.getElementById('letters');
  container.innerHTML = '';
  
  roundLetters.forEach((ch, index) => {
    const div = document.createElement('div');
    div.className = 'letter';
    div.id = `letter-${index}`;
    div.textContent = ch;
    div.style = `
      width: 60px; height: 60px; 
      margin: 0; font-size: 24px; 
      font-weight: bold; border-radius: 12px; 
      background-color: #1a1a1a; 
      display: flex; align-items: center; 
      justify-content: center; 
      border: 2px solid #333; 
      color: #fff;
    `;
    container.appendChild(div);
  });
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¤Ù‚Øª
function updateTimer() {
  const min = Math.floor(secondsLeft / 60);
  const sec = secondsLeft % 60;
  document.getElementById('timer').textContent = `Ø§Ù„ÙˆÙ‚Øª: ${min}:${sec.toString().padStart(2, '0')}`;
}

// Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬ÙˆÙ„Ø©
function endRound() {
  clearInterval(roundTimer);
  
  // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
  const wordPoints = foundWords.length;
  totalPoints = wordPoints;
  
  document.getElementById('pointsInfo').textContent = `Ø§Ù„Ù†Ù‚Ø§Ø·: ${wordPoints}`;
  document.getElementById('gameBox').className = 'game-box';
  document.getElementById('currentTeam').textContent = 'Ø§Ù„Ø¯ÙˆØ±: Ù„Ø§ Ø£Ø­Ø¯';
  
  // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø­Ø±ÙˆÙ ØºÙŠØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
  const letters = document.querySelectorAll('.letter');
  letters.forEach(letter => {
    if (!letter.classList.contains('letter-used')) {
      letter.style.visibility = 'hidden';
    }
  });
  
  // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†Ù‚Ø§Ø·
  updateScoreTable(wordPoints);
}

// ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†Ù‚Ø§Ø·
function updateScoreTable(points) {
  const roundNumber = roundScores.length + 1;
  const blueScore = currentTeam === 'blue' ? points : 0;
  const redScore = currentTeam === 'red' ? points : 0;
  
  roundScores.push({
    round: roundNumber,
    blue: blueScore,
    red: redScore
  });
  
  const tableBody = document.getElementById('scoreTableBody');
  tableBody.innerHTML = '';
  
  roundScores.forEach(score => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${score.round}</td>
      <td>${score.blue}</td>
      <td>${score.red}</td>
    `;
    tableBody.appendChild(row);
  });
  
  // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ
  const blueTotal = roundScores.reduce((sum, score) => sum + score.blue, 0);
  const redTotal = roundScores.reduce((sum, score) => sum + score.red, 0);
  
  document.getElementById('blueTotalScore').textContent = blueTotal;
  document.getElementById('redTotalScore').textContent = redTotal;
}

// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø´Ø§Øª
function onChatMessage(username, message) {
  if (!currentTeam || foundWords.length >= roundWords.length) return;
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ø³Ø¬Ù„ ÙÙŠ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø­Ø§Ù„ÙŠ
  const currentTeamPlayers = currentTeam === 'blue' ? bluePlayers : redPlayers;
  if (!currentTeamPlayers.includes(username)) return;
  
  const clean = message.trim();
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„ÙƒÙ„Ù…Ø©
  if (roundWords.includes(clean) && !foundWords.includes(clean)) {
    if (canFormWord(clean)) {
      foundWords.push(clean);
      markLetters(clean);
      
      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·
      const wordPoints = 1;
      totalPoints = wordPoints;
      
      document.getElementById('wordsFound').innerHTML += `
        <div style='
          background: #1f1f1f;
          padding: 8px 12px;
          border-radius: 8px;
          margin-bottom: 6px;
          border: 1px solid #333;
        '>
          âœ… ${clean} - ${username} 
          <span class="word-point">(${wordPoints} Ù†Ù‚Ø·Ø©)</span>
        </div>
      `;
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª
      if (foundWords.length === roundWords.length) {
        endRound();
      }
    }
  }
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠÙ…ÙƒÙ† ØªÙƒÙˆÙŠÙ† Ø§Ù„ÙƒÙ„Ù…Ø© Ù…Ù† Ø§Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ù…ØªØ§Ø­Ø©
function canFormWord(word) {
  const tempAvailableLetters = [...availableLetters];
  const wordLetters = word.split('');
  
  for (const letter of wordLetters) {
    const index = tempAvailableLetters.indexOf(letter);
    if (index === -1) return false;
    tempAvailableLetters.splice(index, 1);
  }
  
  return true;
}

// ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
function markLetters(word) {
  const wordLetters = word.split('');
  const lettersToMark = [...wordLetters];
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ù…ØªØ§Ø­Ø©
  for (const letter of wordLetters) {
    const index = availableLetters.indexOf(letter);
    if (index !== -1) {
      availableLetters.splice(index, 1);
    }
  }
  
  // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø­Ø±ÙˆÙ ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
  const letters = document.querySelectorAll('.letter');
  letters.forEach(letter => {
    if (lettersToMark.includes(letter.textContent) && !letter.classList.contains('letter-used')) {
      letter.classList.add('letter-used');
      lettersToMark.splice(lettersToMark.indexOf(letter.textContent), 1);
    }
  });
}

// Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨ Ù…Ù† ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
function addPlayerFromInput(team) {
  const inputId = team === 'blue' ? 'bluePlayerInput' : 'redPlayerInput';
  const username = document.getElementById(inputId).value.trim();
  
  if (username) {
    addPlayerFromChat(team, username);
    document.getElementById(inputId).value = '';
  }
}

// Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨ Ù…Ù† Ø§Ù„Ø´Ø§Øª
function addPlayerFromChat(team, username) {
  const listId = team === 'blue' ? 'bluePlayers' : 'redPlayers';
  const players = team === 'blue' ? bluePlayers : redPlayers;
  const otherTeamPlayers = team === 'blue' ? redPlayers : bluePlayers;

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙÙŠ Ø£ÙŠ ÙØ±ÙŠÙ‚
  if (username && !players.includes(username) && !otherTeamPlayers.includes(username)) {
    players.push(username);
    updatePlayersList(team);
  }
}

// ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
function updatePlayersList(team) {
  const listId = team === 'blue' ? 'bluePlayers' : 'redPlayers';
  const players = team === 'blue' ? bluePlayers : redPlayers;
  const container = document.getElementById(listId);
  
  container.innerHTML = '';
  players.forEach(player => {
    const entry = document.createElement('div');
    entry.className = 'player-entry';
    entry.innerHTML = `<span>â€¢ ${player}</span>`;
    container.appendChild(entry);
  });
}

// Ø®Ù„Ø· Ø§Ù„Ù…ØµÙÙˆÙØ©
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

// Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©
function resetGame() {
  clearInterval(roundTimer);
  bluePlayers = [];
  redPlayers = [];
  currentTeam = '';
  currentTeamIndex = 0;
  foundWords = [];
  roundWords = [];
  roundLetters = [];
  availableLetters = [];
  totalPoints = 0;
  roundScores = [];
  
  document.getElementById('bluePlayers').innerHTML = '';
  document.getElementById('redPlayers').innerHTML = '';
  document.getElementById('letters').innerHTML = '';
  document.getElementById('wordsFound').innerHTML = '';
  document.getElementById('currentTeam').textContent = 'Ø§Ù„Ø¯ÙˆØ±: Ù„Ø§ Ø£Ø­Ø¯';
  document.getElementById('timer').textContent = 'Ø§Ù„ÙˆÙ‚Øª: 5:00';
  document.getElementById('category').textContent = 'Ø§Ù„ÙØ¦Ø©: ...';
  document.getElementById('pointsInfo').textContent = '';
  document.getElementById('gameBox').className = 'game-box';
  document.getElementById('scoreTableBody').innerHTML = '';
  document.getElementById('blueTotalScore').textContent = '0';
  document.getElementById('redTotalScore').textContent = '0';
}

// Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø§Øª
function connectChat() {
  const platform = document.getElementById("platformSelect").value;
  const channel = document.getElementById("channelInput").value.trim();

  // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
  if (chatClient) chatClient.disconnect();
  if (kickSocket) kickSocket.close();

  if (platform === "twitch") {
    chatClient = new tmi.Client({ 
      channels: [channel],
      connection: {
        reconnect: true,
        secure: true
      }
    });

    chatClient.connect()
      .then(() => {
        document.getElementById("chatStatus").textContent = "âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Twitch!";
      })
      .catch(err => {
        console.error("Twitch error:", err);
        document.getElementById("chatStatus").textContent = "âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Twitch!";
      });

    chatClient.on("message", (channel, tags, message, self) => {
      if (self) return;
      const username = tags["display-name"] || tags.username;
      const content = message.trim();

      if (content === "!Ø§Ø²Ø±Ù‚") {
        addPlayerFromChat("blue", username);
      } else if (content === "!Ø§Ø­Ù…Ø±") {
        addPlayerFromChat("red", username);
      } else {
        onChatMessage(username, content);
      }
    });
  }

  if (platform === "kick") {
    (async () => {
      try {
        const res = await fetch(`https://kick.com/api/v2/channels/${channel}`);
        const data = await res.json();
        const roomId = data.chatroom.id;

        kickSocket = new WebSocket("wss://ws-us2.pusher.com/app/32cbd69e4b950bf97679?protocol=7&client=js&version=8.4.0-rc2");

        kickSocket.onopen = () => {
          kickSocket.send(JSON.stringify({
            event: "pusher:subscribe",
            data: {
              auth: "",
              channel: `chatrooms.${roomId}.v2`
            }
          }));
          
          const pingInterval = setInterval(() => {
            if (kickSocket.readyState === WebSocket.OPEN) {
              kickSocket.send(JSON.stringify({ event: "pusher:ping", data: {} }));
            } else {
              clearInterval(pingInterval);
            }
          }, 12000);
        };

        kickSocket.onmessage = (event) => {
          const msg = JSON.parse(event.data);
          if (msg.event === "App\\Events\\ChatMessageEvent") {
            const d = JSON.parse(msg.data);
            const username = d.sender.username;
            const content = d.content.trim();

            if (content === "!Ø§Ø²Ø±Ù‚") {
              addPlayerFromChat("blue", username);
            } else if (content === "!Ø§Ø­Ù…Ø±") {
              addPlayerFromChat("red", username);
            } else {
              onChatMessage(username, content);
            }
          }
        };

        kickSocket.onclose = () => {
          document.getElementById("chatStatus").textContent = "âŒ ØªÙ… Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Kick!";
        };

        document.getElementById("chatStatus").textContent = "âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Kick!";
      } catch (error) {
        console.error("Kick error:", error);
        document.getElementById("chatStatus").textContent = "âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Kick!";
      }
    })();
  }
}
</script>
</body>
</html>
