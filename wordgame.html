<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>🎯 لعبة الكلمات المبعثرة</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">
  <script src="tmi.min.js"></script>
  <style>
    body {background:#111;color:#fff;font-family:'Amiri',serif;text-align:center;padding:20px;}
    h1 {color:#ff3333;margin-top:10px;}
    .game-area {font-size:28px;margin:20px auto;background:#222;padding:30px;border-radius:15px;width:90%;max-width:1200px;border:2px solid #ff3333;}
    input,button {padding:12px;font-size:20px;margin:8px auto;border-radius:8px;border:none;font-family:'Amiri',serif;}
    input.player-input {width:90%;box-sizing:border-box;}
    button {background:#ff3333;color:#fff;cursor:pointer;}
    .teams-container {display:flex;justify-content:space-between;align-items:flex-start;margin:20px auto;width:90%;gap:20px;flex-wrap:wrap;}
    .team {width:20%;padding:15px;border-radius:15px;text-align:center;}
    .team-blue {background:rgba(0,0,255,0.1);border:2px solid #0099ff;}
    .team-red {background:rgba(255,0,0,0.1);border:2px solid #ff3333;}
    .players-list {background:#333;padding:10px;border-radius:8px;min-height:50px;font-size:18px;text-align:right;}
    .player-entry {display:flex;justify-content:space-between;align-items:center;margin:2px 0;}
    .player-entry button {background:#900;font-size:14px;padding:2px 6px;border:none;border-radius:6px;cursor:pointer;}
    .game-description {width:50%;background:#222;border:1px solid #555;border-radius:10px;padding:15px;font-size:18px;line-height:1.6;}
    .current-player {font-size:26px;margin:20px 0;color:#00ffcc;}
    .scrambled-word {font-size:42px;margin:20px 0;word-spacing:10px;}
    .timer {font-size:28px;color:#ffcc00;margin:15px 0;font-weight:bold;}
    .guess-result {font-size:22px;margin-top:12px;}
    .scoreboard {margin-top:25px;font-size:22px;}
    .answer-box {position:fixed;bottom:20px;left:20px;text-align:center;font-size:20px;color:#fff;z-index:100;}
    .commands-highlight {
      color: #ff3333;
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }
  </style>
</head>
<body>

  <h1>🎯 لعبة الكلمات المبعثرة</h1>

  <div class="teams-container">
    <div class="team team-blue">
      <h3>🔵 الفريق الأزرق</h3>
      <input type="text" id="bluePlayerInput" class="player-input" placeholder="اسم اللاعب">
      <button onclick="addPlayer('blue')">➕ إضافة</button>
      <div id="bluePlayers" class="players-list"></div>
    </div>

    <div class="game-description">
      ✅ <strong>شرح اللعبة:</strong><br>
      ستظهر كلمة مبعثرة في وسط الشاشة.<br>
      على اللاعبين إعادة ترتيبها بشكل صحيح خلال 30 ثانية.<br>
      عند انتهاء الوقت أو بعد التخمين، يمكنك الضغط على زر "التالي" للانتقال للدور التالي.<br>
      أول فريق يصل إلى 15 نقطة يعتبر الفائز 🏆.<br>
      تأكد من تغطية مربع الإجابة أسفل الشاشة حتى لا يراها اللاعبون.
      <span class="commands-highlight">
        📝 أوامر الشات:<br>
        🔵 !ازرق للانضمام للفريق الأزرق<br>
        🔴 !احمر للانضمام للفريق الأحمر
      </span>
    </div>

    <div class="team team-red">
      <h3>🔴 الفريق الأحمر</h3>
      <input type="text" id="redPlayerInput" class="player-input" placeholder="اسم اللاعب">
      <button onclick="addPlayer('red')">➕ إضافة</button>
      <div id="redPlayers" class="players-list"></div>
    </div>
  </div>

  <div class="game-area">
    <button id="startButton" onclick="startGame()">🎮 ابدأ اللعبة</button>
    <div id="currentPlayer" class="current-player">⬇️ اللاعب الحالي سيظهر هنا</div>
    <div id="scrambledWord" class="scrambled-word">🔤 الكلمة هنا</div>
    
    <div id="timer" class="timer"></div>
    <button id="startTimerButton" onclick="startTimer()">⏳ ابدأ المؤقت</button>
    
    <input type="text" id="guessInput" placeholder="اكتب الإجابة هنا">
    <button onclick="submitGuess()">✅ تأكيد</button>
    <div id="guessResult" class="guess-result"></div>
    <br>
    <button onclick="nextTurn()">⏭️ التالي</button>

    <div class="scoreboard">
      🔵 الفريق الأزرق: <span id="blueScore">0</span> نقطة<br>
      🔴 الفريق الأحمر: <span id="redScore">0</span> نقطة
    </div>
  </div>

  <div class="answer-box">
    ⚠️ الإجابة: <span id="answerText">❓</span>
  </div>

  <div style="margin-top:20px;">
    <select id="platformSelect" style="padding:10px;font-size:18px;">
      <option value="twitch">Twitch</option>
      <option value="kick">Kick</option>
    </select>
    <input type="text" id="channelInput" placeholder="🎮 اكتب اسم القناة" style="padding:10px;font-size:18px;">
    <button onclick="connectChat()" style="padding:10px;font-size:18px;background:#28a745;color:#fff;border:none;border-radius:6px;cursor:pointer;">
      ✅ تسجيل الدخول
    </button>
    <div id="chatStatus" style="margin-top:10px;font-size:16px;color:#0f0;"></div>
  </div>

<script>
const bluePlayers = [];
const redPlayers = [];
let turnIndex = 0;
let currentTeam = 'blue';
let answeringTeam = 'blue';
let currentAnswer = "";
let blueScore = 0;
let redScore = 0;
let timerInterval;
let twitchClient;
let kickSocket;
let currentPlayerName = "";

   const words = [
"أمل","حياة","نور","سعادة","شمس","قمر","سماء","نجمة","بحر","نهر",
"جبل","وردة","زهرة","شجرة","غابة","طيور","أسد","نمر","فهد","ذئب",
"دب","حصان","حمار","بقرة","غزال","سمكة","حوت","دلفين","نحلة","فراشة",
"نملة","عصفور","ببغاء","صقر","بومة","ديك","دجاجة","بط","وزة","بطة",
"كلب","قطة","جمل","قرش","تمساح","سلحفاة","ثعبان","عقرب","ضفدع","قرد",
"كنغر","طاووس","نعامة","حمامة","غراب","بلبل","يمامة","دراج","دبور","جرادة",
"صرصور","يراعة","خفاش","أرنب","حرباء","غرير","لاما","موظ","ظبي","ضبع",
"تنين","أسطورة","ساحر","قلعة","عرش","تاج","ملك","ملكة","أمير","أميرة",
"وزير","جيش","سيف","درع","رمح","قوس","سهم","حربة","خوذة","فرس",
"نسر","شعلة","لهب","جمر","ريح","عاصفة","ثلج","برد","صقيع","صحراء",
"واحة","رمل","طين","بركان","زلزال","مطر","ندى","غيم","عشب","أرض",
"تربة","حديقة","مزرعة","بستان","دوحة","مدينة","قرية","بلدة","سوق","مكتبة",
"مدرسة","جامعة","مسجد","كنيسة","معبد","متحف","قصر","مسرح","مستشفى","مطعم",
"مقهى","فندق","مطار","ميناء","محطة","قطار","حافلة","سيارة","دراجة","سفينة",
"طائرة","صاروخ","قارب","غواصة","مروحية","مصباح","شمعة","بطارية","هاتف","حاسوب",
"لوحة","ساعة","كتاب","دفتر","قلم","فرشاة","ممحاة","مسطرة","مقص","مرآة",
"كرسي","طاولة","سرير","خزانة","باب","نافذة","ستارة","سجادة","وسادة","بطانية",
"حقيبة","صندوق","درج","رف","طبق","كوب","ملعقة","سكين","شوكة","قدر",
"مقلاة","غلاية","زجاجة","جرة","وعاء","مصفاة","مغسلة","ثلاجة","فرن","مكيف",
"مدفأة","مروحة","غسالة","مجفف","مكنسة","ممسحة","سلة","علبة","مغلف","مطرقة",
"مسمار","مفتاح","كماشة","منشار","مبرد","مثقاب","حبل","سلسلة","قفل","ميزان",
"ميزاب","خرطوم","برميل","دلو","سطل","اسفنجة","صابون","معجون","مرطب","مرهم",
"دواء","عطر","بخور","منشفة","شرشف","حجاب","قبعة","قميص","بنطال","تنورة",
"فستان","جاكيت","معطف","حذاء","جورب","قفاز","نظارة","ساعة","حزام","محفظة",
"خاتم","قلادة","حلق","زينة","حقيبة","مظلة","شرفة","سطح","سرداب","قبو",
"دهليز","ردهة","صالة","مطبخ","ممر","حديقة","بوابة","سور","سياج","رصيف",
"جسر","نفق","ميدان","شارع","زقاق","درب","طريق","مسار","رحلة","سفرة",
"جولة","نزهة","مغامرة","اكتشاف","بحث","لقاء","موعد","اجتماع","محادثة","نقاش",
"اتفاق","عقد","صفقة","تجارة","بيع","شراء","تبادل","هدية","تذكار","تحفة",
"لوحة","صورة","رسم","تمثال","طابع","ختم","ظرف","وثيقة","بطاقة","جواز",
"ترخيص","فاتورة","إيصال","سجل","دفتر","مفكرة","مذكرة","تقرير","قصة","رواية",
"مجلة","جريدة","إعلان","دعاية","شعار","علامة","رمز","خريطة","جدول","تصميم",
"خطة","برنامج","طريقة","نمط","شكل","بنية","هيكل","عمارة","زخرفة","نقش",
"تطريز","صباغة","ترميم","صيانة","تصوير","طباعة","نسخ","ترجمة","تحرير","إعداد",
"إنتاج","نشر","إذاعة","تسجيل","عرض","مشاركة","توزيع","تحميل","تشغيل","إيقاف",
"بدء","تحديث","تطوير","إصلاح","تغيير","حذف","إضافة","نسخ","لصق","حفظ",
"مشاركة","رفع","تنزيل","إرسال","استقبال","ضبط","تهيئة","تفعيل","إلغاء","حماية",
"تشفير","برمجة","صيانة","تشغيل","اختبار","توثيق","دعم","متابعة","إدارة","قيادة",
"تنظيم","توجيه","مراقبة","تقييم","تحليل","ابتكار","استكشاف","تعليم","تدريب","تدريس",
"شرح","توضيح","إيضاح","تحسين","تعديل","تجربة","محاولة","إنجاز","نجاح","تميز",
"شغف","إلهام","إبداع","خيال","فكر","وعي","إدراك","حكمة","معرفة","خبرة",
"موهبة","مهارة","قدرة","كفاءة","تخصص","اهتمام","فضول","رغبة",,"عزيمة","إرادة","طموح","أمل","تفاؤل","إيمان","يقين","ثقة","إخلاص","محبة",
"مودة","رحمة","عطف","حنان","شغف","رعاية","تعاون","مساعدة","تضامن","مواساة",
"صداقة","أخوة","قرابة","جار","ضيف","زميل","شريك","رفيق","معارف","ناس",
"شخص","رجل","امرأة","طفل","شاب","فتاة","كهل","شيخ","مسن","عجوز",
"رضيع","مراهق","يتيم","أرمل","أعزب","متزوج","مطلق","حبيب","خطيب","صديق",
"عدو","خصم","منافس","شريك","تابع","مستقل","محايد","زعيم","قائد","رئيس",
"وكيل","نائب","سفير","وزير","والي","حاكم","قاضي","محامي","شرطي","جندي",
"طيار","بحار","سائق","عامل","حارس","مزارع","صياد","صانع","بائع","تاجر",
"نجار","حداد","خياط","حلاق","نادل","خادم","مصور","مخرج","ممثل","مغني",
"شاعر","كاتب","مؤلف","ناقد","موسيقي","فنان","أديب","عالم","باحث","مخترع",
"مبتكر","مكتشف","مدير","مشرف","مسؤول","مدرب","معلم","مرشد","واعظ","إمام",
"داعية","زاهد","صوفي","حكيم","فقيه","مؤرخ","صحفي","مذيع","مراسل","محرر",
"مترجم","مدقق","ناشر","موزع","مسوق","مطور","مبرمج","مصمم","منتج","منشد",
"مؤذن","حافظ","قارئ","ناسخ","خطاط","زخرف","منقوش","صانع","حداد","كهربائي",
"سباك","بناء","عامل","حمال","نجار","راعي","مربي","طباخ","جزار","خباز",
"سائق","حارس","بواب","شرطي","جندي","طيار","بحار","نحّات","حرفي","تاجر",
"ساعي","وكيل","مستشار","وزير","رئيس","زعيم","قائد","والٍ","أمير","حاكم",
"سلطان","ملك","خليفة","شيخ","أستاذ","مدرب","مفتش","مراقب","محاسب","مهندس",
"طبيب","صيدلي","ممرض","جراح","معالج","خبير","فني","مخترع","مكتشف","مبتكر",
"عالم","مفكر","ناقد","كاتب","شاعر","فنان","عازف","مغني","راقص","ممثل",
"مخرج","منتج","مصور","مراسل","محرر","مترجم","مدقق","ناشر","موزع","مسوق",
"مبرمج","مصمم","مطور","مؤلف","مخرج","محرر","مدير","مشرف","رئيس","زعيم",
"قائد","سفير","نائب","وزير","والٍ","قاضي","محامي","شرطي","جندي","حارس",
"طيار","بحار","سائق","عامل","حمال","بائع","تاجر","حلاق","خياط","نجار",
"حداد","سباك","كهربائي","راعي","فلاح","مزارع","صياد","صانع","خباز","جزار",
"طباخ","نادل","خادم","ساعي","سائس","بواب","ناطور","سائس","فني","مدرب",
"مدرس","مرشد","واعظ","إمام","داعية","زاهد","صوفي","حكيم","مفكر","مبتكر",
"مكتشف","مخترع","عالم","فقيه","مؤرخ","أديب","صحفي","مذيع","مراسل","محرر",
"مترجم","مدقق","ناشر","موزع","مسوق","مؤلف","كاتب","شاعر","فنان","موسيقي",
"عازف","مغني","راقص","ممثل","مخرج","منتج","مصور","مطور","مصمم","مبرمج",
"حارس","شرطي","جندي","طيار","بحار","سائق","عامل","تاجر","بائع","خياط",
"حلاق","طباخ","نادل","خادم","فلاح","مزارع","صياد","راعي","نجار","حداد",
"سباك","كهربائي","حمال","سائس","بواب","حارس","شرطي","سائق","فني","مدرب",
"مدرس","مرشد","واعظ","إمام","داعية","زاهد","صوفي","حكيم","مفكر","مؤرخ",
"مبتكر","مخترع","مكتشف","عالم","أديب","صحفي","مذيع","محرر","مصور","مراسل",
"مترجم","مدقق","ناشر","موزع","مسوق","منتج","مخرج","ممثل","راقص","مغني",
"شاعر","كاتب","مؤلف","فنان","موسيقي","عازف","خبير","مفكر","مدير","مشرف",
"مسؤول","زعيم","قائد","رئيس","وكيل","نائب","سفير","وزير","والٍ","حاكم",
"قاضي","محامي","طبيب","مهندس","ممرض","صيدلي","جراح","معالج","فني","حرفي",
"عامل","حارس","شرطي","جندي","طيار","بحار","سائق","مزارع","راعي","فلاح",
"بائع","تاجر","صانع","خباز","جزار","طباخ","نادل","خادم","حمال",,"ناطور",
"سائس","فني","مشغل","ملاحظ","مدرب","مفتش","مراقب","محاسب","منظم",
"خبير","مستشار","مرشد","مربي","معلم","مدرس","إمام","واعظ","داعية","زاهد",
"صوفي","حكيم","مؤرخ","فقيه","أديب","كاتب","شاعر","صحفي","مذيع","مراسل",
"محرر","مصور","مترجم","مدقق","ناشر","موزع","مسوق","مؤلف","مخرج","منتج",
"ممثل","راقص","مغني","عازف","موسيقي","فنان","طباخ","خباز","جزار","خياط",
"حلاق","نجار","حداد","سباك","كهربائي","بائع","تاجر","عامل","حارس","شرطي",
"جندي","سائق","طيار","بحار","راعي","مزارع","فلاح","صياد","صانع","خادم",
"نادل","سائس","بواب","ناطور","حمال","مراقب","مدقق","مترجم","محرر","مصور",
"مراسل","مذيع","صحفي","أديب","فنان","كاتب","شاعر","مؤرخ","فقيه","حكيم",
"صوفي","زاهد","داعية","واعظ","إمام","مدرس","معلم","مربي","مرشد","مفتش",
"مدرب","ملاحظ","مشغل","فني","سائس","ناطور","بواب","حارس","شرطي","جندي",
"سائق","طيار","بحار","خياط","حلاق","طباخ","خباز","جزار","بائع","تاجر",
"عامل","صانع","فلاح","مزارع","راعي","صياد","نجار","حداد","سباك","كهربائي",
"مراقب","مدقق","مترجم","محرر","مصور","مراسل","مذيع","صحفي","أديب","كاتب",
"شاعر","فنان","موسيقي","عازف","مغني","راقص","ممثل","مخرج","منتج","مؤلف",
"ناشر","موزع","مسوق","مدير","مشرف","مسؤول","قائد","رئيس","وكيل","نائب",
"سفير","وزير","والي","حاكم","قاضي","محامي","طبيب","مهندس","ممرض","صيدلي",
"جراح","معالج","فني","مبتكر","مكتشف","مخترع","باحث","عالم","مفكر","خبير",
"مستشار","مدرب","معلم","مرشد","واعظ","إمام","داعية","صوفي","زاهد","حكيم",
"فقيه","مؤرخ","أديب","كاتب","شاعر","صحفي","مذيع","مراسل","محرر","مصور",
"مترجم","مدقق","ناشر","موزع","مسوق","مؤلف","مخرج","منتج","ممثل","راقص",
"مغني","عازف","موسيقي","فنان","مطور","مصمم","مبرمج","فلاح","مزارع","راعي",
"صياد","نجار","حداد","سباك","كهربائي","خياط","حلاق","بائع","تاجر","عامل",
"صانع","طباخ","خباز","جزار","نادل","خادم","سائس","بواب","ناطور","حارس",
"شرطي","جندي","سائق","طيار","بحار","مراقب","مدقق","مترجم","محرر","مصور",
"مراسل","مذيع","صحفي","أديب","كاتب","شاعر","فنان","موسيقي","عازف","مغني",
"راقص","ممثل","مخرج","منتج","مؤلف","ناشر","موزع","مسوق","مدير","مشرف",
"مسؤول","قائد","رئيس","وكيل","نائب","سفير","وزير","والي","حاكم","قاضي",
"محامي","طبيب","مهندس","ممرض","صيدلي","جراح","معالج","فني","مبتكر","مكتشف",
"مخترع","باحث","عالم","مفكر","خبير","مستشار","مدرب","معلم","مرشد","واعظ",
"إمام","داعية","صوفي","زاهد","حكيم","فقيه","مؤرخ","أديب","كاتب","شاعر",
"صحفي","مذيع","مراسل","محرر","مصور","مترجم","مدقق","ناشر","موزع","مسوق",
"مؤلف","مخرج","منتج","ممثل","راقص","مغني","عازف","موسيقي","فنان","مطور",
"مصمم","مبرمج","فلاح","مزارع","راعي","صياد","نجار","حداد","سباك","كهربائي",
"خياط","حلاق","بائع","تاجر","عامل","صانع","طباخ","خباز","جزار","نادل",
"خادم","سائس","بواب","ناطور","حارس","شرطي","جندي","سائق","طيار",,"مراقب",
"مدقق","مترجم","محرر","مصور","مراسل","مذيع","صحفي","أديب","كاتب",
"شاعر","فنان","موسيقي","عازف","مغني","راقص","ممثل","مخرج","منتج","مؤلف",
"ناشر","موزع","مسوق","مدير","مشرف","مسؤول","قائد","رئيس","وكيل","نائب",
"سفير","وزير","والي","حاكم","قاضي","محامي","طبيب","مهندس","ممرض","صيدلي",
"جراح","معالج","فني","مبتكر","مكتشف","مخترع","باحث","عالم","مفكر","خبير",
"مستشار","مدرب","معلم","مرشد","واعظ","إمام","داعية","صوفي","زاهد","حكيم",
"فقيه","مؤرخ","حارس","شرطي","جندي","سائق","طيار","بحار","مزارع","راعي",
"فلاح","بائع","تاجر","صانع","خباز","جزار","طباخ","نادل","خادم","حمال",
"بواب","ناطور","سائس","نجار","حداد","سباك","كهربائي","خياط","حلاق","عامل",
"ناظر","كاتب","مدير","رئيس","قائد","زعيم","وكيل","مراقب","مفتش","مشرف",
"ملاحظ","مشغل","فني","مؤلف","منتج","مخرج","ممثل","راقص","مغني","شاعر",
"كاتب","ناقد","صحفي","مذيع","مراسل","محرر","مصور","مترجم","مدقق","ناشر",
"موزع","مسوق","مطور","مصمم","مبرمج","فنان","موسيقي","عازف","مدرب","معلم",
"مرشد","واعظ","إمام","داعية","صوفي","زاهد","حكيم","مفكر","مؤرخ","فقيه",
"عالم","خبير","مستشار","باحث","مبتكر","مكتشف","مخترع","مدير","مشرف","مسؤول",
"قائد","رئيس","وكيل","نائب","سفير","وزير","والي","حاكم","قاضي","محامي",
"طبيب","مهندس","ممرض","صيدلي","جراح","معالج","فني","ناظر","كاتب","مفتش",
"مراقب","مشرف","مدير","رئيس","قائد","زعيم","وكيل","مشغل","ملاحظ","حارس",
"شرطي","جندي","سائق","طيار","بحار","راعي","مزارع","فلاح","صياد","صانع",
"نجار","حداد","سباك","كهربائي","خياط","حلاق","بائع","تاجر","عامل","خباز",
"جزار","طباخ","نادل","خادم","حمال","بواب","ناطور","سائس","فنان","موسيقي",
"عازف","مغني","راقص","ممثل","مخرج","منتج","مؤلف","كاتب","شاعر","صحفي",
"مذيع","مراسل","محرر","مصور","مترجم","مدقق","ناشر","موزع","مسوق","مطور",
"مصمم","مبرمج","مدرب","معلم","مرشد","واعظ","إمام","داعية","صوفي","زاهد",
"حكيم","مفكر","مؤرخ","فقيه","عالم","خبير","مستشار","باحث","مبتكر","مكتشف",
"مخترع","طبيب","مهندس","ممرض","صيدلي","جراح","معالج","فني","ناظر","كاتب",
"مفتش","مراقب","مشرف","مدير","رئيس","قائد","زعيم","وكيل","مشغل","ملاحظ",
"حارس","شرطي","جندي","سائق","طيار","بحار","راعي","مزارع","فلاح","صياد",
"صانع","نجار","حداد","سباك","كهربائي","خياط","حلاق","بائع","تاجر","عامل",
"خباز","جزار","طباخ","نادل","خادم","حمال","بواب","ناطور","سائس","مدير",
"مشرف","مسؤول","رئيس","قائد","زعيم","وكيل","نائب","سفير","وزير",,"حاكم","قاضي","محامي","طبيب","مهندس","ممرض","صيدلي","جراح","معالج","فني",
"مبتكر","مكتشف","مخترع","باحث","عالم","مفكر","خبير","مستشار","مدرب","معلم",
"مرشد","واعظ","إمام","داعية","صوفي","زاهد","حكيم","فقيه","مؤرخ","أديب",
"كاتب","شاعر","فنان","موسيقي","عازف","مغني","راقص","ممثل","مخرج","منتج",
"مؤلف","ناشر","موزع","مسوق","مطور","مصمم","مبرمج","مدير","مشرف","مسؤول",
"قائد","رئيس","وكيل","نائب","سفير","وزير","والي","حارس","شرطي","جندي",
"سائق","طيار","بحار","راعي","مزارع","فلاح","صياد","نجار","حداد","سباك",
"كهربائي","خياط","حلاق","بائع","تاجر","عامل","صانع","خباز","جزار","طباخ",
"نادل","خادم","حمال","بواب","ناطور","سائس","ناظر","مفتش","مراقب","مشرف"
];

function shuffleWord(word) {
  let arr = word.split('');
  let shuffled;
  do {
    shuffled = arr.slice();
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
  } while (shuffled.join('') === word);
  return shuffled.join(' ');
}

function updatePlayerList(team) {
  const listId = team === 'blue' ? "bluePlayers" : "redPlayers";
  const players = team === 'blue' ? bluePlayers : redPlayers;
  document.getElementById(listId).innerHTML = players
    .map((player, i) => `
      <div class="player-entry">
        <span>• ${player}</span>
        <button onclick="removePlayer('${team}', ${i})">🗑️</button>
      </div>
    `).join("");
}

function addPlayer(team) {
  const inputId = team === 'blue' ? "bluePlayerInput" : "redPlayerInput";
  const name = document.getElementById(inputId).value.trim();
  if (name === "") return alert("❌ الرجاء كتابة اسم اللاعب");
  if (team === 'blue') bluePlayers.push(name);
  else redPlayers.push(name);
  updatePlayerList(team);
  document.getElementById(inputId).value = "";
}

function removePlayer(team, index) {
  if (team === 'blue') bluePlayers.splice(index, 1);
  else redPlayers.splice(index, 1);
  updatePlayerList(team);
}

function startGame() {
  document.getElementById("startButton").style.display = "none";
  nextTurn();
}

function startTimer() {
  let timeLeft = 30;
  document.getElementById("timer").innerText = `⏳ الوقت المتبقي: ${timeLeft} ثانية`;
  clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    timeLeft--;
    document.getElementById("timer").innerText = `⏳ الوقت المتبقي: ${timeLeft} ثانية`;
    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      document.getElementById("timer").innerText = "⏳ انتهى الوقت!";
    }
  }, 1000);
}

function nextTurn() {
  clearInterval(timerInterval);
  document.getElementById("timer").innerText = "";
  if (bluePlayers.length === 0 || redPlayers.length === 0) {
    alert("❌ الرجاء إضافة لاعبين في كلا الفريقين.");
    return;
  }
  let player;
  if (currentTeam === 'blue') {
    player = bluePlayers[turnIndex % bluePlayers.length];
    answeringTeam = 'blue';
    currentTeam = 'red';
  } else {
    player = redPlayers[turnIndex % redPlayers.length];
    answeringTeam = 'red';
    currentTeam = 'blue';
    turnIndex++;
  }
  currentPlayerName = player;
  document.getElementById("currentPlayer").innerText = `🎮 الدور الآن: ${player}`;
  const randomWord = words[Math.floor(Math.random() * words.length)];
  currentAnswer = randomWord;
  document.getElementById("scrambledWord").innerText = shuffleWord(randomWord);
  document.getElementById("answerText").innerText = randomWord;
  document.getElementById("guessInput").value = "";
  document.getElementById("guessResult").innerText = "";
}

function connectChat() {
  const platform = document.getElementById("platformSelect").value;
  const channel = document.getElementById("channelInput").value.trim();

  if (!channel) {
    alert("❌ الرجاء كتابة اسم القناة");
    return;
  }

  if (platform === "twitch") {
    // Twitch Chat Connection
    twitchClient = new tmi.Client({ channels: [channel] });
    twitchClient.connect().then(() => {
      document.getElementById("chatStatus").innerText = `✅ تم الاتصال بـ Twitch (${channel})`;
    });
    twitchClient.on('message', (channel, tags, message, self) => {
      const username = tags['display-name'];
      const content = message.trim();

      if (content === "!ازرق") {
        if (!bluePlayers.includes(username)) {
          bluePlayers.push(username);
          updatePlayerList("blue");
        }
      } else if (content === "!احمر") {
        if (!redPlayers.includes(username)) {
          redPlayers.push(username);
          updatePlayerList("red");
        }
      } else if (content === currentAnswer && username === currentPlayerName) {
        document.getElementById("guessResult").innerHTML = `✅ ${username} أجاب بشكل صحيح!`;
        if (answeringTeam === 'red') {
          redScore++;
          document.getElementById("redScore").innerText = redScore;
          if (redScore >= 15) alert("🏆 الفريق الأحمر فاز!");
        } else {
          blueScore++;
          document.getElementById("blueScore").innerText = blueScore;
          if (blueScore >= 15) alert("🏆 الفريق الأزرق فاز!");
        }
      }
    });
  } else if (platform === "kick") {
    // Kick Chat Connection
    (async function(){
      try {
        const res = await fetch(`https://kick.com/api/v2/channels/${channel}`);
        const data = await res.json();
        const roomId = data.chatroom.id;

        kickSocket = new WebSocket("wss://ws-us2.pusher.com/app/32cbd69e4b950bf97679?protocol=7&client=js&version=8.4.0-rc2&flash=false");
        kickSocket.onopen = () => {
          kickSocket.send(JSON.stringify({
            event: "pusher:subscribe",
            data: {
              auth: "",
              channel: `chatrooms.${roomId}.v2`
            }
          }));
          document.getElementById("chatStatus").innerText = `✅ تم الاتصال بـ Kick (${channel})`;
          setInterval(() => {
            if (kickSocket.readyState === WebSocket.OPEN) {
              kickSocket.send(JSON.stringify({ event: "pusher:ping", data: {} }));
            }
          }, 12000);
        };
        kickSocket.onmessage = e => {
          const parsed = JSON.parse(e.data);
          if (parsed.event === "App\\Events\\ChatMessageEvent") {
            const msg = JSON.parse(parsed.data);
            const username = msg.sender.username;
            const content = msg.content.trim();

            if (content === "!ازرق") {
              if (!bluePlayers.includes(username)) {
                bluePlayers.push(username);
                updatePlayerList("blue");
              }
            } else if (content === "!احمر") {
              if (!redPlayers.includes(username)) {
                redPlayers.push(username);
                updatePlayerList("red");
              }
            } else if (content === currentAnswer && username === currentPlayerName) {
              document.getElementById("guessResult").innerHTML = `✅ ${username} أجاب بشكل صحيح!`;
              if (answeringTeam === 'red') {
                redScore++;
                document.getElementById("redScore").innerText = redScore;
                if (redScore >= 15) alert("🏆 الفريق الأحمر فاز!");
              } else {
                blueScore++;
                document.getElementById("blueScore").innerText = blueScore;
                if (blueScore >= 15) alert("🏆 الفريق الأزرق فاز!");
              }
            }
          }
        };
      } catch (err) {
        console.error("Kick connection error:", err);
        document.getElementById("chatStatus").innerText = "❌ فشل الاتصال بـ Kick!";
      }
    })();
  }
}

</script>
</body>
</html>
