<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸŒ Ø­Ø±Ø¨ Ø§Ù„Ø¯ÙˆÙ„</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">
<script src="tmi.min.js"></script>
<style>
  body {
    margin:0;
    background-color:#111;
    color:#fff;
    font-family:'Amiri', serif;
    text-align:center;
    padding:20px;
  }
  h1 { color:#ff3333;margin-bottom:20px; }
  .container { display:flex; justify-content:space-between; flex-wrap:wrap; }
  .wheel, .countries {
    width:48%;
    min-height:300px;
    border:2px solid #fff;
    border-radius:8px;
    padding:10px;
    overflow:auto;
    position:relative;
  }
  .country {
    display:inline-block;
    margin:5px;
    background:#222;
    padding:5px;
    border-radius:6px;
  }
  .country img {
    width:80px;
    display:block;
    margin:auto;
  }
  .overlay {
    position:fixed;
    top:0;left:0;right:0;bottom:0;
    background:rgba(0,0,0,0.8);
    display:none;
    align-items:center;
    justify-content:center;
    font-size:24px;
    z-index:999;
  }
  .eliminated {
    background:#222;
    border:2px solid #ff3333;
    border-radius:8px;
    padding:10px;
    margin:5px auto;
    width:95%;
    font-size:18px;
  }
  button {
    padding:10px 20px;
    margin-top:15px;
    background:#ff3333;
    color:#fff;
    border:none;
    border-radius:6px;
    cursor:pointer;
    font-family:'Amiri', serif;
  }
</style>
</head>
<body>
<h1>ğŸŒ Ù„Ø¹Ø¨Ø© Ø­Ø±Ø¨ Ø§Ù„Ø¯ÙˆÙ„</h1>
<p>Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØµØ© ÙˆØ£Ø±Ø³Ù„ "!Ø¯Ø®ÙˆÙ„" ÙÙŠ Ø§Ù„Ø´Ø§Øª Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</p>
<div class="container">
  <div class="wheel" id="wheel">
    <h3>ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h3>
    <ul id="playerList"></ul>
  </div>
  <div class="countries" id="countries">
    <h3>ğŸŒ Ø§Ù„Ø¯ÙˆÙ„</h3>
    <div id="countryList"></div>
  </div>
</div>
<div class="overlay" id="overlay"></div>

<div style="margin-top:20px;">
  <select id="platformSelect" style="padding:10px;font-size:18px;">
    <option value="twitch">Twitch</option>
    <option value="kick">Kick</option>
  </select>
  <input type="text" id="channelInput" placeholder="ğŸ® Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø©" style="padding:10px;font-size:18px;">
  <button onclick="connectChat()" style="padding:10px;font-size:18px;background:#28a745;color:#fff;border:none;border-radius:6px;cursor:pointer;">
    âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  </button>
  <div id="chatStatus" style="margin-top:10px;font-size:16px;color:#0f0;"></div>
</div>

<button onclick="startGame()">Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
<button onclick="nextTurn()">Ø§Ù„ØªØ§Ù„ÙŠ</button>

<h3 style="margin-top:30px;">ğŸ´â€â˜ ï¸ Ø§Ù„Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‚ØµØ§Ø©</h3>
<div id="eliminatedList"></div>

<script>
const maxPlayers = 100;
const players = [];
const countriesPool = ["Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©","Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª","Ù‚Ø·Ø±","Ù…ØµØ±","Ø§Ù„Ø£Ø±Ø¯Ù†","Ù„Ø¨Ù†Ø§Ù†","Ø§Ù„Ø¹Ø±Ø§Ù‚","Ø§Ù„ÙƒÙˆÙŠØª","Ø¹Ù…Ø§Ù†","Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†","ØªÙˆÙ†Ø³","Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±","Ø§Ù„Ù…ØºØ±Ø¨","Ù„ÙŠØ¨ÙŠØ§","Ø§Ù„Ø³ÙˆØ¯Ø§Ù†","Ø§Ù„ÙŠÙ…Ù†","Ø³ÙˆØ±ÙŠØ§","ÙÙ„Ø³Ø·ÙŠÙ†","ØªØ±ÙƒÙŠØ§","Ø¥ÙŠØ±Ø§Ù†","Ø£Ù„Ù…Ø§Ù†ÙŠØ§","ÙØ±Ù†Ø³Ø§","Ø¥ÙŠØ·Ø§Ù„ÙŠØ§","Ø¥Ø³Ø¨Ø§Ù†ÙŠØ§","Ø£Ù…Ø±ÙŠÙƒØ§","ÙƒÙ†Ø¯Ø§","Ø±ÙˆØ³ÙŠØ§","Ø§Ù„ØµÙŠÙ†","Ø§Ù„ÙŠØ§Ø¨Ø§Ù†","Ø§Ù„Ù‡Ù†Ø¯"];
let remainingCountries = [];
let assignedCountries = {};
let currentPlayer = "";
let waitingForAttack = false;
let twitchClient;
let kickSocket;
const overlay = document.getElementById("overlay");
const eliminatedDiv = document.getElementById("eliminatedList");

function getCountryCode(name){
  const codes={
    "Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©":"sa","Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª":"ae","Ù‚Ø·Ø±":"qa","Ù…ØµØ±":"eg","Ø§Ù„Ø£Ø±Ø¯Ù†":"jo","Ù„Ø¨Ù†Ø§Ù†":"lb","Ø§Ù„Ø¹Ø±Ø§Ù‚":"iq","Ø§Ù„ÙƒÙˆÙŠØª":"kw","Ø¹Ù…Ø§Ù†":"om","Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†":"bh",
    "ØªÙˆÙ†Ø³":"tn","Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±":"dz","Ø§Ù„Ù…ØºØ±Ø¨":"ma","Ù„ÙŠØ¨ÙŠØ§":"ly","Ø§Ù„Ø³ÙˆØ¯Ø§Ù†":"sd","Ø§Ù„ÙŠÙ…Ù†":"ye","Ø³ÙˆØ±ÙŠØ§":"sy","ÙÙ„Ø³Ø·ÙŠÙ†":"ps","ØªØ±ÙƒÙŠØ§":"tr","Ø¥ÙŠØ±Ø§Ù†":"ir",
    "Ø£Ù„Ù…Ø§Ù†ÙŠØ§":"de","ÙØ±Ù†Ø³Ø§":"fr","Ø¥ÙŠØ·Ø§Ù„ÙŠØ§":"it","Ø¥Ø³Ø¨Ø§Ù†ÙŠØ§":"es","Ø£Ù…Ø±ÙŠÙƒØ§":"us","ÙƒÙ†Ø¯Ø§":"ca","Ø±ÙˆØ³ÙŠØ§":"ru","Ø§Ù„ØµÙŠÙ†":"cn","Ø§Ù„ÙŠØ§Ø¨Ø§Ù†":"jp","Ø§Ù„Ù‡Ù†Ø¯":"in"
  };
  return codes[name] || "un";
}

function normalize(text){
  return text.replace(/Ø£|Ø¥|Ø¢/g,"Ø§");
}

function addPlayer(name){
  if(players.includes(name)||players.length>=maxPlayers)return;
  players.push(name);
  renderPlayers();
}
function renderPlayers(){
  const list=document.getElementById("playerList");
  list.innerHTML="";
  players.forEach(p=>{
    const li=document.createElement("li");
    li.textContent=p;
    list.appendChild(li);
  });
}
function startGame(){
  if(players.length<2){
    alert("ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø£ÙˆÙ„Ù‹Ø§!");
    return;
  }
  remainingCountries=[];
  assignedCountries={};
  eliminatedDiv.innerHTML="";
  const shuffled=countriesPool.sort(()=>0.5-Math.random()).slice(0,players.length);
  shuffled.forEach((country,i)=>{
    assignedCountries[country]=players[i];
    remainingCountries.push(country);
  });
  renderCountries();
}
function renderCountries(){
  const container=document.getElementById("countryList");
  container.innerHTML="";
  remainingCountries.forEach(c=>{
    const div=document.createElement("div");
    div.className="country";
    div.innerHTML=`<img src="https://flagcdn.com/w80/${getCountryCode(c)}.png"><br>${c}<br><small>ØŸ</small>`;
    container.appendChild(div);
  });
}
function nextTurn(){
  if(players.length<=1){
    announceWinner();
    return;
  }
  currentPlayer=players[Math.floor(Math.random()*players.length)];
  overlay.textContent=`Ø§Ù„Ø¯ÙˆØ± Ø¹Ù„Ù‰: ${currentPlayer}`;
  overlay.style.display="flex";
  setTimeout(()=>{overlay.style.display="none";waitingForAttack=true;},3000);
}
function announceWinner(){
  const lastCountry=Object.keys(assignedCountries)[0];
  const winner=assignedCountries[lastCountry];
  overlay.textContent=`ğŸ‰ Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ø³ÙŠØ·Ø±Ø©: ${lastCountry} ÙˆØ±Ø¦ÙŠØ³Ù‡Ø§ ${winner}!`;
  overlay.style.display="flex";
}
function handleAttack(target){
  const normalizedTarget = normalize(target);
  const normalizedCountries = remainingCountries.map(c=>normalize(c));
  const index = normalizedCountries.indexOf(normalizedTarget);

  if(index === -1){
    alert("Ø§Ù„Ø¯ÙˆÙ„Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©.");
    return;
  }

  waitingForAttack=false;
  const realTarget = remainingCountries[index];
  const eliminatedPlayer = assignedCountries[realTarget];
  overlay.textContent=`${currentPlayer} Ù‡Ø§Ø¬Ù… ${realTarget}`;
  overlay.style.display="flex";
  setTimeout(()=>{
    overlay.textContent=`ØªÙ… Ø¥Ù‚ØµØ§Ø¡ Ø§Ù„Ø¯ÙˆÙ„Ø© ${realTarget} ÙˆØ±Ø¦ÙŠØ³Ù‡Ø§ ${eliminatedPlayer}`;

    const div = document.createElement("div");
    div.className="eliminated";
    div.textContent=`Ø§Ù„Ø¯ÙˆÙ„Ø© ${realTarget} - Ø§Ù„Ø±Ø¦ÙŠØ³ ${eliminatedPlayer}`;
    eliminatedDiv.appendChild(div);

    players.splice(players.indexOf(eliminatedPlayer),1);
    remainingCountries.splice(index,1);
    delete assignedCountries[realTarget];
    renderPlayers();
    renderCountries();
    setTimeout(()=>{
      overlay.style.display="none";
      if(players.length<=1) announceWinner();
    },3000);
  },2000);
}
async function connectChat(){
  const platform=document.getElementById("platformSelect").value;
  const channel=document.getElementById("channelInput").value.trim();
  if(platform==="twitch"){
    twitchClient = new tmi.Client({ channels: [channel] });
    twitchClient.connect();
    twitchClient.on('message',(channel,tags,message,self)=>{
      if(self)return;
      const username=tags['display-name'];
      const content=message.trim();
      if(content==="!Ø¯Ø®ÙˆÙ„"){ addPlayer(username); }
      else if(waitingForAttack && username==currentPlayer){ handleAttack(content); }
    });
    document.getElementById("chatStatus").innerText="âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€Twitch!";
  } else if(platform==="kick"){
    try {
      let res = await fetch(`https://kick.com/api/v2/channels/${channel}`);
      let data = await res.json();
      let roomId = data.chatroom.id;
      kickSocket = new WebSocket("wss://ws-us2.pusher.com/app/32cbd69e4b950bf97679?protocol=7&client=js&version=8.4.0-rc2&flash=false");
      kickSocket.onopen = () => {
        kickSocket.send(JSON.stringify({
          event:"pusher:subscribe",
          data:{auth:"",channel:`chatrooms.${roomId}.v2`}
        }));
        setInterval(()=>{
          if(kickSocket.readyState===WebSocket.OPEN){
            kickSocket.send(JSON.stringify({event:"pusher:ping",data:{}}));
          }
        },12000);
      };
      kickSocket.onmessage = e=>{
        let t=JSON.parse(e.data);
        if(t.event==="App\\Events\\ChatMessageEvent"){
          let m=JSON.parse(t.data);
          const username=m.sender.username;
          const content=m.content.trim();
          if(content==="!Ø¯Ø®ÙˆÙ„"){ addPlayer(username); }
          else if(waitingForAttack && username==currentPlayer){ handleAttack(content); }
        }
      };
      document.getElementById("chatStatus").innerText="âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€Kick!";
    } catch(err){
      console.error("Kick connection error:",err);
    }
  }
}
</script>
</body>
</html>
