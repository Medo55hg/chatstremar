<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ® Ø³ØªØ±ÙŠÙ…Ø± ØªÙˆØ¨ â€” Ù…Ø±ÙƒØ² Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ (Twitch + Kick)</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800&display=swap" rel="stylesheet" />
  <!-- Twitch ONLY (Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø© ÙÙ‚Ø·) -->
  <script src="tmi.min.js"></script>
  <!-- Kick Ø¹Ø¨Ø± Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø© ÙÙ‚Ø· (Ù†Ø³ØªØ®Ø¯Ù… Centrifuge Ø§Ù„Ø±Ø³Ù…ÙŠ) -->
  <script src="https://cdn.jsdelivr.net/npm/centrifuge@5.1.0/dist/centrifuge.min.js"></script>
  <style>
    :root{
      --red:#ff3333; --bg:#0b0b0b; --panel:#141414; --line:#2a2a2a;
      --ok:#00d86c; --warn:#ffcc00; --blue:#00a8ff; --glow:#ff5a5a;
    }
    *{box-sizing:border-box}
    body{
      background:
        radial-gradient(1200px 600px at 80% -10%, rgba(255,51,51,.10), transparent),
        radial-gradient(900px 600px at 0% 110%, rgba(0,168,255,.08), transparent),
        var(--bg);
      color:#fff;font-family:'Cairo',sans-serif;margin:0
    }
    header{
      position:sticky;top:0;z-index:50;
      background:linear-gradient(90deg,#121212,#171717);
      border-bottom:1px solid var(--line);
      padding:12px 14px; display:flex; gap:10px; align-items:center; flex-wrap:wrap
    }
    .brand{font-weight:800;color:var(--red)}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1 1 260px}
    select,button,input{
      background:#0f0f0f;color:#fff;border:1px solid var(--line);
      border-radius:10px;padding:10px 12px;font-family:inherit
    }
    button{cursor:pointer;transition:transform .07s, box-shadow .2s}
    button:hover{box-shadow:0 0 0 2px #ffffff10}
    button:active{transform:scale(.98)}
    main{max-width:1200px;margin:22px auto;padding:0 16px}
    .card{background:linear-gradient(180deg,#151515,#101010); border:1px solid #1f1f1f; border-radius:16px; padding:14px; margin:14px 0}
    h2{margin:0 0 10px;color:var(--red)}
    .meta{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .pill{display:inline-flex;gap:6px;align-items:center;padding:6px 10px;border:1px solid var(--line);border-radius:999px;font-size:12px;opacity:.9}
    .ok{color:var(--ok)} .warn{color:var(--warn)} .blue{color:var(--blue)}
    .hidden{display:none}
    .bar{height:16px;background:#1c1c1c;border-radius:999px;overflow:hidden;border:1px solid #2a2a2a;position:relative}
    .bar>span{display:block;height:100%;background:linear-gradient(90deg,#ff5a5a,#e41414)}
    .shake{animation:shake .4s both}
    @keyframes shake{25%{transform:translateX(-4px)}50%{transform:translateX(4px)}75%{transform:translateX(-3px)}}
    .glow{box-shadow:0 0 18px rgba(255,90,90,.35)}
    .big{font-size:26px}
    .center{text-align:center}
    .sep{height:1px;background:#1f1f1f;margin:10px 0}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
    .log{background:#0e0e0e;border:1px dashed #2a2a2a;border-radius:12px;padding:10px;height:120px;overflow:auto;font-size:12px;white-space:pre-wrap}
    .status-dot{width:10px;height:10px;border-radius:50%;display:inline-block;margin-inline-end:6px}
    .on{background:#38d269}.off{background:#666}
    .kbd{background:#181818;border:1px solid #2a2a2a;border-radius:6px;padding:2px 6px;font-size:12px}
    .timer{font-weight:800;color:var(--warn)}
    .vote-star{font-size:22px;cursor:pointer;user-select:none}
    .vote-star.active{color:#ffd54a}
    .confetti{position:fixed;inset:0;pointer-events:none;z-index:999}
    .piece{position:absolute;width:8px;height:14px;opacity:.9}
    .desc{font-size:14px; opacity:.85; margin-bottom:10px; background:#1a1a1a; padding:8px 10px; border-radius:10px; border:1px solid #2a2a2a;}
    .emoji-font{font-family:"Apple Color Emoji","Segoe UI Emoji","Noto Color Emoji","Twemoji Mozilla",system-ui,sans-serif}
  </style>
</head>
<body>
  <header>
    <div class="brand">ğŸ® Ø³ØªØ±ÙŠÙ…Ø± ØªÙˆØ¨ â€” Ù…Ø±ÙƒØ² Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</div>

    <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„Ø¹Ø¨Ø© -->
    <div class="meta" style="margin-inline-start:auto">
      <label>Ø§Ø®ØªØ± Ù„Ø¹Ø¨Ø©:
        <select id="gamePicker">
          <option value="quickWord">3) Ø£Ø³Ø±Ø¹ ÙƒÙ„Ù…Ø©</option>
          <option value="fastMemory">19) Ø°Ø§ÙƒØ±Ø© Ø³Ø±ÙŠØ¹Ø©</option>
          <option value="emojiStory">22) Ù‚ØµØ© Ø¥ÙŠÙ…ÙˆØ¬ÙŠ</option>
          <option value="numberWar">32) Ø­Ø±Ø¨ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…</option>
          <option value="castleRaid">34) ØºØ²Ùˆ Ø§Ù„Ù‚Ù„Ø§Ø¹</option>
        </select>
      </label>
      <button id="openGame">ØªØ´ØºÙŠÙ„</button>
    </div>
  </header>

  <main>
    <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø±Ø¨Ø· (Twitch + Kick Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø© ÙÙ‚Ø·) -->
    <section class="card">
      <h2>ğŸ”— Ø§Ù„Ø±Ø¨Ø· Ù…Ø¹ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</h2>
      <div class="grid">
        <div class="col">
          <div class="pill"><span class="status-dot off" id="tw_dot"></span> Twitch</div>
          <div class="row">
            <input id="tw_channel" placeholder="Ø§Ø³Ù… Ù‚Ù†Ø§Ø© Twitch (Ø¨Ø¯ÙˆÙ† #)" />
            <input id="tw_user" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨ÙˆØª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" />
            <input id="tw_oauth" placeholder="oauth:xxxxxxxx (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„)" />
          </div>
          <div class="row">
            <button id="tw_connect">Ø§ØªØµØ§Ù„ Twitch</button>
            <button id="tw_disconnect">ÙØµÙ„</button>
          </div>
        </div>

        <div class="col">
          <div class="pill"><span class="status-dot off" id="kk_dot"></span> Kick</div>
          <div class="row">
            <input id="kk_channel" placeholder="Ø§Ø³Ù… Ù‚Ù†Ø§Ø© Kick (slug) Ù…Ø«Ø§Ù„: medo_dv" />
          </div>
          <div class="row">
            <button id="kk_connect">Ø§ØªØµØ§Ù„ Kick</button>
            <button id="kk_disconnect">ÙØµÙ„</button>
          </div>
          <div class="muted" style="font-size:12px;opacity:.8">
            ÙŠÙƒØªÙÙ‰ Ø¨ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø©. Ø³ÙŠØªÙ… Ø¬Ù„Ø¨ chatroom ÙˆØ§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.
          </div>
        </div>

        <div class="col">
          <div class="title">Ø£ÙˆØ§Ù…Ø± Ø§Ù„ÙØ±Ù‚</div>
          <div class="muted">Ø§Ù†Ø¶Ù…Ø§Ù…: <span class="kbd">!Ø§Ø²Ø±Ù‚</span> â€” <span class="kbd">!Ø§Ø­Ù…Ø±</span></div>
          <div class="muted">ØºØ²Ùˆ Ø§Ù„Ù‚Ù„Ø§Ø¹: <span class="kbd">!Ù‡Ø¬ÙˆÙ…</span> <span class="kbd">!Ø¯ÙØ§Ø¹</span> <span class="kbd">!Ø´ÙØ§Ø¡</span></div>
          <div class="muted">Ø£ÙˆÙ„ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© ØªÙØ³Ø¬Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø­Ø³Ø¨ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©.</div>
        </div>
      </div>
      <div class="sep"></div>
      <div class="row">
        <div class="col">
          <div class="title">Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</div>
          <div id="chat_log" class="log"></div>
        </div>
        <div class="col">
          <div class="title">Ø§Ù„ÙØ±Ù‚</div>
          <div class="log" id="teams_log"></div>
        </div>
      </div>
    </section>

    <!-- 3) Ø£Ø³Ø±Ø¹ ÙƒÙ„Ù…Ø© -->
    <section id="game_quickWord" class="card">
      <h2>3) Ø£Ø³Ø±Ø¹ ÙƒÙ„Ù…Ø© â€” Quick Word</h2>
      <div class="desc">
        ğŸ“ Ø§Ù„Ø´Ø±Ø­: ÙŠØ¸Ù‡Ø± Ø­Ø±Ù Ø¹Ø´ÙˆØ§Ø¦ÙŠ. Ø£ÙˆÙ„ Ù„Ø§Ø¹Ø¨ ÙŠÙƒØªØ¨ ÙƒÙ„Ù…Ø© ÙÙŠ Ø§Ù„Ø´Ø§Øª ØªØ¨Ø¯Ø£ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø­Ø±Ù ÙŠÙÙˆØ² Ø¨Ø§Ù„Ø¬ÙˆÙ„Ø©.
        <br>Ø§Ù„Ø£ÙˆØ§Ù…Ø±: ÙŠÙƒØªØ¨ÙˆÙ† Ø§Ù„ÙƒÙ„Ù…Ø© Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ø§Ù„Ø´Ø§Øª. ÙŠÙ…ÙƒÙ† Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±.
      </div>
      <div class="meta">
        <span>Ø§Ù„Ø­Ø±Ù Ø§Ù„Ø­Ø§Ù„ÙŠ: <b id="qw_letter" class="big">â€”</b></span>
        <span>Ø§Ù„ÙˆÙ‚Øª: <b id="qw_time" class="timer">â€”</b></span>
      </div>
      <div class="row">
        <div class="col">
          <button id="qw_new">Ø­Ø±Ù Ø¬Ø¯ÙŠØ¯</button>
          <label>Ù…Ø¯Ø© Ø§Ù„Ø¬ÙˆÙ„Ø© (Ø«): <input id="qw_duration" type="number" value="12" min="3" max="60" style="width:90px"></label>
          <label><input type="checkbox" id="qw_dedup" checked> Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±</label>
        </div>
        <div class="col center">
          <span class="muted">Ø£ÙˆÙ„ Ø±Ø³Ø§Ù„Ø© Ø¨Ø§Ù„Ø´Ø§Øª ØªØ¨Ø¯Ø£ Ø¨Ø§Ù„Ø­Ø±Ù ØªØ±Ø¨Ø­ Ø§Ù„Ø¬ÙˆÙ„Ø©.</span>
        </div>
      </div>
      <div id="qw_status" class="muted"></div>
    </section>

    <!-- 19) Ø°Ø§ÙƒØ±Ø© Ø³Ø±ÙŠØ¹Ø© -->
    <section id="game_fastMemory" class="card hidden">
      <h2>19) Ø°Ø§ÙƒØ±Ø© Ø³Ø±ÙŠØ¹Ø© â€” Fast Memory</h2>
      <div class="desc">
        ğŸ§  Ø§Ù„Ø´Ø±Ø­: ÙŠØ¹Ø±Ø¶ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø¨Ø³Ø±Ø¹Ø©. Ø¨Ø¹Ø¯ Ø«ÙˆØ§Ù†Ù ØªØ®ØªÙÙŠ ÙˆÙŠÙØ³Ø£Ù„ Ø¹Ù† Ø±Ù…Ø² Ù…Ø­Ø¯Ø¯ (Ù…Ø«Ù„Ø§Ù‹: "Ù…Ø§ Ø§Ù„Ø±Ù…Ø² Ø±Ù‚Ù… 3ØŸ").
        <br>Ø§Ù„Ø£ÙˆØ§Ù…Ø±: ÙŠÙƒØªØ¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† Ø§Ù„Ø±Ù…Ø² Ø§Ù„ØµØ­ÙŠØ­ Ù†ÙØ³Ù‡ ÙÙŠ Ø§Ù„Ø´Ø§Øª.
      </div>
      <div class="meta">
        <span>Ø§Ù„Ø·ÙˆÙ„: <input id="fm_len" type="number" min="3" max="10" value="5" style="width:70px"></span>
        <span>Ø¹Ø±Ø¶ Ø§Ù„Ø±Ù…ÙˆØ² (Ø«): <input id="fm_show" type="number" min="1" max="10" value="3" style="width:70px"></span>
        <button id="fm_start">Ø§Ø¨Ø¯Ø£</button>
        <span>Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: <b id="fm_query" class="ok">â€”</b></span>
      </div>
      <div class="center" style="min-height:52px;margin:10px 0">
        <div id="fm_stream" class="big emoji-font">â€”</div>
      </div>
      <div id="fm_status" class="muted"></div>
    </section>

    <!-- 22) Ù‚ØµØ© Ø¥ÙŠÙ…ÙˆØ¬ÙŠ -->
    <section id="game_emojiStory" class="card hidden">
      <h2>22) Ù‚ØµØ© Ø¥ÙŠÙ…ÙˆØ¬ÙŠ â€” Emoji Story</h2>
      <div class="desc">
        ğŸ“– Ø§Ù„Ø´Ø±Ø­: ÙŠØ­Ø¯Ø¯ Ø§Ù„Ù‡ÙˆØ³Øª Ù…ÙˆØ¶ÙˆØ¹ (Ù…Ø«Ù„Ø§Ù‹ "Ø£Ù†Ù…ÙŠ Ø£ÙƒØ´Ù†"). ÙŠÙƒØªØ¨ ÙƒÙ„ ÙØ±ÙŠÙ‚ Ù‚ØµØ© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ ÙÙ‚Ø· Ø®Ù„Ø§Ù„ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯ØŒ Ø«Ù… ØªØµÙˆÙŠØª Ù†Ø¬ÙˆÙ….
        <br>Ø§Ù„Ø£ÙˆØ§Ù…Ø±: Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙŠØ±Ø³Ù„ Ø³Ø·Ø±Ù‹Ø§ Ù…Ù† Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ ÙÙ‚Ø·ØŒ ÙˆÙŠØªÙ… Ø¬Ù…Ø¹Ù‡Ø§ Ù„ÙƒÙ„ ÙØ±ÙŠÙ‚.
      </div>
      <div class="row">
        <div class="col">
          <label>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹: <input id="es_topic" value="Ø£Ù†Ù…ÙŠ Ø£ÙƒØ´Ù†"></label>
        </div>
        <div class="col">
          <label>ÙˆÙ‚Øª Ø§Ù„ÙƒØªØ§Ø¨Ø© (Ø«): <input id="es_time_inp" type="number" value="15" min="5" max="60" style="width:90px"></label>
          <button id="es_start">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¬ÙˆÙ„Ø©</button>
          <span>Ø§Ù„ÙˆÙ‚Øª: <b id="es_time" class="timer">â€”</b></span>
        </div>
      </div>
      <div class="sep"></div>
      <div class="row">
        <div class="col">
          <div class="title blue">ØªØ¬Ù…ÙŠØ¹ Ù‚ØµØµ Ø§Ù„Ø£Ø²Ø±Ù‚ (ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Ø§Ù„Ø´Ø§Øª)</div>
          <div id="es_blue_view" class="log emoji-font"></div>
        </div>
        <div class="col">
          <div class="title" style="color:var(--red)">ØªØ¬Ù…ÙŠØ¹ Ù‚ØµØµ Ø§Ù„Ø£Ø­Ù…Ø±</div>
          <div id="es_red_view" class="log emoji-font"></div>
        </div>
      </div>
      <div class="sep"></div>
      <div class="grid">
        <div class="col">
          <div class="title">ØªØµÙˆÙŠØª Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± (Ù†Ø¬ÙˆÙ…)</div>
          <div>Ø§Ù„Ø£Ø²Ø±Ù‚:
            <span class="vote-star" data-esb="1">â˜…</span>
            <span class="vote-star" data-esb="2">â˜…</span>
            <span class="vote-star" data-esb="3">â˜…</span>
            <span class="vote-star" data-esb="4">â˜…</span>
            <span class="vote-star" data-esb="5">â˜…</span>
          </div>
          <div>Ø§Ù„Ø£Ø­Ù…Ø±:
            <span class="vote-star" data-esr="1">â˜…</span>
            <span class="vote-star" data-esr="2">â˜…</span>
            <span class="vote-star" data-esr="3">â˜…</span>
            <span class="vote-star" data-esr="4">â˜…</span>
            <span class="vote-star" data-esr="5">â˜…</span>
          </div>
        </div>
        <div class="col center">
          <button id="es_finish">Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
          <div id="es_status" class="muted"></div>
        </div>
      </div>
    </section>

    <!-- 32) Ø­Ø±Ø¨ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… -->
    <section id="game_numberWar" class="card hidden">
      <h2>32) Ø­Ø±Ø¨ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… â€” Number War</h2>
      <div class="desc">
        ğŸ”¢ Ø§Ù„Ø´Ø±Ø­: ÙŠØ¸Ù‡Ø± Ø±Ù‚Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ (Ù…Ø«Ù„Ø§Ù‹ 4931). Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ØªØ±ØªÙŠØ¨Ù‡ Ù„ÙŠÙƒÙˆÙ† Ø£ØµØºØ±/Ø£ÙƒØ¨Ø± Ø±Ù‚Ù… Ù…Ù…ÙƒÙ† Ù…Ù† Ù†ÙØ³ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… (Ø­Ø³Ø¨ Ø§Ù„ÙˆØ¶Ø¹).
        <br>Ø§Ù„Ø£ÙˆØ§Ù…Ø±: ÙŠÙƒØªØ¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ù†Ø§ØªØ¬ ÙÙŠ Ø§Ù„Ø´Ø§Øª.
      </div>
      <div class="meta">
        <span>Ø§Ù„Ø®Ø§Ù†Ø§Øª: <input id="nw_digits" type="number" min="3" max="6" value="4" style="width:70px"></span>
        <label><input id="nw_mode" type="checkbox"> Ø§Ø·Ù„Ø¨ Ø£ÙƒØ¨Ø± Ø±Ù‚Ù… Ø¨Ø¯Ù„ Ø§Ù„Ø£ØµØºØ±</label>
        <button id="nw_new">Ø±Ù‚Ù… Ø¬Ø¯ÙŠØ¯</button>
        <span>Ø§Ù„Ø±Ù‚Ù…: <b id="nw_number" class="big">â€”</b></span>
      </div>
      <div id="nw_status" class="muted"></div>
    </section>

    <!-- 34) ØºØ²Ùˆ Ø§Ù„Ù‚Ù„Ø§Ø¹ -->
    <section id="game_castleRaid" class="card hidden">
      <h2>34) ØºØ²Ùˆ Ø§Ù„Ù‚Ù„Ø§Ø¹ â€” Castle Raid</h2>
      <div class="desc">
        ğŸ° Ø§Ù„Ø´Ø±Ø­: ÙƒÙ„ ÙØ±ÙŠÙ‚ Ø¹Ù†Ø¯Ù‡ Ù‚Ù„Ø¹Ø© (HP=100). ÙŠØ³ØªØ®Ø¯Ù…ÙˆÙ† Ø£ÙˆØ§Ù…Ø± Ù„Ù„Ù‡Ø¬ÙˆÙ…/Ø§Ù„Ø¯ÙØ§Ø¹/Ø§Ù„Ø´ÙØ§Ø¡. Ø§Ù„Ù‡Ø¯Ù ØªØ¯Ù…ÙŠØ± Ù‚Ù„Ø¹Ø© Ø§Ù„Ø®ØµÙ….
        <br>Ø§Ù„Ø£ÙˆØ§Ù…Ø± ÙÙŠ Ø§Ù„Ø´Ø§Øª: <span class="kbd">!Ù‡Ø¬ÙˆÙ…</span> <span class="kbd">!Ø¯ÙØ§Ø¹</span> <span class="kbd">!Ø´ÙØ§Ø¡</span>
      </div>
      <div class="grid">
        <div class="col">
          <div class="title blue">Ù‚Ù„Ø¹Ø© Ø§Ù„Ø£Ø²Ø±Ù‚</div>
          <div class="bar glow" id="cr_bar_b"><span id="cr_hp_b" style="width:100%"></span></div>
          <div class="muted">HP: <b id="cr_hp_b_txt">100</b></div>
        </div>
        <div class="col">
          <div class="title" style="color:var(--red)">Ù‚Ù„Ø¹Ø© Ø§Ù„Ø£Ø­Ù…Ø±</div>
          <div class="bar glow" id="cr_bar_r"><span id="cr_hp_r" style="width:100%"></span></div>
          <div class="muted">HP: <b id="cr_hp_r_txt">100</b></div>
        </div>
      </div>
      <div class="sep"></div>
      <div class="row">
        <div class="col">
          ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©: <label><input id="cr_rng" type="checkbox" checked> Ø¶Ø±Ø±/Ø¯ÙØ§Ø¹ Ø¹Ø´ÙˆØ§Ø¦ÙŠ</label>
          <div class="muted">Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ÙØ±Ù‚: <span class="kbd">!Ø§Ø²Ø±Ù‚</span> â€” <span class="kbd">!Ø§Ø­Ù…Ø±</span></div>
        </div>
        <div class="col center">
          <button id="cr_reset">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
        </div>
      </div>
      <div id="cr_log" class="log"></div>
    </section>
  </main>

  <!-- ÙƒÙˆÙ†ÙÙŠØªÙŠ -->
  <div id="confetti" class="confetti"></div>

  <script>
    /************ Ø£Ø¯ÙˆØ§Øª Ø¹Ø§Ù…Ø© + Ø³Ø§ÙˆÙ†Ø¯ ************/
    function clamp(n,min,max){return Math.max(min,Math.min(max,n))}
    const SFX = {
      win: new Audio('data:audio/wav;base64,UklGRlwAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYAAAAgAAAASGNvbmYAAABkAAAAAQAAAP//AACAgICA'),
      hit: new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10 IBAAAAABAAEAESsAACJWAAACABYAAAAgAAAASGNvbmYAAAA4AAAAAQAAAP//AACAgICA'.replace(/\s+/g,'')),
      err: new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10 IBAAAAABAAEAESsAACJWAAACABYAAAAgAAAASGNvbmYAAAA4AAAAAQAAAP//AACAgICA'.replace(/\s+/g,'')),
    };
    function play(s){ try{SFX[s].currentTime=0; SFX[s].play();}catch(e){} }
    function confettiBurst(){
      const root = document.getElementById('confetti');
      root.innerHTML='';
      for(let i=0;i<120;i++){
        const d=document.createElement('div');
        d.className='piece';
        d.style.left=Math.random()*100+'%';
        d.style.top='-20px';
        d.style.background = `hsl(${Math.floor(Math.random()*360)} 90% 60%)`;
        const tt = 6+Math.random()*3;
        const rot = (Math.random()*720-360);
        d.animate([{transform:`translateY(0) rotate(0deg)`},{transform:`translateY(100vh) rotate(${rot}deg)`}],{duration:tt*1000,iterations:1,easing:'cubic-bezier(.2,.7,.2,1)'});
        root.appendChild(d);
        setTimeout(()=>d.remove(), tt*1000);
      }
    }
    function log(el, txt){ el.textContent += txt + "\n"; el.scrollTop = el.scrollHeight; }

    /************ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ±Ù‚ ************/
    const teams = { blue:new Set(), red:new Set() };
    const teamsLog = document.getElementById('teams_log');
    function updateTeamsLog(){
      teamsLog.textContent = `ğŸ”µ Ø§Ù„Ø£Ø²Ø±Ù‚ (${teams.blue.size}): ${[...teams.blue].join(', ') || '-'}\nğŸ”´ Ø§Ù„Ø£Ø­Ù…Ø± (${teams.red.size}): ${[...teams.red].join(', ') || '-'}`;
    }
    function joinTeam(user, which){
      if(which==='blue'){ teams.red.delete(user); teams.blue.add(user); }
      else { teams.blue.delete(user); teams.red.add(user); }
      updateTeamsLog();
    }

    /************ ØªØ¨Ø¯ÙŠÙ„ ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ ************/
    const picker = document.getElementById('gamePicker');
    const openBtn = document.getElementById('openGame');
    const sections = {
      quickWord: document.getElementById('game_quickWord'),
      fastMemory: document.getElementById('game_fastMemory'),
      emojiStory: document.getElementById('game_emojiStory'),
      numberWar: document.getElementById('game_numberWar'),
      castleRaid: document.getElementById('game_castleRaid'),
    };
    function showOnly(id){
      Object.values(sections).forEach(s=>s.classList.add('hidden'));
      sections[id].classList.remove('hidden');
    }
    openBtn.addEventListener('click', ()=> showOnly(picker.value));
    showOnly('quickWord');

    /************ (3) Ø£Ø³Ø±Ø¹ ÙƒÙ„Ù…Ø© ************/
    const arabicLetters = "Ø§Ø¨ØªØ«Ø¬Ø­Ø®Ø¯Ø°Ø±Ø²Ø³Ø´ØµØ¶Ø·Ø¸Ø¹ØºÙÙ‚ÙƒÙ„Ù…Ù†Ù‡ÙˆÙŠ".split('');
    const qw_letter = document.getElementById('qw_letter');
    const qw_time = document.getElementById('qw_time');
    const qw_new = document.getElementById('qw_new');
    const qw_duration = document.getElementById('qw_duration');
    const qw_status = document.getElementById('qw_status');
    const qw_dedup = document.getElementById('qw_dedup');

    let qw_timer=null, qw_deadline=0, qw_active=false, qw_used=new Set();
    function qwStartRound(){
      const ch = arabicLetters[Math.floor(Math.random()*arabicLetters.length)];
      qw_letter.textContent = ch;
      qw_used.clear(); qw_active=true;
      const sec = clamp(+qw_duration.value||12,3,60);
      qw_deadline = Date.now()+sec*1000;
      if(qw_timer) clearInterval(qw_timer);
      qw_timer = setInterval(()=>{
        const left = Math.max(0, qw_deadline-Date.now());
        qw_time.textContent = (left/1000).toFixed(1)+"s";
        if(left<=0){ clearInterval(qw_timer); qw_active=false; qw_status.textContent="â±ï¸ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!"; }
      }, 100);
      qw_status.textContent="Ø§ÙƒØªØ¨ÙˆØ§ ÙƒÙ„Ù…Ø© ØªØ¨Ø¯Ø£ Ø¨Ø§Ù„Ø­Ø±Ù Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶â€¦";
    }
    function qwTryWin(user, text){
      if(!qw_active) return false;
      const ch = qw_letter.textContent;
      const word = text.trim();
      if(!word || !word.startsWith(ch)) return false;
      if(qw_dedup.checked){
        const low=word.toLowerCase();
        if(qw_used.has(low)) return false;
        qw_used.add(low);
      }
      clearInterval(qw_timer); qw_active=false;
      qw_status.textContent = `ğŸ ${user} ÙØ§Ø² Ø¨Ø§Ù„Ø¬ÙˆÙ„Ø© Ø¨ÙƒÙ„Ù…Ø©: ${word}`;
      play('win'); confettiBurst();
      return true;
    }
    qw_new.addEventListener('click', qwStartRound);

    /************ (19) Ø°Ø§ÙƒØ±Ø© Ø³Ø±ÙŠØ¹Ø© ************/
    const fm_len = document.getElementById('fm_len');
    const fm_show = document.getElementById('fm_show');
    const fm_start = document.getElementById('fm_start');
    const fm_stream = document.getElementById('fm_stream');
    const fm_query = document.getElementById('fm_query');
    const fm_status = document.getElementById('fm_status');

    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Unicode Escapes Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ
    const EMOJIS = [
      "\u{1F600}","\u{1F60E}","\u{1F929}","\u{1F973}","\u{1F631}","\u{1F916}","\u{1F47B}",
      "\u{1F431}","\u{1F436}","\u{1F43C}","\u{1F438}","\u{1F427}","\u{1F98A}","\u{1F984}",
      "\u{1F40D}","\u{1F996}","\u{1F355}","\u{1F354}","\u{1F35F}","\u{1F32E}","\u{1F363}",
      "\u{1F369}","\u{1F36A}","\u{1F349}","\u{1F347}","\u{1F34E}","\u{26BD}","\u{1F3C0}",
      "\u{1F3AE}","\u{1F3B2}","\u{1F3AF}","\u{1F3B5}","\u{1F3A7}","\u{1F697}",
      "\u{2708}\u{FE0F}","\u{1F680}","\u{23F0}","\u{2B50}","\u{1F525}","\u{1F4A1}","\u{1F48E}","\u{1F511}","\u{1F9E0}"
    ];
    let fm_seq=[], fm_idx=0, fm_ans="", fm_active=false;

    function fmStart(){
      const L = clamp(+fm_len.value||5,3,10);
      const showSec = clamp(+fm_show.value||3,1,10);
      fm_seq = Array.from({length:L}, ()=> EMOJIS[Math.floor(Math.random()*EMOJIS.length)]);
      fm_stream.textContent = fm_seq.join(' ');
      fm_idx = Math.floor(Math.random()*L);
      fm_ans = fm_seq[fm_idx];
      fm_query.textContent = `Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø±Ù…Ø² Ø±Ù‚Ù… ${fm_idx+1}ØŸ`;
      fm_status.textContent = "Ø±ÙƒÙ‘Ø²â€¦";
      fm_active = true;
      setTimeout(()=>{ fm_stream.textContent = "â€”"; fm_status.textContent="Ø£Ø¬Ø¨ Ø§Ù„Ø¢Ù† ÙÙŠ Ø§Ù„Ø´Ø§Øª (Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ù†ÙØ³Ù‡)."; }, showSec*1000);
    }
    function fmTry(user, text){
      if(!fm_active) return false;
      const t = text.trim();
      if(!t) return false;
      if(t === fm_ans){
        fm_active=false; fm_status.textContent = `âœ… ${user} ØµØ­ÙŠØ­! Ø§Ù„Ø±Ù…Ø²: ${fm_ans}`;
        play('win'); confettiBurst();
        return true;
      }
      return false;
    }
    fm_start.addEventListener('click', fmStart);

    /************ (22) Ù‚ØµØ© Ø¥ÙŠÙ…ÙˆØ¬ÙŠ ************/
    const es_topic = document.getElementById('es_topic');
    const es_time_inp = document.getElementById('es_time_inp');
    const es_time = document.getElementById('es_time');
    const es_start = document.getElementById('es_start');
    const es_blue_view = document.getElementById('es_blue_view');
    const es_red_view = document.getElementById('es_red_view');
    const es_finish = document.getElementById('es_finish');
    const es_status = document.getElementById('es_status');
    const starEls = [...document.querySelectorAll('.vote-star')];
    let es_deadline=0, esTimer=null, es_active=false, esStarsB=0, esStarsR=0;

    function esTick(){
      const left = Math.max(0, es_deadline-Date.now());
      es_time.textContent = (left/1000).toFixed(1)+"s";
      if(left<=0){ clearInterval(esTimer); es_active=false; es_time.textContent="Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª"; }
    }
    function esStart(){
      const sec = clamp(+es_time_inp.value||15,5,60);
      es_deadline = Date.now()+sec*1000;
      if(esTimer) clearInterval(esTimer);
      esTimer = setInterval(esTick,100);
      es_active = true;
      es_status.textContent = `ğŸ“˜ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹: ${es_topic.value} â€” Ø§ÙƒØªØ¨ÙˆØ§ Ù‚ØµØªÙƒÙ… Ø¨Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ§Øª ÙÙ‚Ø·`;
      es_blue_view.textContent = ""; es_red_view.textContent="";
      esStarsB=0; esStarsR=0; updateStarUI();
    }
    function isEmojiOnly(s){
      const emojiRegex = /[\u2190-\u2BFF\u{1F300}-\u{1FAFF}]/u;
      return s && emojiRegex.test(s);
    }
    function esCollect(team, user, text){
      if(!es_active) return;
      if(!isEmojiOnly(text)) return;
      const line = `${user}: ${text}`;
      if(team==='blue') es_blue_view.textContent += line + "\n";
      else es_red_view.textContent += line + "\n";
    }
    function updateStarUI(){
      starEls.forEach(el=>{
        const b = el.dataset.esb, r = el.dataset.esr;
        if(b){ el.classList.toggle('active', +b<=esStarsB); }
        if(r){ el.classList.toggle('active', +r<=esStarsR); }
      });
    }
    starEls.forEach(el=>{
      el.addEventListener('click', ()=>{
        if(el.dataset.esb){ esStarsB = +el.dataset.esb; updateStarUI(); }
        if(el.dataset.esr){ esStarsR = +el.dataset.esr; updateStarUI(); }
      });
    });
    function esFinish(){
      let msg = `Ù†Ø¬ÙˆÙ… Ø§Ù„Ø£Ø²Ø±Ù‚: ${esStarsB} â€” Ù†Ø¬ÙˆÙ… Ø§Ù„Ø£Ø­Ù…Ø±: ${esStarsR}\n`;
      if(esStarsB>esStarsR) msg += "ğŸ Ø§Ù„ÙØ§Ø¦Ø²: Ø§Ù„Ø£Ø²Ø±Ù‚";
      else if(esStarsR>esStarsB) msg += "ğŸ Ø§Ù„ÙØ§Ø¦Ø²: Ø§Ù„Ø£Ø­Ù…Ø±";
      else msg += "ØªØ¹Ø§Ø¯Ù„!";
      es_status.textContent = msg;
      confettiBurst(); play('win');
    }
    es_start.addEventListener('click', esStart);
    es_finish.addEventListener('click', esFinish);

    /************ (32) Ø­Ø±Ø¨ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ************/
    const nw_digits = document.getElementById('nw_digits');
    const nw_mode = document.getElementById('nw_mode');
    const nw_new = document.getElementById('nw_new');
    const nw_number = document.getElementById('nw_number');
    const nw_status = document.getElementById('nw_status');
    let nw_current = "";

    function nwGenerate(){
      const d = clamp(+nw_digits.value||4,3,6);
      let s = "";
      for(let i=0;i<d;i++){ s += Math.floor(Math.random()*10); }
      nw_current = s; nw_number.textContent = s;
      nw_status.textContent = nw_mode.checked ? "Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: Ø£ÙƒØ¨Ø± ØªØ±ØªÙŠØ¨ Ù…Ù† Ù†ÙØ³ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…" : "Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: Ø£ØµØºØ± ØªØ±ØªÙŠØ¨ Ù…Ù† Ù†ÙØ³ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…";
    }
    function reorder(s, largest=false){
      const arr = s.split('').sort((a,b)=> largest ? (+b - +a) : (+a - +b));
      if(!largest && arr[0]==='0'){
        const idx = arr.findIndex(x=>x!=='0');
        if(idx>0){ const t = arr[idx]; arr[idx]=arr[0]; arr[0]=t; }
      }
      return arr.join('');
    }
    function nwTry(user, text){
      if(!nw_current) return false;
      const target = reorder(nw_current, nw_mode.checked);
      const val = text.replace(/\D/g,'');
      if(val === target){
        nw_status.textContent = `âœ… ${user} ØµØ­ÙŠØ­! Ø§Ù„Ø¬ÙˆØ§Ø¨: ${target}`;
        play('win'); confettiBurst();
        nw_current = "";
        return true;
      }
      return false;
    }
    nw_new.addEventListener('click', nwGenerate);
    nwGenerate();

    /************ (34) ØºØ²Ùˆ Ø§Ù„Ù‚Ù„Ø§Ø¹ ************/
    const cr_hp_b = document.getElementById('cr_hp_b');
    const cr_hp_r = document.getElementById('cr_hp_r');
    const cr_hp_b_txt = document.getElementById('cr_hp_b_txt');
    const cr_hp_r_txt = document.getElementById('cr_hp_r_txt');
    const cr_bar_b = document.getElementById('cr_bar_b');
    const cr_bar_r = document.getElementById('cr_bar_r');
    const cr_rng = document.getElementById('cr_rng');
    const cr_log = document.getElementById('cr_log');
    const cr_reset = document.getElementById('cr_reset');

    let HP_B=100, HP_R=100, DEF_B=0, DEF_R=0, CR_LOCK=false;
    function crSync(){
      cr_hp_b.style.width = HP_B+"%";
      cr_hp_r.style.width = HP_R+"%";
      cr_hp_b_txt.textContent = HP_B;
      cr_hp_r_txt.textContent = HP_R;
    }
    function crEntry(t){ log(cr_log, t); }
    function rng(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
    function shake(el){ el.classList.add('shake'); setTimeout(()=>el.classList.remove('shake'), 350); }

    function applyDamage(attacker, target){
      if(CR_LOCK) return;
      const randomize = cr_rng.checked;
      let dmg = randomize ? rng(6,14) : 10;
      let shield = (target==='R' ? DEF_R : DEF_B);
      let actual = Math.max(0, dmg - shield);
      if(target==='R'){ HP_R = clamp(HP_R - actual, 0, 100); DEF_R = 0; shake(cr_bar_r); }
      else { HP_B = clamp(HP_B - actual, 0, 100); DEF_B = 0; shake(cr_bar_b); }
      crEntry(`${attacker==='B'?'ğŸ”µ Ø§Ù„Ø£Ø²Ø±Ù‚':'ğŸ”´ Ø§Ù„Ø£Ø­Ù…Ø±'} Ù‡Ø§Ø¬Ù… Ø¨Ù‚ÙŠÙ…Ø© ${dmg}ØŒ Ø§Ù„Ø¯Ø±Ø¹ ${shield} â† Ø§Ù„Ø¶Ø±Ø± ${actual}`);
      play('hit'); crSync(); crCheckEnd();
    }
    function applyDefender(team){
      if(CR_LOCK) return;
      const randomize = cr_rng.checked;
      const def = randomize ? rng(4,10) : 7;
      if(team==='B') DEF_B = def; else DEF_R = def;
      crEntry(`${team==='B'?'ğŸ”µ Ø§Ù„Ø£Ø²Ø±Ù‚':'ğŸ”´ Ø§Ù„Ø£Ø­Ù…Ø±'} ÙØ¹Ù‘Ù„ Ø¯ÙØ§Ø¹ Ø¨Ù‚ÙŠÙ…Ø© ${def}`);
      crSync();
    }
    function applyHeal(team){
      if(CR_LOCK) return;
      const randomize = cr_rng.checked;
      const heal = randomize ? rng(6,12) : 8;
      if(team==='B') HP_B = clamp(HP_B + heal, 0, 100);
      else HP_R = clamp(HP_R + heal, 0, 100);
      crEntry(`${team==='B'?'ğŸ”µ Ø§Ù„Ø£Ø²Ø±Ù‚':'ğŸ”´ Ø§Ù„Ø£Ø­Ù…Ø±'} Ø´ÙØ§Ø¡ +${heal}`);
      crSync();
    }
    function crCheckEnd(){
      if(HP_B<=0 || HP_R<=0){
        CR_LOCK=true;
        const msg = HP_B<=0 ? "ğŸ”´ Ø§Ù„Ø£Ø­Ù…Ø± Ø¯Ù…Ù‘Ø± Ù‚Ù„Ø¹Ø© Ø§Ù„Ø£Ø²Ø±Ù‚!" : "ğŸ”µ Ø§Ù„Ø£Ø²Ø±Ù‚ Ø¯Ù…Ù‘Ø± Ù‚Ù„Ø¹Ø© Ø§Ù„Ø£Ø­Ù…Ø±!";
        crEntry("ğŸ "+msg); confettiBurst(); play('win');
      }
    }
    function crReset(){
      HP_B=100; HP_R=100; DEF_B=0; DEF_R=0; CR_LOCK=false;
      cr_log.textContent="Ø¨Ø¯Ø£Øª Ù…Ø¨Ø§Ø±Ø§Ø© Ø¬Ø¯ÙŠØ¯Ø©.\n"; crSync();
    }
    cr_reset.addEventListener('click', crReset);
    crReset();

    /************ Ø±Ø¨Ø· Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©: Twitch (Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø© ÙÙ‚Ø·) ************/
    const chatLog = document.getElementById('chat_log');
    const tw_dot = document.getElementById('tw_dot');
    let twClient = null;

    function connectTwitch(){
      const channel = document.getElementById('tw_channel').value.trim();
      const username = document.getElementById('tw_user').value.trim();
      const oauth = document.getElementById('tw_oauth').value.trim(); // ÙŠØ¨Ø¯Ø£ Ø¨Ù€ oauth:
      if(!channel){ alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ù‚Ù†Ø§Ø© Twitch"); return; }

      const opts = {
        options: { debug: false },
        connection: { reconnect: true, secure: true },
        channels: [ '#'+channel ]
      };
      if(username && oauth){
        opts.identity = { username, password: oauth };
      }
      if(twClient){ try{twClient.disconnect()}catch(e){} }

      twClient = new tmi.Client(opts);
      twClient.connect().then(()=>{
        tw_dot.classList.remove('off'); tw_dot.classList.add('on');
        log(chatLog, `âœ… Ù…ØªØµÙ„ Ø¨Ù€ Twitch #${channel}`);
      }).catch(err=>{ log(chatLog,"âŒ Twitch: "+err); });

      twClient.on('message', (ch, tags, message, self)=>{
        if(self) return;
        const user = tags['display-name'] || tags.username;
        handleIncoming('twitch', user, message);
      });
    }
    function disconnectTwitch(){
      if(twClient){ try{twClient.disconnect()}catch(e){} twClient=null; }
      tw_dot.classList.remove('on'); tw_dot.classList.add('off');
      log(chatLog, "ğŸ”Œ ØªÙ… ÙØµÙ„ Twitch");
    }
    document.getElementById('tw_connect').addEventListener('click', connectTwitch);
    document.getElementById('tw_disconnect').addEventListener('click', disconnectTwitch);

    /************ Ø±Ø¨Ø· Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©: Kick (Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø© ÙÙ‚Ø·) ************/
    const kk_dot = document.getElementById('kk_dot');
    let kkC = null, kkSub = null, kkRoomId = null;

    async function connectKick(){
      const slug = document.getElementById('kk_channel').value.trim();
      if(!slug){ alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ù‚Ù†Ø§Ø© Kick (slug)"); return; }
      try{
        // 1) Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù‚Ù†Ø§Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ chatroom.id
        const info = await fetch(`https://kick.com/api/v2/channels/${encodeURIComponent(slug)}`, {cache:'no-cache'}).then(r=>r.json());
        kkRoomId = info?.chatroom?.id;
        if(!kkRoomId) throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ chatroom.id");

        // 2) Ø§ØªØµØ§Ù„ WebSocket Ø¹Ø¨Ø± Centrifugo Ø§Ù„Ø±Ø³Ù…ÙŠ
        if(kkC){ try{kkC.disconnect()}catch(e){} kkC=null; }
        kkC = new Centrifuge("wss://chat.kick.com/connection/websocket", { timeout: 15000 });
        kkC.on('connect', ()=>{ kk_dot.classList.remove('off'); kk_dot.classList.add('on'); log(chatLog, `âœ… Ù…ØªØµÙ„ Ø¨Ù€ Kick @${slug}`); });
        kkC.on('disconnect', ()=>{ kk_dot.classList.remove('on'); kk_dot.classList.add('off'); log(chatLog, "ğŸ”Œ ØªÙ… ÙØµÙ„ Kick"); });
        kkC.connect();

        // 3) Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ù‚Ù†Ø§Ø© Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
        const topic = `chatrooms.${kkRoomId}.v2`;
        kkSub = kkC.newSubscription(topic);
        kkSub.on('publication', ctx=>{
          try{
            const data = ctx?.data;
            const msg = data?.content || data?.message || "";
            const user = (data?.sender?.username || data?.user?.username || "kick_user");
            if(!msg) return;
            handleIncoming('kick', user, msg);
          }catch(e){}
        });
        kkSub.subscribe();
      }catch(e){
        log(chatLog, "âŒ Kick: "+e.message);
      }
    }
    function disconnectKick(){
      if(kkSub){ try{kkSub.unsubscribe()}catch(e){} kkSub=null; }
      if(kkC){ try{kkC.disconnect()}catch(e){} kkC=null; }
      kk_dot.classList.remove('on'); kk_dot.classList.add('off');
      log(chatLog, "ğŸ”Œ ØªÙ… ÙØµÙ„ Kick");
    }
    document.getElementById('kk_connect').addEventListener('click', connectKick);
    document.getElementById('kk_disconnect').addEventListener('click', disconnectKick);

    /************ Ù…ÙØ³Ø± Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ************/
    function handleIncoming(platform, user, text){
      log(chatLog, `[${platform}] ${user}: ${text}`);

      // Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…
      if(/^!Ø§Ø²Ø±Ù‚$/i.test(text.trim())){ joinTeam(user,'blue'); return; }
      if(/^!Ø§Ø­Ù…Ø±$/i.test(text.trim())){ joinTeam(user,'red'); return; }

      // Ø­Ø¯Ø¯ ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø±Ø³Ù„
      const team = teams.blue.has(user) ? 'blue' : (teams.red.has(user) ? 'red' : null);

      // Ù…Ø±Ù‘Ø± Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
      const current = picker.value;
      if(current==='quickWord'){
        if(qwTryWin(user, text)) return;
      }
      else if(current==='fastMemory'){
        if(fmTry(user, text)) return;
      }
      else if(current==='emojiStory'){
        if(team) esCollect(team, user, text);
      }
      else if(current==='numberWar'){
        if(nwTry(user, text)) return;
      }
      else if(current==='castleRaid'){
        if(!team) return;
        const t = text.trim();
        if(/^!Ù‡Ø¬ÙˆÙ…$/i.test(t)){
          applyDamage(team==='blue'?'B':'R', team==='blue'?'R':'B');
        } else if(/^!Ø¯ÙØ§Ø¹$/i.test(t)){
          applyDefender(team==='blue'?'B':'R');
        } else if(/^!Ø´ÙØ§Ø¡$/i.test(t)){
          applyHeal(team==='blue'?'B':'R');
        }
      }
    }
  </script>
</body>
</html>
